<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:RechnerPlus.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:ctrl="using:RechnerPlus.Controls"
             xmlns:skia="using:Avalonia.Labs.Controls"
             x:Class="RechnerPlus.Views.CalculatorView"
             x:DataType="vm:CalculatorViewModel">

  <UserControl.Styles>
    <!-- Base calculator button: fills grid cell, larger touch target, centered content -->
    <Style Selector="Button.CalcButton">
      <Setter Property="Height" Value="NaN"/>
      <Setter Property="MinHeight" Value="56"/>
      <Setter Property="CornerRadius" Value="16"/>
      <Setter Property="HorizontalAlignment" Value="Stretch"/>
      <Setter Property="VerticalAlignment" Value="Stretch"/>
      <Setter Property="HorizontalContentAlignment" Value="Center"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
      <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
      <Setter Property="Transitions">
        <Transitions>
          <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.08"/>
          <BrushTransition Property="Background" Duration="0:0:0.15"/>
        </Transitions>
      </Setter>
    </Style>
    <Style Selector="Button.CalcButton:pressed">
      <Setter Property="RenderTransform" Value="scale(0.92)"/>
    </Style>

    <!-- Digit button styling (fast transparent, glasmorphism-ähnlich) -->
    <Style Selector="Button.Digit">
      <Setter Property="Background" Value="{DynamicResource DigitButtonBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
      <Setter Property="FontSize" Value="24"/>
      <Setter Property="FontWeight" Value="Bold"/>
    </Style>
    <Style Selector="Button.Digit:pointerover">
      <Setter Property="Background" Value="{DynamicResource DigitButtonHoverBrush}"/>
    </Style>

    <!-- Operator button styling -->
    <Style Selector="Button.Operator">
      <Setter Property="FontSize" Value="24"/>
      <Setter Property="FontWeight" Value="Bold"/>
    </Style>

    <!-- Aktiver Operator: invertierte Farben + auffälliger Border -->
    <Style Selector="Button.ActiveOp">
      <Setter Property="Background" Value="{DynamicResource PrimaryBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource PrimaryContrastBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource PrimaryHoverBrush}"/>
      <Setter Property="BorderThickness" Value="2"/>
    </Style>

    <!-- Scientific function button styling -->
    <Style Selector="Button.Function">
      <Setter Property="FontSize" Value="13"/>
      <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
      <Setter Property="Transitions">
        <Transitions>
          <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.08"/>
        </Transitions>
      </Setter>
    </Style>
    <Style Selector="Button.Function:pressed">
      <Setter Property="RenderTransform" Value="scale(0.92)"/>
    </Style>

    <!-- INV-Button aktiv -->
    <Style Selector="Button.InvActive">
      <Setter Property="Background" Value="{DynamicResource PrimaryBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
    </Style>

    <!-- Equals-Button: Gradient + Auffällig -->
    <Style Selector="Button.Equals">
      <Setter Property="FontSize" Value="28"/>
      <Setter Property="FontWeight" Value="ExtraBold"/>
      <Setter Property="Background" Value="{DynamicResource EqualsGradientBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource PrimaryContrastBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource PrimaryHoverBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
    </Style>

    <!-- Memory-Row: dezent wenn leer, volle Sichtbarkeit wenn aktiv -->
    <Style Selector="Grid.MemoryRow">
      <Setter Property="Opacity" Value="0.4"/>
      <Setter Property="Transitions">
        <Transitions>
          <DoubleTransition Property="Opacity" Duration="0:0:0.2"/>
        </Transitions>
      </Setter>
    </Style>
    <Style Selector="Grid.MemoryActive">
      <Setter Property="Opacity" Value="1"/>
    </Style>
    <!-- Landscape: kompaktere Abstände und Buttons -->
    <Style Selector="Grid.Landscape Border#DisplayBorder">
      <Setter Property="Padding" Value="12,6"/>
    </Style>
    <Style Selector="Grid.Landscape Panel#DisplayPanel">
      <Setter Property="Margin" Value="0,0,0,4"/>
    </Style>
    <Style Selector="Grid.Landscape Grid#ModeSelector">
      <Setter Property="Margin" Value="0,0,0,4"/>
    </Style>
    <Style Selector="Grid.Landscape Grid#ModeSelector Button">
      <Setter Property="FontSize" Value="11"/>
      <Setter Property="Padding" Value="8,3"/>
      <Setter Property="MinHeight" Value="0"/>
    </Style>
    <Style Selector="Grid.Landscape Grid#MemoryRowGrid">
      <Setter Property="Margin" Value="0,0,0,4"/>
    </Style>
    <Style Selector="Grid.Landscape Button.CalcButton">
      <Setter Property="MinHeight" Value="0"/>
      <Setter Property="CornerRadius" Value="10"/>
      <Setter Property="Padding" Value="2"/>
    </Style>
    <Style Selector="Grid.Landscape Button.Digit">
      <Setter Property="FontSize" Value="18"/>
    </Style>
    <Style Selector="Grid.Landscape Button.Operator">
      <Setter Property="FontSize" Value="18"/>
    </Style>
    <Style Selector="Grid.Landscape Button.Function">
      <Setter Property="FontSize" Value="11"/>
      <Setter Property="MinHeight" Value="0"/>
      <Setter Property="Padding" Value="2"/>
    </Style>
    <Style Selector="Grid.Landscape Button.Equals">
      <Setter Property="FontSize" Value="22"/>
    </Style>
    <!-- Landscape: Memory-Buttons kompakter -->
    <Style Selector="Grid.Landscape Grid#MemoryRowGrid Button">
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="Padding" Value="4,2"/>
      <Setter Property="MinHeight" Value="0"/>
      <Setter Property="MinWidth" Value="0"/>
    </Style>
  </UserControl.Styles>

  <Grid x:Name="RootGrid" AutomationProperties.AutomationId="Calc_RootPanel" RowDefinitions="Auto,Auto,Auto,Auto,*" Margin="16">

    <!-- ============================================ -->
    <!-- 1. Display Area                              -->
    <!-- ============================================ -->
    <Panel x:Name="DisplayPanel" Grid.Row="0" Margin="0,0,0,8">
      <Border Background="{DynamicResource DisplayGradientBrush}"
              CornerRadius="16"
              Padding="16"
              x:Name="DisplayBorder"
              AutomationProperties.AutomationId="Calc_DisplayCard">
        <Grid RowDefinitions="Auto,Auto,Auto,Auto">
          <!-- Expression line mit Copy + Backspace-Button -->
          <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto,Auto,Auto">
            <TextBlock Grid.Column="0"
                       AutomationProperties.AutomationId="Calc_MemoryIndicator"
                       Text="M"
                       FontSize="13"
                       FontWeight="Bold"
                       Foreground="{DynamicResource PrimaryBrush}"
                       IsVisible="{Binding HasMemory}"
                       VerticalAlignment="Center"
                       Margin="0,0,6,0"
                       ToolTip.Tip="{Binding MemoryDisplay}"/>
            <ctrl:ExpressionHighlightControl Grid.Column="1"
                       x:Name="ExpressionText"
                       AutomationProperties.AutomationId="Calc_ExpressionText"
                       Expression="{Binding Expression}"
                       FontSize="14"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Right"
                       VerticalAlignment="Center"
                       MinHeight="20"
                       TextTrimming="CharacterEllipsis"/>
            <Button Grid.Column="2"
                    AutomationProperties.AutomationId="Calc_BtnShare"
                    Classes="Text"
                    Padding="8,4"
                    MinWidth="0"
                    MinHeight="0"
                    Command="{Binding ShareDisplayCommand}"
                    ToolTip.Tip="Share">
              <mi:MaterialIcon Kind="ShareVariantOutline" Width="16" Height="16"
                               Foreground="{DynamicResource TextMutedBrush}"
                               Opacity="0.6"/>
            </Button>
            <Button Grid.Column="3"
                    AutomationProperties.AutomationId="Calc_BtnCopy"
                    Classes="Text"
                    Padding="8,4"
                    MinWidth="0"
                    MinHeight="0"
                    Command="{Binding CopyDisplayCommand}"
                    ToolTip.Tip="Copy">
              <mi:MaterialIcon Kind="ContentCopy" Width="16" Height="16"
                               Foreground="{DynamicResource TextMutedBrush}"
                               Opacity="0.6"/>
            </Button>
            <Button Grid.Column="4"
                    AutomationProperties.AutomationId="Calc_BtnBackspace"
                    Classes="Text"
                    Padding="8,4"
                    MinWidth="0"
                    MinHeight="0"
                    Command="{Binding BackspaceCommand}">
              <mi:MaterialIcon Kind="BackspaceOutline" Width="20" Height="20"
                               Foreground="{DynamicResource TextMutedBrush}"/>
            </Button>
          </Grid>

          <!-- VFD 7-Segment-Display (SkiaSharp-Overlay) -->
          <Border Grid.Row="1" Height="56" Margin="0,4,0,0"
                  ClipToBounds="True" CornerRadius="8"
                  Background="#0A0A0A">
            <skia:SKCanvasView x:Name="VfdCanvas" AutomationProperties.AutomationId="Calc_VfdDisplay" PaintSurface="OnPaintVfd" />
          </Border>

          <!-- Main display (unsichtbar, wird für Messung/Fallback benötigt) -->
          <TextBlock Grid.Row="1"
                     x:Name="DisplayText"
                     AutomationProperties.AutomationId="Calc_DisplayText"
                     Text="{Binding Display}"
                     FontSize="{Binding DisplayFontSize}"
                     FontFamily="JetBrains Mono, Consolas, monospace"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Right"
                     Margin="0,4,0,0"
                     Opacity="0"
                     IsHitTestVisible="False"
                     TextTrimming="CharacterEllipsis"
                     RenderTransformOrigin="1,0.5">
            <TextBlock.Transitions>
              <Transitions>
                <DoubleTransition Property="Opacity" Duration="0:0:0.2" Easing="CubicEaseOut"/>
              </Transitions>
            </TextBlock.Transitions>
          </TextBlock>

          <!-- Live Preview -->
          <TextBlock Grid.Row="2"
                     AutomationProperties.AutomationId="Calc_PreviewResult"
                     Text="{Binding PreviewResult}"
                     FontSize="16"
                     Foreground="{DynamicResource TextMutedBrush}"
                     Opacity="0.6"
                     HorizontalAlignment="Right"
                     MinHeight="20"
                     Margin="0,0,0,2"
                     IsVisible="{Binding PreviewResult, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

          <!-- Error message -->
          <TextBlock Grid.Row="3"
                     AutomationProperties.AutomationId="Calc_ErrorMessage"
                     Text="{Binding ErrorMessage}"
                     FontSize="12"
                     Foreground="{DynamicResource ErrorBrush}"
                     IsVisible="{Binding HasError}"
                     HorizontalAlignment="Right"/>
        </Grid>
      </Border>

      <!-- Result-Burst-Overlay (transparent, nur bei Animation sichtbar) -->
      <Border x:Name="BurstOverlay" AutomationProperties.AutomationId="Calc_BurstOverlay" CornerRadius="16" ClipToBounds="True"
              IsHitTestVisible="False" IsVisible="False">
        <skia:SKCanvasView x:Name="BurstCanvas" PaintSurface="OnPaintBurst" />
      </Border>
    </Panel>

    <!-- ============================================ -->
    <!-- 2. Mode Selector + INV + Angle Mode          -->
    <!-- ============================================ -->
    <Grid x:Name="ModeSelector" Grid.Row="1"
          ColumnDefinitions="Auto,Auto,*,Auto,Auto"
          Margin="0,0,0,8">

      <!-- Basic mode button -->
      <Button Grid.Column="0"
              AutomationProperties.AutomationId="Calc_BtnModeBasic"
              Classes="Primary Small"
              Content="{Binding ModeBasicText}"
              IsVisible="{Binding IsBasicMode}"
              Command="{Binding SetModeCommand}"
              CommandParameter="{x:Static vm:CalculatorMode.Basic}"
              Margin="0,0,6,0"/>
      <Button Grid.Column="0"
              AutomationProperties.AutomationId="Calc_BtnModeBasicInactive"
              Classes="Outlined Small"
              Content="{Binding ModeBasicText}"
              IsVisible="{Binding !IsBasicMode}"
              Command="{Binding SetModeCommand}"
              CommandParameter="{x:Static vm:CalculatorMode.Basic}"
              Margin="0,0,6,0"/>

      <!-- Scientific mode button -->
      <Button Grid.Column="1"
              AutomationProperties.AutomationId="Calc_BtnModeScientific"
              Classes="Primary Small"
              Content="{Binding ModeScientificText}"
              IsVisible="{Binding IsScientificMode}"
              Command="{Binding SetModeCommand}"
              CommandParameter="{x:Static vm:CalculatorMode.Scientific}"/>
      <Button Grid.Column="1"
              AutomationProperties.AutomationId="Calc_BtnModeScientificInactive"
              Classes="Outlined Small"
              Content="{Binding ModeScientificText}"
              IsVisible="{Binding !IsScientificMode}"
              Command="{Binding SetModeCommand}"
              CommandParameter="{x:Static vm:CalculatorMode.Scientific}"/>

      <!-- INV toggle (nur im Scientific Mode sichtbar) -->
      <Button Grid.Column="3"
              AutomationProperties.AutomationId="Calc_BtnInverse"
              Classes="Outlined Small"
              Classes.InvActive="{Binding IsInverseMode}"
              Content="INV"
              Command="{Binding ToggleInverseCommand}"
              IsVisible="{Binding IsScientificMode}"
              Margin="0,0,6,0"/>

      <!-- Angle mode toggle (right-aligned) -->
      <Button Grid.Column="4"
              AutomationProperties.AutomationId="Calc_BtnAngleMode"
              Classes="Text Small"
              Content="{Binding AngleModeText}"
              Command="{Binding ToggleAngleModeCommand}"/>
    </Grid>

    <!-- ============================================ -->
    <!-- 3. Scientific Functions Panel (Slide-Animation) -->
    <!-- ============================================ -->
    <Grid x:Name="ScientificPanel" Grid.Row="2"
          RowDefinitions="Auto,Auto,Auto"
          ColumnDefinitions="*,*,*,*,*"
          RowSpacing="6"
          ColumnSpacing="6"
          Margin="0,0,0,8"
          Classes.ScientificVisible="{Binding IsScientificMode}">
      <Grid.Styles>
        <!-- Basis-Zustand: versteckt -->
        <Style Selector="Grid#ScientificPanel">
          <Setter Property="Opacity" Value="0"/>
          <Setter Property="MaxHeight" Value="0"/>
          <Setter Property="IsHitTestVisible" Value="False"/>
          <Setter Property="Transitions">
            <Transitions>
              <DoubleTransition Property="Opacity" Duration="0:0:0.2"/>
              <DoubleTransition Property="MaxHeight" Duration="0:0:0.25" Easing="CubicEaseOut"/>
            </Transitions>
          </Setter>
        </Style>
        <!-- Aktiver Zustand: sichtbar -->
        <Style Selector="Grid#ScientificPanel.ScientificVisible">
          <Setter Property="Opacity" Value="1"/>
          <Setter Property="MaxHeight" Value="500"/>
          <Setter Property="IsHitTestVisible" Value="True"/>
        </Style>
      </Grid.Styles>

      <!-- Row 0: sin/asin, cos/acos, tan/atan, log/10^x, ln/e^x -->
      <Button Grid.Row="0" Grid.Column="0" Content="{Binding SinButtonText}"
              AutomationProperties.AutomationId="Calc_BtnSin"
              Classes="Outlined Small Function"
              Command="{Binding SinOrInverseCommand}"/>
      <Button Grid.Row="0" Grid.Column="1" Content="{Binding CosButtonText}"
              AutomationProperties.AutomationId="Calc_BtnCos"
              Classes="Outlined Small Function"
              Command="{Binding CosOrInverseCommand}"/>
      <Button Grid.Row="0" Grid.Column="2" Content="{Binding TanButtonText}"
              AutomationProperties.AutomationId="Calc_BtnTan"
              Classes="Outlined Small Function"
              Command="{Binding TanOrInverseCommand}"/>
      <Button Grid.Row="0" Grid.Column="3" Content="{Binding LogButtonText}"
              AutomationProperties.AutomationId="Calc_BtnLog"
              Classes="Outlined Small Function"
              Command="{Binding LogOrInverseCommand}"/>
      <Button Grid.Row="0" Grid.Column="4" Content="{Binding LnButtonText}"
              AutomationProperties.AutomationId="Calc_BtnLn"
              Classes="Outlined Small Function"
              Command="{Binding LnOrInverseCommand}"/>

      <!-- Row 1: (, ), x^y, 1/x, Ans -->
      <Button Grid.Row="1" Grid.Column="0" Content="("
              AutomationProperties.AutomationId="Calc_BtnParenOpen"
              Classes="Outlined Small Function"
              Command="{Binding InputParenthesisCommand}"
              CommandParameter="("/>
      <Button Grid.Row="1" Grid.Column="1" Content=")"
              AutomationProperties.AutomationId="Calc_BtnParenClose"
              Classes="Outlined Small Function"
              Command="{Binding InputParenthesisCommand}"
              CommandParameter=")"/>
      <Button Grid.Row="1" Grid.Column="2" Content="x&#x02B8;"
              AutomationProperties.AutomationId="Calc_BtnPower"
              Classes="Outlined Small Function"
              Command="{Binding PowerCommand}"/>
      <Button Grid.Row="1" Grid.Column="3" Content="1/x"
              AutomationProperties.AutomationId="Calc_BtnReciprocal"
              Classes="Outlined Small Function"
              Command="{Binding ReciprocalCommand}"/>
      <Button Grid.Row="1" Grid.Column="4" Content="Ans"
              AutomationProperties.AutomationId="Calc_BtnAns"
              Classes="Outlined Small Function"
              Command="{Binding AnsCommand}"/>

      <!-- Row 2: pi, e, x^2, sqrt(x), x! -->
      <Button Grid.Row="2" Grid.Column="0" Content="&#x03C0;"
              AutomationProperties.AutomationId="Calc_BtnPi"
              Classes="Outlined Small Function"
              Command="{Binding PiCommand}"/>
      <Button Grid.Row="2" Grid.Column="1" Content="e"
              AutomationProperties.AutomationId="Calc_BtnEuler"
              Classes="Outlined Small Function"
              Command="{Binding EulerCommand}"/>
      <Button Grid.Row="2" Grid.Column="2" Content="x&#x00B2;"
              AutomationProperties.AutomationId="Calc_BtnSquare"
              Classes="Outlined Small Function"
              Command="{Binding SquareCommand}"/>
      <Button Grid.Row="2" Grid.Column="3" Content="&#x221A;x"
              AutomationProperties.AutomationId="Calc_BtnSqrt"
              Classes="Outlined Small Function"
              Command="{Binding SquareRootCommand}"/>
      <Button Grid.Row="2" Grid.Column="4" Content="x!"
              AutomationProperties.AutomationId="Calc_BtnFactorial"
              Classes="Outlined Small Function"
              Command="{Binding FactorialCommand}"/>
    </Grid>

    <!-- ============================================ -->
    <!-- 4. Memory Row (dezent wenn leer)             -->
    <!-- ============================================ -->
    <Grid x:Name="MemoryRowGrid" Grid.Row="3"
          Classes="MemoryRow"
          Classes.MemoryActive="{Binding HasMemory}"
          ColumnDefinitions="*,*,*,*,*"
          ColumnSpacing="6"
          Margin="0,0,0,8">

      <Button Grid.Column="0" Content="MC"
              AutomationProperties.AutomationId="Calc_BtnMemoryClear"
              Classes="Text Small"
              Command="{Binding MemoryClearCommand}"/>
      <Button Grid.Column="1" Content="MR"
              AutomationProperties.AutomationId="Calc_BtnMemoryRecall"
              Classes="Text Small"
              Command="{Binding MemoryRecallCommand}"/>
      <Button Grid.Column="2" Content="M+"
              AutomationProperties.AutomationId="Calc_BtnMemoryAdd"
              Classes="Text Small"
              Command="{Binding MemoryAddCommand}"/>
      <Button Grid.Column="3" Content="M-"
              AutomationProperties.AutomationId="Calc_BtnMemorySubtract"
              Classes="Text Small"
              Command="{Binding MemorySubtractCommand}"/>
      <Button Grid.Column="4" Content="MS"
              AutomationProperties.AutomationId="Calc_BtnMemoryStore"
              Classes="Text Small"
              Command="{Binding MemoryStoreCommand}"/>
    </Grid>

    <!-- ============================================ -->
    <!-- 5. Main Calculator Button Grid               -->
    <!-- ============================================ -->
    <Grid x:Name="BasicGrid" Grid.Row="4"
          RowDefinitions="*,*,*,*,*"
          ColumnDefinitions="*,*,*,*"
          RowSpacing="8"
          ColumnSpacing="8">

      <!-- Row 0: C, ( ), %, ÷ -->
      <Button Grid.Row="0" Grid.Column="0"
              AutomationProperties.AutomationId="Calc_BtnClear"
              Content="C"
              Classes="Secondary CalcButton"
              FontSize="18"
              FontWeight="SemiBold"
              Command="{Binding ClearCommand}"/>
      <Button Grid.Row="0" Grid.Column="1"
              AutomationProperties.AutomationId="Calc_BtnSmartParenthesis"
              Content="( )"
              Classes="Outlined CalcButton"
              FontSize="18"
              Command="{Binding InputSmartParenthesisCommand}"/>
      <Button Grid.Row="0" Grid.Column="2"
              AutomationProperties.AutomationId="Calc_BtnPercent"
              Content="%"
              Classes="Outlined CalcButton"
              FontSize="18"
              Command="{Binding PercentCommand}"/>
      <Button Grid.Row="0" Grid.Column="3"
              AutomationProperties.AutomationId="Calc_BtnDivide"
              Content="&#x00F7;"
              Classes="Primary Operator CalcButton"
              Classes.ActiveOp="{Binding IsDivideActive}"
              Command="{Binding InputOperatorCommand}"
              CommandParameter="&#x00F7;"/>

      <!-- Row 1: 7, 8, 9, Multiply -->
      <Button Grid.Row="1" Grid.Column="0"
              AutomationProperties.AutomationId="Calc_Btn7"
              Content="7"
              Classes="Digit CalcButton"
              Command="{Binding InputDigitCommand}"
              CommandParameter="7"/>
      <Button Grid.Row="1" Grid.Column="1"
              AutomationProperties.AutomationId="Calc_Btn8"
              Content="8"
              Classes="Digit CalcButton"
              Command="{Binding InputDigitCommand}"
              CommandParameter="8"/>
      <Button Grid.Row="1" Grid.Column="2"
              AutomationProperties.AutomationId="Calc_Btn9"
              Content="9"
              Classes="Digit CalcButton"
              Command="{Binding InputDigitCommand}"
              CommandParameter="9"/>
      <Button Grid.Row="1" Grid.Column="3"
              AutomationProperties.AutomationId="Calc_BtnMultiply"
              Content="&#x00D7;"
              Classes="Primary Operator CalcButton"
              Classes.ActiveOp="{Binding IsMultiplyActive}"
              Command="{Binding InputOperatorCommand}"
              CommandParameter="&#x00D7;"/>

      <!-- Row 2: 4, 5, 6, Subtract -->
      <Button Grid.Row="2" Grid.Column="0"
              AutomationProperties.AutomationId="Calc_Btn4"
              Content="4"
              Classes="Digit CalcButton"
              Command="{Binding InputDigitCommand}"
              CommandParameter="4"/>
      <Button Grid.Row="2" Grid.Column="1"
              AutomationProperties.AutomationId="Calc_Btn5"
              Content="5"
              Classes="Digit CalcButton"
              Command="{Binding InputDigitCommand}"
              CommandParameter="5"/>
      <Button Grid.Row="2" Grid.Column="2"
              AutomationProperties.AutomationId="Calc_Btn6"
              Content="6"
              Classes="Digit CalcButton"
              Command="{Binding InputDigitCommand}"
              CommandParameter="6"/>
      <Button Grid.Row="2" Grid.Column="3"
              AutomationProperties.AutomationId="Calc_BtnSubtract"
              Content="&#x2212;"
              Classes="Primary Operator CalcButton"
              Classes.ActiveOp="{Binding IsSubtractActive}"
              Command="{Binding InputOperatorCommand}"
              CommandParameter="&#x2212;"/>

      <!-- Row 3: 1, 2, 3, Add -->
      <Button Grid.Row="3" Grid.Column="0"
              AutomationProperties.AutomationId="Calc_Btn1"
              Content="1"
              Classes="Digit CalcButton"
              Command="{Binding InputDigitCommand}"
              CommandParameter="1"/>
      <Button Grid.Row="3" Grid.Column="1"
              AutomationProperties.AutomationId="Calc_Btn2"
              Content="2"
              Classes="Digit CalcButton"
              Command="{Binding InputDigitCommand}"
              CommandParameter="2"/>
      <Button Grid.Row="3" Grid.Column="2"
              AutomationProperties.AutomationId="Calc_Btn3"
              Content="3"
              Classes="Digit CalcButton"
              Command="{Binding InputDigitCommand}"
              CommandParameter="3"/>
      <Button Grid.Row="3" Grid.Column="3"
              AutomationProperties.AutomationId="Calc_BtnAdd"
              Content="+"
              Classes="Primary Operator CalcButton"
              Classes.ActiveOp="{Binding IsAddActive}"
              Command="{Binding InputOperatorCommand}"
              CommandParameter="+"/>

      <!-- Row 4: Negate, 0, Decimal, Equals -->
      <Button Grid.Row="4" Grid.Column="0"
              AutomationProperties.AutomationId="Calc_BtnNegate"
              Content="&#x00B1;"
              Classes="Digit CalcButton"
              Command="{Binding NegateCommand}"/>
      <Button Grid.Row="4" Grid.Column="1"
              AutomationProperties.AutomationId="Calc_Btn0"
              Content="0"
              Classes="Digit CalcButton"
              Command="{Binding InputDigitCommand}"
              CommandParameter="0"/>
      <Button Grid.Row="4" Grid.Column="2"
              AutomationProperties.AutomationId="Calc_BtnDecimal"
              Content="{Binding DecimalButtonText}"
              Classes="Digit CalcButton"
              Command="{Binding InputDecimalCommand}"/>
      <Button Grid.Row="4" Grid.Column="3"
              x:Name="EqualsButton"
              AutomationProperties.AutomationId="Calc_BtnEquals"
              Content="="
              Classes="Primary Operator CalcButton Equals"
              Command="{Binding CalculateCommand}"/>
    </Grid>

  </Grid>

</UserControl>
