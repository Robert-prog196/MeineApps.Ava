<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:HandwerkerRechner.ViewModels"
             xmlns:floorVm="using:HandwerkerRechner.ViewModels.Floor"
             xmlns:premVm="using:HandwerkerRechner.ViewModels.Premium"
             xmlns:views="using:HandwerkerRechner.Views"
             xmlns:floorViews="using:HandwerkerRechner.Views.Floor"
             xmlns:premViews="using:HandwerkerRechner.Views.Premium"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             xmlns:controls="using:MeineApps.UI.Controls"
             x:Class="HandwerkerRechner.Views.MainView"
             x:DataType="vm:MainViewModel"
             Background="{DynamicResource BackgroundBrush}">

  <UserControl.Styles>
    <Style Selector="Border.TabContent">
      <Setter Property="Transitions">
        <Transitions>
          <DoubleTransition Property="Opacity" Duration="0:0:0.15" />
        </Transitions>
      </Setter>
    </Style>
    <Style Selector="Border.TabContent:not(.Active)">
      <Setter Property="Opacity" Value="0" />
      <Setter Property="IsHitTestVisible" Value="False" />
      <Setter Property="IsVisible" Value="False" />
    </Style>
    <Style Selector="Border.TabContent.Active">
      <Setter Property="Opacity" Value="1" />
      <Setter Property="IsHitTestVisible" Value="True" />
      <Setter Property="IsVisible" Value="True" />
    </Style>
  </UserControl.Styles>

  <UserControl.DataTemplates>
    <!-- Floor Calculator VMs → Views -->
    <DataTemplate DataType="floorVm:TileCalculatorViewModel">
      <floorViews:TileCalculatorView />
    </DataTemplate>
    <DataTemplate DataType="floorVm:WallpaperCalculatorViewModel">
      <floorViews:WallpaperCalculatorView />
    </DataTemplate>
    <DataTemplate DataType="floorVm:PaintCalculatorViewModel">
      <floorViews:PaintCalculatorView />
    </DataTemplate>
    <DataTemplate DataType="floorVm:FlooringCalculatorViewModel">
      <floorViews:FlooringCalculatorView />
    </DataTemplate>
    <!-- Premium Calculator VMs → Views -->
    <DataTemplate DataType="premVm:DrywallViewModel">
      <premViews:DrywallView />
    </DataTemplate>
    <DataTemplate DataType="premVm:ElectricalViewModel">
      <premViews:ElectricalView />
    </DataTemplate>
    <DataTemplate DataType="premVm:MetalViewModel">
      <premViews:MetalView />
    </DataTemplate>
    <DataTemplate DataType="premVm:GardenViewModel">
      <premViews:GardenView />
    </DataTemplate>
    <DataTemplate DataType="premVm:RoofSolarViewModel">
      <premViews:RoofSolarView />
    </DataTemplate>
  </UserControl.DataTemplates>

  <Grid RowDefinitions="*,Auto,Auto">

    <!-- Content Area -->
    <Panel Grid.Row="0">

      <!-- Tab 0: Home -->
      <Border Classes="TabContent"
              Classes.Active="{Binding IsHomeTab}">
        <ScrollViewer>
          <StackPanel Spacing="0">

            <!-- ========== Hero-Header (Amber/Orange Gradient) ========== -->
            <Border CornerRadius="0,0,16,16" Padding="20,20,20,16">
              <Border.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                  <GradientStop Color="#F59E0B" Offset="0" />
                  <GradientStop Color="{DynamicResource SecondaryColor}" Offset="0.5" />
                  <GradientStop Color="{DynamicResource AccentColor}" Offset="1" />
                </LinearGradientBrush>
              </Border.Background>
              <StackPanel Spacing="8" HorizontalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
                  <Border Width="36" Height="36" CornerRadius="18" Background="#33FFFFFF">
                    <mi:MaterialIcon Kind="RulerSquareCompass" Width="20" Height="20"
                                     Foreground="White"
                                     HorizontalAlignment="Center" VerticalAlignment="Center" />
                  </Border>
                  <TextBlock Text="{Binding AppTitle}"
                             FontSize="20" FontWeight="Bold" Foreground="White"
                             VerticalAlignment="Center" />
                </StackPanel>
                <TextBlock Text="{Binding AppDescription}"
                           FontSize="13" Foreground="#BBFFFFFF"
                           HorizontalAlignment="Center" TextAlignment="Center"
                           TextWrapping="Wrap" MaxWidth="300" />
                <TextBlock Text="{Binding CalculatorCountText}"
                           FontSize="12" Foreground="#99FFFFFF"
                           HorizontalAlignment="Center" />
              </StackPanel>
            </Border>

            <!-- ========== Content ========== -->
            <StackPanel Spacing="16" Margin="16,16,16,0">

              <!-- ========== Section: Boden & Wand ========== -->
              <StackPanel Spacing="12">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Border Background="#F59E0B" CornerRadius="6" Padding="8,4">
                    <TextBlock Text="{Binding SectionFloorWallText}" FontSize="11" FontWeight="Bold" Foreground="White" />
                  </Border>
                  <TextBlock Text="{Binding CategoryFloorWallLabel}"
                             FontSize="18" FontWeight="Bold"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             VerticalAlignment="Center" />
                </StackPanel>

                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                  <!-- Fliesen -->
                  <Button Grid.Row="0" Grid.Column="0"
                          CornerRadius="12" Height="120" Padding="8"
                          HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                          Command="{Binding NavigateToTilesCommand}">
                    <Button.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                        <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                      </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel VerticalAlignment="Center" Spacing="8">
                      <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                        <Border.Background>
                          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Color="#F59E0B" Offset="0" />
                            <GradientStop Color="#D97706" Offset="1" />
                          </LinearGradientBrush>
                        </Border.Background>
                        <mi:MaterialIcon Kind="ViewGrid" Width="24" Height="24"
                                         Foreground="White"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <TextBlock Text="{Binding CalcTilesLabel}"
                                 FontSize="13" FontWeight="Bold" TextAlignment="Center"
                                 Foreground="{DynamicResource TextPrimaryBrush}" />
                    </StackPanel>
                  </Button>

                  <!-- Tapete -->
                  <Button Grid.Row="0" Grid.Column="1"
                          CornerRadius="12" Height="120" Padding="8"
                          HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                          Command="{Binding NavigateToWallpaperCommand}">
                    <Button.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                        <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                      </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel VerticalAlignment="Center" Spacing="8">
                      <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                        <Border.Background>
                          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Color="#8B5CF6" Offset="0" />
                            <GradientStop Color="#7C3AED" Offset="1" />
                          </LinearGradientBrush>
                        </Border.Background>
                        <mi:MaterialIcon Kind="Wallpaper" Width="24" Height="24"
                                         Foreground="White"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <TextBlock Text="{Binding CalcWallpaperLabel}"
                                 FontSize="13" FontWeight="Bold" TextAlignment="Center"
                                 Foreground="{DynamicResource TextPrimaryBrush}" />
                    </StackPanel>
                  </Button>

                  <!-- Farbe -->
                  <Button Grid.Row="1" Grid.Column="0"
                          CornerRadius="12" Height="120" Padding="8"
                          HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                          Command="{Binding NavigateToPaintCommand}">
                    <Button.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                        <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                      </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel VerticalAlignment="Center" Spacing="8">
                      <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                        <Border.Background>
                          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Color="#22C55E" Offset="0" />
                            <GradientStop Color="#16A34A" Offset="1" />
                          </LinearGradientBrush>
                        </Border.Background>
                        <mi:MaterialIcon Kind="FormatPaint" Width="24" Height="24"
                                         Foreground="White"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <TextBlock Text="{Binding CalcPaintLabel}"
                                 FontSize="13" FontWeight="Bold" TextAlignment="Center"
                                 Foreground="{DynamicResource TextPrimaryBrush}" />
                    </StackPanel>
                  </Button>

                  <!-- Boden -->
                  <Button Grid.Row="1" Grid.Column="1"
                          CornerRadius="12" Height="120" Padding="8"
                          HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                          Command="{Binding NavigateToFlooringCommand}">
                    <Button.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                        <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                      </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel VerticalAlignment="Center" Spacing="8">
                      <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                        <Border.Background>
                          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Color="#3B82F6" Offset="0" />
                            <GradientStop Color="#2563EB" Offset="1" />
                          </LinearGradientBrush>
                        </Border.Background>
                        <mi:MaterialIcon Kind="Layers" Width="24" Height="24"
                                         Foreground="White"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <TextBlock Text="{Binding CalcFlooringLabel}"
                                 FontSize="13" FontWeight="Bold" TextAlignment="Center"
                                 Foreground="{DynamicResource TextPrimaryBrush}" />
                    </StackPanel>
                  </Button>
                </Grid>
              </StackPanel>

              <!-- ========== Section: Profi-Werkzeuge ========== -->
              <StackPanel Spacing="12">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Border Background="{DynamicResource AccentBrush}" CornerRadius="6" Padding="8,4">
                    <TextBlock Text="{Binding SectionPremiumToolsText}" FontSize="11" FontWeight="Bold" Foreground="White" />
                  </Border>
                  <TextBlock Text="{Binding MoreCategoriesLabel}"
                             FontSize="18" FontWeight="Bold"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             VerticalAlignment="Center" />
                </StackPanel>

                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                  <!-- Trockenbau -->
                  <Button Grid.Row="0" Grid.Column="0"
                          CornerRadius="12" Height="120" Padding="8"
                          HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                          Command="{Binding NavigateToDrywallCommand}">
                    <Button.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                        <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                      </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel VerticalAlignment="Center" Spacing="8">
                      <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                        <Border.Background>
                          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Color="#EF4444" Offset="0" />
                            <GradientStop Color="#DC2626" Offset="1" />
                          </LinearGradientBrush>
                        </Border.Background>
                        <mi:MaterialIcon Kind="Wall" Width="24" Height="24"
                                         Foreground="White"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <TextBlock Text="{Binding CategoryDrywallLabel}"
                                 FontSize="13" FontWeight="Bold" TextAlignment="Center"
                                 Foreground="{DynamicResource TextPrimaryBrush}" />
                    </StackPanel>
                  </Button>

                  <!-- Elektro -->
                  <Button Grid.Row="0" Grid.Column="1"
                          CornerRadius="12" Height="120" Padding="8"
                          HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                          Command="{Binding NavigateToElectricalCommand}">
                    <Button.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                        <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                      </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel VerticalAlignment="Center" Spacing="8">
                      <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                        <Border.Background>
                          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Color="#F97316" Offset="0" />
                            <GradientStop Color="#EA580C" Offset="1" />
                          </LinearGradientBrush>
                        </Border.Background>
                        <mi:MaterialIcon Kind="Flash" Width="24" Height="24"
                                         Foreground="White"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <TextBlock Text="{Binding CategoryElectricalLabel}"
                                 FontSize="13" FontWeight="Bold" TextAlignment="Center"
                                 Foreground="{DynamicResource TextPrimaryBrush}" />
                    </StackPanel>
                  </Button>

                  <!-- Metall -->
                  <Button Grid.Row="1" Grid.Column="0"
                          CornerRadius="12" Height="120" Padding="8"
                          HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                          Command="{Binding NavigateToMetalCommand}">
                    <Button.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                        <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                      </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel VerticalAlignment="Center" Spacing="8">
                      <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                        <Border.Background>
                          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Color="#6B7280" Offset="0" />
                            <GradientStop Color="#4B5563" Offset="1" />
                          </LinearGradientBrush>
                        </Border.Background>
                        <mi:MaterialIcon Kind="Wrench" Width="24" Height="24"
                                         Foreground="White"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <TextBlock Text="{Binding CategoryMetalLabel}"
                                 FontSize="13" FontWeight="Bold" TextAlignment="Center"
                                 Foreground="{DynamicResource TextPrimaryBrush}" />
                    </StackPanel>
                  </Button>

                  <!-- Garten -->
                  <Button Grid.Row="1" Grid.Column="1"
                          CornerRadius="12" Height="120" Padding="8"
                          HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                          Command="{Binding NavigateToGardenCommand}">
                    <Button.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                        <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                      </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel VerticalAlignment="Center" Spacing="8">
                      <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                        <Border.Background>
                          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Color="#10B981" Offset="0" />
                            <GradientStop Color="#059669" Offset="1" />
                          </LinearGradientBrush>
                        </Border.Background>
                        <mi:MaterialIcon Kind="Flower" Width="24" Height="24"
                                         Foreground="White"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <TextBlock Text="{Binding CategoryGardenLabel}"
                                 FontSize="13" FontWeight="Bold" TextAlignment="Center"
                                 Foreground="{DynamicResource TextPrimaryBrush}" />
                    </StackPanel>
                  </Button>

                  <!-- Dach/Solar -->
                  <Button Grid.Row="2" Grid.Column="0"
                          CornerRadius="12" Height="120" Padding="8"
                          HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                          Command="{Binding NavigateToRoofSolarCommand}">
                    <Button.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                        <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                      </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel VerticalAlignment="Center" Spacing="8">
                      <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                        <Border.Background>
                          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Color="#06B6D4" Offset="0" />
                            <GradientStop Color="#0891B2" Offset="1" />
                          </LinearGradientBrush>
                        </Border.Background>
                        <mi:MaterialIcon Kind="SolarPanel" Width="24" Height="24"
                                         Foreground="White"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <TextBlock Text="{Binding CategoryRoofSolarLabel}"
                                 FontSize="13" FontWeight="Bold" TextAlignment="Center"
                                 Foreground="{DynamicResource TextPrimaryBrush}" />
                    </StackPanel>
                  </Button>
                </Grid>
              </StackPanel>

              <!-- ========== Premium-Card ========== -->
              <Button Background="Transparent" Padding="0"
                      HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                      IsVisible="{Binding !IsPremium}"
                      Command="{Binding PurchaseRemoveAdsCommand}">
                <Border CornerRadius="16" Padding="16" ClipToBounds="True">
                  <Border.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                      <GradientStop Color="{DynamicResource AccentColor}" Offset="0" />
                      <GradientStop Color="{DynamicResource SecondaryColor}" Offset="1" />
                    </LinearGradientBrush>
                  </Border.Background>
                  <Panel>
                    <Ellipse Width="100" Height="100"
                             Opacity="0.1" Fill="White"
                             HorizontalAlignment="Right" VerticalAlignment="Center"
                             Margin="0,0,-20,0" />
                    <Grid ColumnDefinitions="Auto,*,Auto">
                      <Border Grid.Column="0" Width="44" Height="44"
                              CornerRadius="22" Background="#33FFFFFF"
                              Margin="0,0,14,0">
                        <mi:MaterialIcon Kind="Star" Width="24" Height="24"
                                         Foreground="White"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                        <TextBlock Text="{Binding GetPremiumText}"
                                   FontSize="15" FontWeight="Bold" Foreground="White" />
                        <TextBlock Text="{Binding PremiumPriceText}"
                                   FontSize="12" Foreground="#CCFFFFFF" />
                      </StackPanel>
                      <mi:MaterialIcon Grid.Column="2"
                                       Kind="ChevronRight" Width="20" Height="20"
                                       Foreground="#AAFFFFFF" VerticalAlignment="Center" />
                    </Grid>
                  </Panel>
                </Border>
              </Button>

              <!-- ========== Extended History Card ========== -->
              <Button Background="Transparent" Padding="0"
                      HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                      IsVisible="{Binding !IsPremium}"
                      Command="{Binding ShowExtendedHistoryAdCommand}">
                <Border Classes="Card" CornerRadius="12" Padding="14">
                  <Grid ColumnDefinitions="Auto,*,Auto">
                    <Border Grid.Column="0" Width="40" Height="40"
                            CornerRadius="20" Margin="0,0,12,0">
                      <Border.Background>
                        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                          <GradientStop Color="#3B82F6" Offset="0" />
                          <GradientStop Color="#1D4ED8" Offset="1" />
                        </LinearGradientBrush>
                      </Border.Background>
                      <mi:MaterialIcon Kind="History" Width="22" Height="22"
                                       Foreground="White"
                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                      <TextBlock Text="{Binding ExtendedHistoryTitleText}"
                                 FontSize="14" FontWeight="Bold"
                                 Foreground="{DynamicResource TextPrimaryBrush}" />
                      <TextBlock Text="{Binding ExtendedHistoryDescText}"
                                 FontSize="12"
                                 Foreground="{DynamicResource TextSecondaryBrush}"
                                 TextTrimming="CharacterEllipsis"
                                 MaxLines="2" />
                    </StackPanel>
                    <mi:MaterialIcon Grid.Column="2"
                                     Kind="ChevronRight" Width="18" Height="18"
                                     Foreground="{DynamicResource TextMutedBrush}"
                                     VerticalAlignment="Center" />
                  </Grid>
                </Border>
              </Button>

            </StackPanel>

            <!-- Abstand unten (60dp fuer Ad-Banner Overlay) -->
            <Border Height="60" />

          </StackPanel>
        </ScrollViewer>
      </Border>

      <!-- Tab 1: Projects -->
      <Border Classes="TabContent"
              Classes.Active="{Binding IsProjectsTab}">
        <views:ProjectsView DataContext="{Binding ProjectsViewModel}" />
      </Border>

      <!-- Tab 2: Settings -->
      <Border Classes="TabContent"
              Classes.Active="{Binding IsSettingsTab}">
        <views:SettingsView DataContext="{Binding SettingsViewModel}" />
      </Border>

      <!-- Calculator Overlay -->
      <Panel IsVisible="{Binding IsCalculatorOpen}"
             ZIndex="50"
             Background="{DynamicResource BackgroundBrush}">
        <ContentControl Content="{Binding CurrentCalculatorVm}" />
      </Panel>

      <!-- Premium Access Overlay -->
      <Border IsVisible="{Binding ShowPremiumAccessOverlay}"
              Background="#CC000000"
              ZIndex="100">
        <Border Background="{DynamicResource CardBrush}"
                CornerRadius="16"
                Padding="24"
                MaxWidth="340"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
          <StackPanel Spacing="16" HorizontalAlignment="Center">
            <TextBlock Text="{Binding PremiumLockedText}"
                       FontSize="22" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       HorizontalAlignment="Center"
                       TextWrapping="Wrap" TextAlignment="Center" />

            <Border Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="30"
                    Width="60" Height="60"
                    HorizontalAlignment="Center">
              <mi:MaterialIcon Kind="Lock" Width="32" Height="32"
                               Foreground="{DynamicResource AccentBrush}" />
            </Border>

            <TextBlock Text="{Binding PremiumLockedDescText}"
                       FontSize="14"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center"
                       TextWrapping="Wrap"
                       TextAlignment="Center" />

            <StackPanel Spacing="8">
              <Button Classes="Filled"
                      Command="{Binding ConfirmPremiumAdCommand}"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"
                      Padding="16,12">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <mi:MaterialIcon Kind="Video" Width="20" Height="20" />
                  <TextBlock Text="{Binding VideoFor30MinText}"
                             FontSize="15" FontWeight="SemiBold" />
                </StackPanel>
              </Button>

              <Button Classes="Text"
                      Command="{Binding CancelPremiumAdCommand}"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"
                      Padding="12,10">
                <TextBlock Text="{loc:Translate Cancel}"
                           FontSize="14"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
              </Button>
            </StackPanel>
          </StackPanel>
        </Border>
      </Border>

      <!-- Extended History Overlay -->
      <Border IsVisible="{Binding ShowExtendedHistoryOverlay}"
              Background="#CC000000"
              ZIndex="100">
        <Border Background="{DynamicResource CardBrush}"
                CornerRadius="16"
                Padding="24"
                MaxWidth="340"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
          <StackPanel Spacing="16" HorizontalAlignment="Center">
            <TextBlock Text="{Binding ExtendedHistoryTitleText}"
                       FontSize="22" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       HorizontalAlignment="Center"
                       TextWrapping="Wrap" TextAlignment="Center" />

            <Border Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="30"
                    Width="60" Height="60"
                    HorizontalAlignment="Center">
              <mi:MaterialIcon Kind="History" Width="32" Height="32"
                               Foreground="{DynamicResource AccentBrush}" />
            </Border>

            <TextBlock Text="{Binding ExtendedHistoryDescText}"
                       FontSize="14"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center"
                       TextWrapping="Wrap"
                       TextAlignment="Center" />

            <StackPanel Spacing="8">
              <Button Classes="Filled"
                      Command="{Binding ConfirmExtendedHistoryAdCommand}"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"
                      Padding="16,12">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <mi:MaterialIcon Kind="Video" Width="20" Height="20" />
                  <TextBlock Text="{loc:Translate WatchVideoFor30Min}"
                             FontSize="15" FontWeight="SemiBold" />
                </StackPanel>
              </Button>

              <Button Classes="Text"
                      Command="{Binding CancelExtendedHistoryAdCommand}"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"
                      Padding="12,10">
                <TextBlock Text="{loc:Translate Cancel}"
                           FontSize="14"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
              </Button>
            </StackPanel>
          </StackPanel>
        </Border>
      </Border>

    </Panel>

    <!-- Ad Banner Spacer (50dp for native AdMob overlay) -->
    <Border Grid.Row="1" Height="50"
            IsVisible="{Binding IsAdBannerVisible}" />

    <!-- Ersatz-Spacer wenn Tab-Bar versteckt (Calculator offen) -->
    <!-- Gleiche Hoehe wie Tab-Bar, damit Buttons ueber der nativen Ad bleiben -->
    <Border Grid.Row="2" Height="60"
            IsVisible="{Binding IsCalculatorOpen}" />

    <!-- Bottom Tab Bar -->
    <Border Grid.Row="2"
            Background="{DynamicResource SurfaceBrush}"
            BorderThickness="0,1,0,0"
            BorderBrush="{DynamicResource CardBorderBrush}"
            IsVisible="{Binding !IsCalculatorOpen}">
      <Grid ColumnDefinitions="*,*,*" Margin="0,2">
        <!-- Home Tab -->
        <Button Grid.Column="0" Classes="Text"
                Command="{Binding SelectHomeTabCommand}"
                HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                Padding="0" Height="56">
          <StackPanel Spacing="2">
            <Border Height="3" CornerRadius="2" Margin="12,0"
                    IsVisible="{Binding IsHomeTab}">
              <Border.Background>
                <SolidColorBrush Color="{DynamicResource PrimaryColor}" />
              </Border.Background>
            </Border>
            <Border Height="3" IsVisible="{Binding !IsHomeTab}" />
            <Panel>
              <mi:MaterialIcon Kind="Home" Width="24" Height="24"
                               Foreground="{DynamicResource PrimaryBrush}"
                               IsVisible="{Binding IsHomeTab}" />
              <mi:MaterialIcon Kind="HomeOutline" Width="24" Height="24"
                               Foreground="{DynamicResource TextMutedBrush}"
                               IsVisible="{Binding !IsHomeTab}" />
            </Panel>
            <Panel>
              <TextBlock Text="{Binding TabHomeText}" FontSize="11"
                         HorizontalAlignment="Center"
                         Foreground="{DynamicResource PrimaryBrush}"
                         FontWeight="Medium"
                         IsVisible="{Binding IsHomeTab}" />
              <TextBlock Text="{Binding TabHomeText}" FontSize="11"
                         HorizontalAlignment="Center"
                         Foreground="{DynamicResource TextMutedBrush}"
                         IsVisible="{Binding !IsHomeTab}" />
            </Panel>
          </StackPanel>
        </Button>

        <!-- Projects Tab -->
        <Button Grid.Column="1" Classes="Text"
                Command="{Binding SelectProjectsTabCommand}"
                HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                Padding="0" Height="56">
          <StackPanel Spacing="2">
            <Border Height="3" CornerRadius="2" Margin="12,0"
                    IsVisible="{Binding IsProjectsTab}">
              <Border.Background>
                <SolidColorBrush Color="{DynamicResource PrimaryColor}" />
              </Border.Background>
            </Border>
            <Border Height="3" IsVisible="{Binding !IsProjectsTab}" />
            <Panel>
              <mi:MaterialIcon Kind="FolderOpen" Width="24" Height="24"
                               Foreground="{DynamicResource PrimaryBrush}"
                               IsVisible="{Binding IsProjectsTab}" />
              <mi:MaterialIcon Kind="FolderOutline" Width="24" Height="24"
                               Foreground="{DynamicResource TextMutedBrush}"
                               IsVisible="{Binding !IsProjectsTab}" />
            </Panel>
            <Panel>
              <TextBlock Text="{Binding TabProjectsText}" FontSize="11"
                         HorizontalAlignment="Center"
                         Foreground="{DynamicResource PrimaryBrush}"
                         FontWeight="Medium"
                         IsVisible="{Binding IsProjectsTab}" />
              <TextBlock Text="{Binding TabProjectsText}" FontSize="11"
                         HorizontalAlignment="Center"
                         Foreground="{DynamicResource TextMutedBrush}"
                         IsVisible="{Binding !IsProjectsTab}" />
            </Panel>
          </StackPanel>
        </Button>

        <!-- Settings Tab -->
        <Button Grid.Column="2" Classes="Text"
                Command="{Binding SelectSettingsTabCommand}"
                HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                Padding="0" Height="56">
          <StackPanel Spacing="2">
            <Border Height="3" CornerRadius="2" Margin="12,0"
                    IsVisible="{Binding IsSettingsTab}">
              <Border.Background>
                <SolidColorBrush Color="{DynamicResource PrimaryColor}" />
              </Border.Background>
            </Border>
            <Border Height="3" IsVisible="{Binding !IsSettingsTab}" />
            <Panel>
              <mi:MaterialIcon Kind="Cog" Width="24" Height="24"
                               Foreground="{DynamicResource PrimaryBrush}"
                               IsVisible="{Binding IsSettingsTab}" />
              <mi:MaterialIcon Kind="CogOutline" Width="24" Height="24"
                               Foreground="{DynamicResource TextMutedBrush}"
                               IsVisible="{Binding !IsSettingsTab}" />
            </Panel>
            <Panel>
              <TextBlock Text="{Binding TabSettingsText}" FontSize="11"
                         HorizontalAlignment="Center"
                         Foreground="{DynamicResource PrimaryBrush}"
                         FontWeight="Medium"
                         IsVisible="{Binding IsSettingsTab}" />
              <TextBlock Text="{Binding TabSettingsText}" FontSize="11"
                         HorizontalAlignment="Center"
                         Foreground="{DynamicResource TextMutedBrush}"
                         IsVisible="{Binding !IsSettingsTab}" />
            </Panel>
          </StackPanel>
        </Button>
      </Grid>
    </Border>

    <!-- Game Juice Overlays -->
    <controls:FloatingTextOverlay x:Name="FloatingTextCanvas"
                                  Grid.RowSpan="3" ZIndex="15"
                                  IsHitTestVisible="False" />
    <controls:CelebrationOverlay x:Name="CelebrationCanvas"
                                 Grid.RowSpan="3" ZIndex="16"
                                 IsHitTestVisible="False" />

  </Grid>

</UserControl>
