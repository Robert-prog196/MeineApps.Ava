<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:HandwerkerImperium.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             x:Class="HandwerkerImperium.Views.SeasonalEventView"
             x:DataType="vm:SeasonalEventViewModel">

  <Grid RowDefinitions="Auto,*"
        AutomationProperties.AutomationId="SeasonalEvent_Grid_Root">

    <!-- ================================================================= -->
    <!-- HEADER / SAISONALES BANNER                                        -->
    <!-- ================================================================= -->
    <Border Grid.Row="0"
            AutomationProperties.AutomationId="SeasonalEvent_Border_Header"
            Padding="16,12"
            CornerRadius="0,0,12,12">
      <Border.Background>
        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
          <GradientStop Color="#92400E" Offset="0" />
          <GradientStop Color="#451A03" Offset="1" />
        </LinearGradientBrush>
      </Border.Background>
      <Grid RowDefinitions="Auto,Auto" RowSpacing="6">
        <Grid ColumnDefinitions="Auto,*,Auto">

          <!-- Zurueck-Button -->
          <Button Classes="Text"
                  AutomationProperties.AutomationId="SeasonalEvent_Btn_Back"
                  Command="{Binding GoBackCommand}">
            <mi:MaterialIcon Kind="ArrowLeft" Width="24" Height="24"
                             AutomationProperties.AutomationId="SeasonalEvent_Icon_Back"
                             Foreground="{StaticResource CraftPrimaryLightBrush}" />
          </Button>

          <!-- Event-Name -->
          <StackPanel Grid.Column="1"
                      AutomationProperties.AutomationId="SeasonalEvent_Panel_Title"
                      Orientation="Horizontal"
                      HorizontalAlignment="Center"
                      Spacing="8">
            <mi:MaterialIcon Kind="CalendarStar" Width="28" Height="28"
                             AutomationProperties.AutomationId="SeasonalEvent_Icon_Title"
                             Foreground="{StaticResource CraftGoldBrush}" />
            <TextBlock Text="{Binding EventName}"
                       AutomationProperties.AutomationId="SeasonalEvent_Txt_Title"
                       FontSize="20" FontWeight="Bold"
                       Foreground="{StaticResource CraftPrimaryLightBrush}"
                       VerticalAlignment="Center" />
          </StackPanel>

          <!-- Event-Waehrung -->
          <Border Grid.Column="2"
                  AutomationProperties.AutomationId="SeasonalEvent_Border_Currency"
                  CornerRadius="12" Padding="8,4">
            <Border.Background>
              <SolidColorBrush Color="Black" Opacity="0.25" />
            </Border.Background>
            <StackPanel Orientation="Horizontal" Spacing="4">
              <mi:MaterialIcon Kind="StarCircle" Width="16" Height="16"
                               AutomationProperties.AutomationId="SeasonalEvent_Icon_Currency"
                               Foreground="{StaticResource CraftGoldBrush}" />
              <TextBlock Text="{Binding SeasonCurrency}" FontSize="14" FontWeight="Bold"
                         AutomationProperties.AutomationId="SeasonalEvent_Txt_CurrencyBalance"
                         Foreground="{StaticResource CraftGoldBrush}" />
            </StackPanel>
          </Border>

        </Grid>

        <!-- Timer -->
        <StackPanel Grid.Row="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Spacing="4">
          <mi:MaterialIcon Kind="ClockOutline" Width="14" Height="14"
                           AutomationProperties.AutomationId="SeasonalEvent_Icon_Clock"
                           Foreground="{StaticResource CraftPrimaryLightBrush}" Opacity="0.7" />
          <TextBlock Text="{Binding TimeRemaining}"
                     AutomationProperties.AutomationId="SeasonalEvent_Txt_Timer"
                     FontSize="12"
                     Foreground="{StaticResource CraftPrimaryLightBrush}" Opacity="0.7" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- ================================================================= -->
    <!-- CONTENT - Event-Shop                                              -->
    <!-- ================================================================= -->
    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
      <StackPanel Spacing="16" Margin="16,16,16,80">

        <!-- Shop-Header -->
        <StackPanel Orientation="Horizontal" Spacing="8">
          <Border CornerRadius="4" Padding="6,3"
                  AutomationProperties.AutomationId="SeasonalEvent_Border_ShopIconBg"
                  Background="{StaticResource CraftPrimaryBrush}">
            <mi:MaterialIcon Kind="StorefrontOutline" Width="14" Height="14" Foreground="White"
                             AutomationProperties.AutomationId="SeasonalEvent_Icon_ShopHeader" />
          </Border>
          <TextBlock Text="{loc:Translate EventShop}"
                     AutomationProperties.AutomationId="SeasonalEvent_Txt_ShopHeader"
                     FontSize="18" FontWeight="Bold"
                     Foreground="{StaticResource CraftPrimaryLightBrush}"
                     VerticalAlignment="Center" />
        </StackPanel>

        <!-- Shop-Items als 2-Spalten-Grid -->
        <ItemsControl ItemsSource="{Binding ShopItems}"
                      AutomationProperties.AutomationId="SeasonalEvent_Items_Shop">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <UniformGrid Columns="2" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="vm:SeasonalShopItemDisplay">
              <Border Classes="Card"
                      AutomationProperties.AutomationId="SeasonalEvent_Border_ShopItem"
                      Margin="4" Padding="12"
                      Opacity="{Binding DisplayOpacity}">
                <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="6">

                  <!-- Name -->
                  <TextBlock Text="{Binding Name}"
                             AutomationProperties.AutomationId="SeasonalEvent_Txt_ItemName"
                             FontSize="14" FontWeight="Bold"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             HorizontalAlignment="Center"
                             TextAlignment="Center"
                             TextWrapping="Wrap" MaxLines="2" />

                  <!-- Beschreibung -->
                  <TextBlock Grid.Row="1" Text="{Binding Description}"
                             AutomationProperties.AutomationId="SeasonalEvent_Txt_ItemDesc"
                             FontSize="11"
                             Foreground="{DynamicResource TextSecondaryBrush}"
                             TextAlignment="Center"
                             TextWrapping="Wrap" MaxLines="3" />

                  <!-- Kauf-Button -->
                  <Button Grid.Row="2"
                          Classes="Primary"
                          AutomationProperties.AutomationId="SeasonalEvent_Btn_BuyItem"
                          HorizontalAlignment="Stretch"
                          Padding="8,6"
                          IsVisible="{Binding !IsPurchased}"
                          IsEnabled="{Binding CanAfford}"
                          Command="{Binding $parent[ItemsControl].((vm:SeasonalEventViewModel)DataContext).BuyItemCommand}"
                          CommandParameter="{Binding Id}">
                    <StackPanel Orientation="Horizontal" Spacing="4"
                                HorizontalAlignment="Center">
                      <mi:MaterialIcon Kind="StarCircle" Width="14" Height="14"
                                       Foreground="{StaticResource CraftGoldBrush}" />
                      <TextBlock Text="{Binding CostDisplay}" FontSize="12" FontWeight="SemiBold" />
                    </StackPanel>
                  </Button>

                  <!-- Gekauft-Badge -->
                  <StackPanel Grid.Row="2"
                              Orientation="Horizontal" Spacing="4"
                              HorizontalAlignment="Center"
                              IsVisible="{Binding IsPurchased}">
                    <mi:MaterialIcon Kind="Check" Width="16" Height="16"
                                     AutomationProperties.AutomationId="SeasonalEvent_Icon_Purchased"
                                     Foreground="{DynamicResource SuccessBrush}" />
                    <TextBlock Text="{loc:Translate Purchased}"
                               AutomationProperties.AutomationId="SeasonalEvent_Txt_Purchased"
                               FontSize="12"
                               Foreground="{DynamicResource SuccessBrush}" />
                  </StackPanel>

                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Bottom Spacer -->
        <Border Height="80" AutomationProperties.AutomationId="SeasonalEvent_Border_BottomSpacer" />

      </StackPanel>
    </ScrollViewer>

  </Grid>

</UserControl>
