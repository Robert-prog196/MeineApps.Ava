<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:HandwerkerImperium.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             x:Class="HandwerkerImperium.Views.ShopView"
             x:DataType="vm:ShopViewModel">

  <Grid RowDefinitions="Auto,*">

    <!-- ================================================================= -->
    <!-- HEADER - Hero Banner                                              -->
    <!-- ================================================================= -->
    <Border Grid.Row="0"
            Padding="16,16"
            CornerRadius="0,0,12,12">
      <Border.Background>
        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
          <GradientStop Color="#D97706" Offset="0" />
          <GradientStop Color="#92400E" Offset="1" />
        </LinearGradientBrush>
      </Border.Background>
      <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto" RowSpacing="8">
        <!-- Back Button -->
        <Button Classes="Text"
                Command="{Binding GoBackCommand}">
          <mi:MaterialIcon Kind="ArrowLeft" Width="24" Height="24"
                           Foreground="White" />
        </Button>

        <!-- Title + Schrauben-Icon -->
        <StackPanel Grid.Column="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Spacing="8">
          <mi:MaterialIcon Kind="ScrewFlatTop" Width="32" Height="32"
                           Foreground="{StaticResource CraftGoldBrush}" />
          <TextBlock Text="{loc:Translate Shop}"
                     FontSize="22" FontWeight="Bold"
                     Foreground="White" />
        </StackPanel>

        <!-- Balance Badges -->
        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8"
                    VerticalAlignment="Center">
          <!-- Goldschrauben-Badge -->
          <Border CornerRadius="12" Padding="8,4">
            <Border.Background>
              <SolidColorBrush Color="Black" Opacity="0.25" />
            </Border.Background>
            <StackPanel Orientation="Horizontal" Spacing="4">
              <mi:MaterialIcon Kind="ScrewFlatTop" Width="16" Height="16" Foreground="#FFD700" />
              <TextBlock Text="{Binding GoldenScrewsBalance}" FontSize="14" FontWeight="Bold"
                         Foreground="#FFD700" />
            </StackPanel>
          </Border>
          <!-- Euro-Badge -->
          <Border CornerRadius="12" Padding="8,4">
            <Border.Background>
              <SolidColorBrush Color="Black" Opacity="0.25" />
            </Border.Background>
            <TextBlock Text="{Binding CurrentBalance}"
                       FontSize="14" FontWeight="Bold"
                       Foreground="{DynamicResource SuccessBrush}" />
          </Border>
        </StackPanel>
      </Grid>
    </Border>

    <!-- ================================================================= -->
    <!-- CONTENT                                                           -->
    <!-- ================================================================= -->
    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
      <StackPanel Spacing="16" Margin="16">

        <!-- PREMIUM STATUS (if premium) -->
        <Border Classes="CardElevated"
                IsVisible="{Binding IsPremium}"
                Padding="16">
          <Border.Background>
            <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
              <GradientStop Color="#92400E" Offset="0" />
              <GradientStop Color="#D97706" Offset="1" />
            </LinearGradientBrush>
          </Border.Background>
          <StackPanel Orientation="Horizontal"
                      Spacing="12"
                      HorizontalAlignment="Center">
            <mi:MaterialIcon Kind="Crown" Width="32" Height="32"
                             Foreground="{StaticResource CraftGoldBrush}" />
            <StackPanel>
              <TextBlock Text="{loc:Translate YouArePremium}"
                         FontSize="18" FontWeight="Bold"
                         Foreground="{StaticResource CraftGoldBrush}" />
              <TextBlock Text="{loc:Translate PremiumBenefits}"
                         FontSize="12"
                         Foreground="#FFE0B2" />
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- SHOP ITEMS -->
        <ItemsControl ItemsSource="{Binding ShopItems}">
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="vm:ShopItem">
              <Border Classes="Card" Margin="0,4" Padding="16">
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="16">
                  <!-- Icon mit Craft-Gradient Hintergrund -->
                  <Border CornerRadius="12"
                          Width="60" Height="60"
                          VerticalAlignment="Center">
                    <Border.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="#D97706" Offset="0" />
                        <GradientStop Color="#92400E" Offset="1" />
                      </LinearGradientBrush>
                    </Border.Background>
                    <TextBlock Text="{Binding Icon}"
                               FontSize="28"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center" />
                  </Border>

                  <!-- Info -->
                  <StackPanel Grid.Column="1"
                              VerticalAlignment="Center"
                              Spacing="4">
                    <TextBlock Text="{Binding Name}"
                               FontSize="16" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimaryBrush}" />
                    <TextBlock Text="{Binding Description}"
                               FontSize="12"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               TextWrapping="Wrap"
                               MaxLines="2" />

                    <!-- Ad Reward Badge -->
                    <Border CornerRadius="8"
                            Padding="8,4"
                            HorizontalAlignment="Left"
                            IsVisible="{Binding IsAdReward}">
                      <Border.Background>
                        <SolidColorBrush Color="#D97706" Opacity="0.2" />
                      </Border.Background>
                      <StackPanel Orientation="Horizontal" Spacing="4">
                        <mi:MaterialIcon Kind="Television" Width="10" Height="10"
                                         Foreground="{StaticResource CraftPrimaryLightBrush}" />
                        <TextBlock Text="{loc:Translate WatchAdFree}"
                                   FontSize="10"
                                   Foreground="{StaticResource CraftPrimaryLightBrush}" />
                      </StackPanel>
                    </Border>
                  </StackPanel>

                  <!-- Price/Action -->
                  <StackPanel Grid.Column="2"
                              VerticalAlignment="Center"
                              Spacing="8">
                    <!-- Purchased Badge -->
                    <StackPanel Orientation="Horizontal"
                                Spacing="4"
                                HorizontalAlignment="Center"
                                IsVisible="{Binding IsPurchased}">
                      <mi:MaterialIcon Kind="Check" Width="14" Height="14"
                                       Foreground="{DynamicResource SuccessBrush}" />
                      <TextBlock Text="{loc:Translate Purchased}"
                                 FontSize="12"
                                 Foreground="{DynamicResource SuccessBrush}" />
                    </StackPanel>

                    <!-- Buy Button -->
                    <Button Content="{Binding Price}"
                            Classes="Primary"
                            Padding="16,8"
                            FontSize="12"
                            MinHeight="44"
                            IsVisible="{Binding !IsPurchased}"
                            Command="{Binding $parent[ItemsControl].((vm:ShopViewModel)DataContext).PurchaseItemCommand}"
                            CommandParameter="{Binding .}" />
                  </StackPanel>
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- TOOLS SECTION -->
        <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,16,0,8">
          <Border CornerRadius="4" Padding="6,3"
                  Background="{StaticResource CraftPrimaryBrush}">
            <mi:MaterialIcon Kind="Hammer" Width="14" Height="14" Foreground="White" />
          </Border>
          <TextBlock Text="{loc:Translate Tools}"
                     FontSize="18" FontWeight="Bold"
                     Foreground="{StaticResource CraftPrimaryLightBrush}"
                     VerticalAlignment="Center" />
        </StackPanel>

        <ItemsControl ItemsSource="{Binding Tools}">
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="vm:ToolDisplayItem">
              <Border Classes="Card" Margin="0,4" Padding="12">
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                  <!-- Icon mit Craft-Gradient -->
                  <Border CornerRadius="8" Width="48" Height="48"
                          VerticalAlignment="Center">
                    <Border.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="#D97706" Offset="0" />
                        <GradientStop Color="#B45309" Offset="1" />
                      </LinearGradientBrush>
                    </Border.Background>
                    <mi:MaterialIcon Kind="{Binding IconKind}" Width="24" Height="24"
                                     Foreground="White"
                                     HorizontalAlignment="Center" VerticalAlignment="Center" />
                  </Border>
                  <!-- Info -->
                  <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                      <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="SemiBold"
                                 Foreground="{DynamicResource TextPrimaryBrush}" />
                      <TextBlock Text="{Binding LevelDisplay}" FontSize="12"
                                 Foreground="{StaticResource CraftPrimaryLightBrush}" />
                    </StackPanel>
                    <TextBlock Text="{Binding EffectDescription}" FontSize="11"
                               Foreground="{DynamicResource TextSecondaryBrush}" />
                  </StackPanel>
                  <!-- Upgrade Button (Goldschrauben) -->
                  <Button Grid.Column="2" Padding="12,8"
                          CornerRadius="8"
                          IsVisible="{Binding CanUpgrade}"
                          IsEnabled="{Binding CanAfford}"
                          Command="{Binding $parent[ItemsControl].((vm:ShopViewModel)DataContext).UpgradeToolCommand}"
                          CommandParameter="{Binding .}">
                    <Button.Background>
                      <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
                        <GradientStop Color="#D97706" Offset="0" />
                        <GradientStop Color="#B45309" Offset="1" />
                      </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                      <mi:MaterialIcon Kind="ScrewFlatTop" Width="14" Height="14" Foreground="#FFD700" />
                      <TextBlock Text="{Binding UpgradeCostDisplay}" FontSize="12" FontWeight="SemiBold"
                                 Foreground="White" />
                    </StackPanel>
                  </Button>
                  <!-- Max Level Badge -->
                  <mi:MaterialIcon Grid.Column="2" Kind="CheckCircle" Width="24" Height="24"
                                   Foreground="{DynamicResource SuccessBrush}"
                                   IsVisible="{Binding IsMaxLevel}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- RESTORE PURCHASES -->
        <Button Content="{Binding RestorePurchasesText}"
                Classes="Secondary"
                Command="{Binding RestorePurchasesCommand}"
                HorizontalAlignment="Center"
                Margin="0,16,0,0" />

        <!-- INFO -->
        <Border Classes="Card">
          <StackPanel Spacing="8">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="InformationOutline" Width="14" Height="14"
                               Foreground="{StaticResource CraftPrimaryLightBrush}" />
              <TextBlock Text="{loc:Translate Notice}"
                         FontSize="14" FontWeight="Bold"
                         Foreground="{StaticResource CraftPrimaryLightBrush}" />
            </StackPanel>
            <TextBlock Text="{loc:Translate FairPlayInfo}"
                       FontSize="12"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       TextWrapping="Wrap" />
          </StackPanel>
        </Border>

        <!-- Bottom Spacer -->
        <Border Height="60" />

      </StackPanel>
    </ScrollViewer>

  </Grid>

</UserControl>
