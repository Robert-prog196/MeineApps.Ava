<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:HandwerkerImperium.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             x:Class="HandwerkerImperium.Views.WorkshopView"
             x:DataType="vm:WorkshopViewModel">

  <Grid RowDefinitions="Auto,*">

    <!-- ================================================================= -->
    <!-- HEADER                                                            -->
    <!-- ================================================================= -->
    <Border Grid.Row="0"
            Classes="CardElevated"
            Padding="16,12"
            CornerRadius="0,0,12,12">
      <Grid ColumnDefinitions="Auto,*,Auto">

        <!-- Back Button -->
        <Button Classes="Text"
                Command="{Binding GoBackCommand}">
          <mi:MaterialIcon Kind="ArrowLeft" Width="24" Height="24" />
        </Button>

        <!-- Workshop Title -->
        <StackPanel Grid.Column="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Spacing="12">
          <Border Background="{StaticResource CraftPrimaryBrush}"
                  Opacity="0.15"
                  CornerRadius="24"
                  Width="48" Height="48">
            <TextBlock Text="{Binding WorkshopIcon}"
                       FontSize="28"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center" />
          </Border>
          <TextBlock Text="{Binding WorkshopName}"
                     FontSize="20" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     VerticalAlignment="Center" />
        </StackPanel>

        <!-- Level Badge -->
        <Border Grid.Column="2"
                Background="Gold"
                CornerRadius="8"
                Padding="12,6">
          <TextBlock Text="{Binding Level, StringFormat='Lvl {0}'}"
                     FontWeight="Bold"
                     Foreground="{DynamicResource SurfaceBrush}" />
        </Border>

      </Grid>
    </Border>

    <!-- ================================================================= -->
    <!-- CONTENT                                                           -->
    <!-- ================================================================= -->
    <ScrollViewer Grid.Row="1" Padding="16">
      <StackPanel Spacing="20">

        <!-- Level Progress Card -->
        <Border Classes="Card">
          <StackPanel Spacing="12">
            <TextBlock Text="{loc:Translate LevelProgress}"
                       FontSize="18" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}" />

            <Grid ColumnDefinitions="*,Auto">
              <ProgressBar Value="{Binding LevelProgress}"
                           Maximum="1"
                           Foreground="{StaticResource CraftPrimaryLightBrush}"
                           Height="12" />
              <TextBlock Grid.Column="1"
                         Text="{Binding Level, StringFormat='{}{0}/10'}"
                         FontSize="12"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         Margin="8,0,0,0" />
            </Grid>

            <!-- Upgrade Button -->
            <Button Classes="Primary"
                    Command="{Binding UpgradeCommand}"
                    IsEnabled="{Binding CanAffordUpgrade}"
                    IsVisible="{Binding CanUpgrade}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="ChevronUp" Width="18" Height="18" />
                <TextBlock Text="{Binding UpgradeCostDisplay, StringFormat='Upgrade ({0})'}" />
              </StackPanel>
            </Button>

            <TextBlock Text="{loc:Translate MaxLevelReached}"
                       FontSize="12"
                       Foreground="Gold"
                       HorizontalAlignment="Center"
                       IsVisible="{Binding !CanUpgrade}" />
          </StackPanel>
        </Border>

        <!-- Income Stats Card -->
        <Border Classes="Card">
          <Grid ColumnDefinitions="*,*"
                RowDefinitions="Auto,Auto"
                RowSpacing="16" ColumnSpacing="16">

            <StackPanel>
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="CashMultiple" Width="16" Height="16"
                                 Foreground="{DynamicResource SuccessBrush}" />
                <TextBlock Text="{loc:Translate Income}"
                           FontSize="12"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
              </StackPanel>
              <TextBlock Text="{Binding IncomeDisplay}"
                         FontSize="24" FontWeight="Bold"
                         Foreground="{DynamicResource SuccessBrush}" />
            </StackPanel>

            <StackPanel Grid.Column="1">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="ChartBar" Width="16" Height="16"
                                 Foreground="{StaticResource CraftPrimaryLightBrush}" />
                <TextBlock Text="{loc:Translate TotalEarned}"
                           FontSize="12"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
              </StackPanel>
              <TextBlock Text="{Binding TotalEarned, StringFormat='{}{0:N0} EUR'}"
                         FontSize="14" FontWeight="Bold"
                         Foreground="{DynamicResource TextPrimaryBrush}" />
            </StackPanel>

            <StackPanel Grid.Row="1">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="ClipboardList" Width="16" Height="16"
                                 Foreground="{StaticResource CraftPrimaryLightBrush}" />
                <TextBlock Text="{loc:Translate Orders}"
                           FontSize="12"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
              </StackPanel>
              <TextBlock Text="{Binding OrdersCompleted}"
                         FontSize="14" FontWeight="Bold"
                         Foreground="{DynamicResource TextPrimaryBrush}" />
            </StackPanel>

          </Grid>
        </Border>

        <!-- Workers Section Card -->
        <Border Classes="Card">
          <StackPanel Spacing="16">

            <Grid ColumnDefinitions="*,Auto">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="AccountHardHat" Width="20" Height="20"
                                 Foreground="{StaticResource CraftPrimaryLightBrush}" />
                <TextBlock Text="{loc:Translate Workers}"
                           FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryBrush}" />
              </StackPanel>
              <TextBlock Grid.Column="1"
                         FontSize="14"
                         Foreground="{DynamicResource TextPrimaryBrush}">
                <Run Text="{Binding WorkerCount}" /><Run Text="/" /><Run Text="{Binding MaxWorkers}" />
              </TextBlock>
            </Grid>

            <!-- Worker List -->
            <ItemsControl ItemsSource="{Binding Workers}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border Background="{DynamicResource SurfaceBrush}"
                          CornerRadius="8"
                          Padding="12,8"
                          Margin="0,4">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                      <mi:MaterialIcon Kind="AccountHardHat" Width="24" Height="24"
                                       Foreground="{StaticResource CraftPrimaryLightBrush}"
                                       VerticalAlignment="Center" />
                      <StackPanel Grid.Column="1" Margin="12,0">
                        <TextBlock Text="{Binding Name}"
                                   FontSize="14"
                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                        <TextBlock Text="{Binding Efficiency, StringFormat='Efficiency: {0:P0}'}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextSecondaryBrush}" />
                      </StackPanel>
                      <StackPanel Grid.Column="2"
                                  Orientation="Horizontal"
                                  Spacing="4"
                                  VerticalAlignment="Center">
                        <mi:MaterialIcon Kind="Star" Width="16" Height="16"
                                         Foreground="Gold" />
                        <TextBlock Text="{Binding SkillLevel}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   VerticalAlignment="Center" />
                      </StackPanel>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Empty State -->
            <TextBlock Text="{loc:Translate NoWorkersYet}"
                       FontSize="12"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center"
                       IsVisible="{Binding HasNoWorkers}" />

            <!-- Arbeiter einstellen Button â†’ navigiert zum Arbeitermarkt -->
            <Button Classes="Primary"
                    Command="{Binding HireWorkerFromMarketCommand}"
                    IsVisible="{Binding CanHireWorker}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center">
              <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                <mi:MaterialIcon Kind="AccountPlus" Width="18" Height="18" />
                <TextBlock Text="{loc:Translate HireWorker}" FontSize="14" />
              </StackPanel>
            </Button>

            <TextBlock Text="{loc:Translate MaxWorkersReached}"
                       FontSize="12"
                       Foreground="{DynamicResource WarningBrush}"
                       HorizontalAlignment="Center"
                       IsVisible="{Binding !CanHireWorker}" />

          </StackPanel>
        </Border>

        <!-- Ad Speedup Button (2h Produktionsertrag) -->
        <Border Classes="Card"
                IsVisible="{Binding CanWatchSpeedupAd}">
          <Button Classes="Secondary"
                  Command="{Binding WatchAdForSpeedupCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  Padding="12,10">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="Video" Width="20" Height="20"
                               Foreground="{StaticResource CraftPrimaryLightBrush}" />
              <TextBlock Text="{loc:Translate WatchAdForSpeedup}"
                         FontSize="14" FontWeight="SemiBold" />
            </StackPanel>
          </Button>
        </Border>

        <!-- Bottom Spacer -->
        <Border Height="20" />

      </StackPanel>
    </ScrollViewer>

  </Grid>

</UserControl>
