<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FinanzRechner.ViewModels"
             xmlns:models="using:FinanzRechner.Models"
             xmlns:conv="using:FinanzRechner.Converters"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             x:Class="FinanzRechner.Views.HomeView"
             x:DataType="vm:MainViewModel">

  <Panel>
  <ScrollViewer VerticalScrollBarVisibility="Auto">
    <StackPanel Spacing="0" Margin="0,0,0,120">

      <!-- ========== A) Hero-Header (Gradient passend zum Bilanz-Status) ========== -->
      <Border CornerRadius="0,0,16,16" Padding="20,20,20,16"
              Cursor="Hand">
        <Border.Background>
          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
            <GradientStop Color="{DynamicResource PrimaryColor}" Offset="0" />
            <GradientStop Color="{DynamicResource SecondaryColor}" Offset="0.5" />
            <GradientStop Color="{DynamicResource AccentColor}" Offset="1" />
          </LinearGradientBrush>
        </Border.Background>
        <!-- Dezenter Overlay-Gradient passend zum Bilanz-Status -->
        <Border.Styles>
          <Style Selector="Border.PositiveBalance">
            <Setter Property="Background">
              <Setter.Value>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                  <GradientStop Color="#0D22C55E" Offset="0" />
                  <GradientStop Color="#1A22C55E" Offset="1" />
                </LinearGradientBrush>
              </Setter.Value>
            </Setter>
          </Style>
        </Border.Styles>

        <StackPanel Spacing="10" HorizontalAlignment="Center">

          <!-- Monat zentriert -->
          <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
            <Border Width="36" Height="36" CornerRadius="18" Background="#33FFFFFF">
              <mi:MaterialIcon Kind="Finance" Width="20" Height="20"
                               Foreground="White"
                               HorizontalAlignment="Center" VerticalAlignment="Center" />
            </Border>
            <TextBlock Text="{Binding CurrentMonthDisplay}"
                       FontSize="20" FontWeight="Bold" Foreground="White"
                       VerticalAlignment="Center" />
          </StackPanel>

          <!-- Mit Transaktionen: Bilanz + Chips -->
          <StackPanel Spacing="6" IsVisible="{Binding HasTransactions}"
                      HorizontalAlignment="Center">
            <TextBlock Text="{Binding MonthlyBalanceDisplay}"
                       FontSize="30" FontWeight="Bold" Foreground="White"
                       HorizontalAlignment="Center" />

            <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
              <Border Background="#4422C55E" CornerRadius="12" Padding="10,4">
                <StackPanel Orientation="Horizontal" Spacing="4">
                  <mi:MaterialIcon Kind="ArrowUpBold" Width="14" Height="14" Foreground="#22C55E" />
                  <TextBlock Text="{Binding MonthlyIncomeDisplay}"
                             FontSize="13" FontWeight="SemiBold" Foreground="#22C55E" />
                </StackPanel>
              </Border>
              <Border Background="#44EF4444" CornerRadius="12" Padding="10,4">
                <StackPanel Orientation="Horizontal" Spacing="4">
                  <mi:MaterialIcon Kind="ArrowDownBold" Width="14" Height="14" Foreground="#EF4444" />
                  <TextBlock Text="{Binding MonthlyExpensesDisplay}"
                             FontSize="13" FontWeight="SemiBold" Foreground="#EF4444" />
                </StackPanel>
              </Border>
            </StackPanel>
          </StackPanel>

          <!-- Ohne Transaktionen: Animiertes Icon + Onboarding-Text -->
          <StackPanel IsVisible="{Binding !HasTransactions}" Spacing="6" HorizontalAlignment="Center">
            <Border Classes="EmptyPulse" HorizontalAlignment="Center">
              <mi:MaterialIcon Kind="WalletPlus" Width="32" Height="32" Foreground="#CCFFFFFF" />
            </Border>
            <TextBlock Text="{Binding HomeSubtitleText}"
                       FontSize="13" Foreground="#BBFFFFFF"
                       HorizontalAlignment="Center" TextAlignment="Center"
                       TextWrapping="Wrap" MaxWidth="300" />
          </StackPanel>

        </StackPanel>
      </Border>

      <!-- ========== Monatsreport Button ========== -->
      <Button HorizontalAlignment="Stretch" Margin="16,12,16,0"
              CornerRadius="12" Padding="14,10"
              Command="{Binding RequestBudgetAnalysisCommand}">
        <Button.Background>
          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
            <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
            <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
          </LinearGradientBrush>
        </Button.Background>
        <Grid ColumnDefinitions="Auto,*,Auto">
          <Border Grid.Column="0" Width="36" Height="36" CornerRadius="10"
                  Margin="0,0,12,0">
            <Border.Background>
              <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                <GradientStop Color="#8B5CF6" Offset="0" />
                <GradientStop Color="#7C3AED" Offset="1" />
              </LinearGradientBrush>
            </Border.Background>
            <mi:MaterialIcon Kind="ChartBox" Width="20" Height="20"
                             Foreground="White"
                             HorizontalAlignment="Center" VerticalAlignment="Center" />
          </Border>
          <TextBlock Grid.Column="1" Text="{Binding MonthlyReportText}"
                     FontSize="14" FontWeight="SemiBold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     VerticalAlignment="Center" />
          <mi:MaterialIcon Grid.Column="2" Kind="ChevronRight" Width="20" Height="20"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center" />
        </Grid>
      </Button>

      <!-- ========== Content ========== -->
      <StackPanel Spacing="16" Margin="16,16,16,0">

        <!-- ========== B) Budget-Status Sektion ========== -->
        <Border Classes="Card SummaryCard" Padding="16"
                BoxShadow="{DynamicResource CardShadow}"
                IsVisible="{Binding HasBudgets}">
          <StackPanel Spacing="12">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="ChartDonut" Width="20" Height="20"
                               Foreground="{DynamicResource AccentBrush}" />
              <TextBlock Text="{Binding SectionBudgetText}"
                         FontSize="16" FontWeight="Bold"
                         Foreground="{DynamicResource TextPrimaryBrush}" />
            </StackPanel>

            <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto">
              <ProgressBar Grid.Row="0" Grid.ColumnSpan="2"
                           Minimum="0" Maximum="100"
                           Value="{Binding OverallBudgetPercentage}"
                           Height="8" CornerRadius="4"
                           Foreground="{DynamicResource AccentBrush}"
                           Background="{DynamicResource SurfaceBrush}" />
              <TextBlock Grid.Row="1" Grid.Column="1"
                         FontSize="11"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         Margin="0,4,0,0">
                <TextBlock.Text>
                  <MultiBinding StringFormat="{}{0:F0}%">
                    <Binding Path="OverallBudgetPercentage" />
                  </MultiBinding>
                </TextBlock.Text>
              </TextBlock>
            </Grid>

            <ItemsControl ItemsSource="{Binding TopBudgets}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:BudgetDisplayItem">
                  <Grid ColumnDefinitions="Auto,*,Auto" Margin="0,3">
                    <!-- Farbiger Kategorie-Punkt -->
                    <Border Grid.Column="0" Width="8" Height="8" CornerRadius="4"
                            Background="{Binding Category, Converter={x:Static conv:CategoryToColorBrushConverter.Instance}}"
                            VerticalAlignment="Center" Margin="0,0,8,0" />
                    <TextBlock Grid.Column="1" Text="{Binding CategoryName}" FontSize="13"
                               Foreground="{DynamicResource TextPrimaryBrush}"
                               VerticalAlignment="Center" />
                    <Border Grid.Column="2" CornerRadius="8" Padding="6,2"
                            Background="{DynamicResource SurfaceBrush}">
                      <TextBlock Text="{Binding PercentageDisplay}"
                                 FontSize="12" FontWeight="Bold"
                                 Foreground="{Binding AlertLevel, Converter={x:Static conv:AlertLevelToColorConverter.Instance}}" />
                    </Border>
                  </Grid>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </Border>

        <!-- ========== C) Ausgabenverteilung (Mini-Donut) ========== -->
        <Border Classes="Card SummaryCard" Padding="16"
                BoxShadow="{DynamicResource CardShadow}"
                IsVisible="{Binding HasHomeChartData}">
          <StackPanel Spacing="8">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="ChartDonut" Width="20" Height="20"
                               Foreground="{DynamicResource AccentBrush}" />
              <TextBlock Text="{Binding SectionExpensesText}"
                         FontSize="16" FontWeight="Bold"
                         Foreground="{DynamicResource TextPrimaryBrush}" />
            </StackPanel>
            <lvc:PieChart Series="{Binding HomeExpenseChartSeries}"
                          Height="180"
                          Background="{DynamicResource CardBrush}"
                          LegendPosition="Right"
                          InitialRotation="-90" />
          </StackPanel>
        </Border>

        <!-- ========== D) Letzte Transaktionen ========== -->
        <Border Classes="Card SummaryCard" Padding="16"
                BoxShadow="{DynamicResource CardShadow}"
                IsVisible="{Binding HasRecentTransactions}">
          <StackPanel Spacing="10">
            <Grid ColumnDefinitions="*,Auto">
              <StackPanel Orientation="Horizontal" Spacing="8" Grid.Column="0">
                <mi:MaterialIcon Kind="ClockOutline" Width="20" Height="20"
                                 Foreground="{DynamicResource AccentBrush}" />
                <TextBlock Text="{Binding SectionRecentText}"
                           FontSize="16" FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryBrush}" />
              </StackPanel>
              <Button Grid.Column="1" Classes="Flat"
                      Content="{Binding ViewAllText}" FontSize="12"
                      Command="{Binding NavigateToTrackerCommand}" />
            </Grid>

            <ItemsControl ItemsSource="{Binding RecentTransactions}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:Expense">
                  <Border Padding="6,10" Margin="0,2"
                          CornerRadius="10"
                          Background="{DynamicResource SurfaceBrush}">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                      <!-- Farbiges Kategorie-Icon -->
                      <Border Grid.Column="0" Width="36" Height="36"
                              CornerRadius="10"
                              Background="{Binding Category, Converter={x:Static conv:CategoryToColorBrushConverter.Instance}, ConverterParameter=0.2}"
                              Margin="0,0,10,0">
                        <mi:MaterialIcon Kind="{Binding Category, Converter={x:Static conv:CategoryToIconConverter.Instance}}"
                                         Width="18" Height="18"
                                         Foreground="{Binding Category, Converter={x:Static conv:CategoryToColorBrushConverter.Instance}}"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Description}"
                                   FontSize="14" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   TextTrimming="CharacterEllipsis" />
                        <TextBlock Text="{Binding Date, StringFormat='{}{0:dd.MM.yyyy}'}"
                                   FontSize="11"
                                   Foreground="{DynamicResource TextMutedBrush}" />
                      </StackPanel>
                      <TextBlock Grid.Column="2" FontSize="14" FontWeight="Bold"
                                 VerticalAlignment="Center"
                                 Foreground="{Binding Type, Converter={x:Static conv:TransactionTypeToColorConverter.Instance}}">
                        <TextBlock.Text>
                          <MultiBinding StringFormat="{}{0}{1:N2} â‚¬">
                            <Binding Path="Type" Converter="{x:Static conv:TransactionTypeToPrefixConverter.Instance}" />
                            <Binding Path="Amount" />
                          </MultiBinding>
                        </TextBlock.Text>
                      </TextBlock>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </Border>

        <!-- ========== E) Finanz-Rechner (2x3 Grid) ========== -->
        <StackPanel Spacing="12">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <Border Background="{DynamicResource PrimaryBrush}"
                    CornerRadius="6" Padding="8,4">
              <TextBlock Text="{Binding SectionCalculatorsText}" FontSize="11" FontWeight="Bold" Foreground="White" />
            </Border>
            <TextBlock Text="{Binding CalculatorsTitleText}"
                       FontSize="18" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       VerticalAlignment="Center" />
          </StackPanel>

          <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto"
                ColumnSpacing="12" RowSpacing="12">

            <!-- Zinseszins -->
            <Button Grid.Row="0" Grid.Column="0"
                    CornerRadius="12" Height="120" Padding="8"
                    HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                    Command="{Binding OpenCompoundInterestCommand}">
              <Button.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                  <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                  <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                </LinearGradientBrush>
              </Button.Background>
              <StackPanel VerticalAlignment="Center" Spacing="8">
                <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                  <Border.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                      <GradientStop Color="#22C55E" Offset="0" />
                      <GradientStop Color="#16A34A" Offset="1" />
                    </LinearGradientBrush>
                  </Border.Background>
                  <mi:MaterialIcon Kind="TrendingUp" Width="24" Height="24"
                                   Foreground="White"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                </Border>
                <TextBlock Text="{Binding CalcCompoundInterestText}"
                           FontSize="13" FontWeight="Bold" TextAlignment="Center"
                           Foreground="{DynamicResource TextPrimaryBrush}" />
              </StackPanel>
            </Button>

            <!-- Sparplan -->
            <Button Grid.Row="0" Grid.Column="1"
                    CornerRadius="12" Height="120" Padding="8"
                    HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                    Command="{Binding OpenSavingsPlanCommand}">
              <Button.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                  <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                  <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                </LinearGradientBrush>
              </Button.Background>
              <StackPanel VerticalAlignment="Center" Spacing="8">
                <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                  <Border.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                      <GradientStop Color="#3B82F6" Offset="0" />
                      <GradientStop Color="#2563EB" Offset="1" />
                    </LinearGradientBrush>
                  </Border.Background>
                  <mi:MaterialIcon Kind="Safe" Width="24" Height="24"
                                   Foreground="White"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                </Border>
                <TextBlock Text="{Binding CalcSavingsPlanText}"
                           FontSize="13" FontWeight="Bold" TextAlignment="Center"
                           Foreground="{DynamicResource TextPrimaryBrush}" />
              </StackPanel>
            </Button>

            <!-- Kredit -->
            <Button Grid.Row="1" Grid.Column="0"
                    CornerRadius="12" Height="120" Padding="8"
                    HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                    Command="{Binding OpenLoanCommand}">
              <Button.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                  <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                  <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                </LinearGradientBrush>
              </Button.Background>
              <StackPanel VerticalAlignment="Center" Spacing="8">
                <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                  <Border.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                      <GradientStop Color="#F59E0B" Offset="0" />
                      <GradientStop Color="#D97706" Offset="1" />
                    </LinearGradientBrush>
                  </Border.Background>
                  <mi:MaterialIcon Kind="Bank" Width="24" Height="24"
                                   Foreground="White"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                </Border>
                <TextBlock Text="{Binding CalcLoanText}"
                           FontSize="13" FontWeight="Bold" TextAlignment="Center"
                           Foreground="{DynamicResource TextPrimaryBrush}" />
              </StackPanel>
            </Button>

            <!-- Tilgungsplan -->
            <Button Grid.Row="1" Grid.Column="1"
                    CornerRadius="12" Height="120" Padding="8"
                    HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                    Command="{Binding OpenAmortizationCommand}">
              <Button.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                  <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                  <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                </LinearGradientBrush>
              </Button.Background>
              <StackPanel VerticalAlignment="Center" Spacing="8">
                <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                  <Border.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                      <GradientStop Color="#8B5CF6" Offset="0" />
                      <GradientStop Color="#7C3AED" Offset="1" />
                    </LinearGradientBrush>
                  </Border.Background>
                  <mi:MaterialIcon Kind="ListStatus" Width="24" Height="24"
                                   Foreground="White"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                </Border>
                <TextBlock Text="{Binding CalcAmortizationText}"
                           FontSize="13" FontWeight="Bold" TextAlignment="Center"
                           Foreground="{DynamicResource TextPrimaryBrush}" />
              </StackPanel>
            </Button>

            <!-- Rendite -->
            <Button Grid.Row="2" Grid.Column="0"
                    CornerRadius="12" Height="120" Padding="8"
                    HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                    Command="{Binding OpenYieldCommand}">
              <Button.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                  <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                  <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                </LinearGradientBrush>
              </Button.Background>
              <StackPanel VerticalAlignment="Center" Spacing="8">
                <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                  <Border.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                      <GradientStop Color="#EF4444" Offset="0" />
                      <GradientStop Color="#DC2626" Offset="1" />
                    </LinearGradientBrush>
                  </Border.Background>
                  <mi:MaterialIcon Kind="ChartArc" Width="24" Height="24"
                                   Foreground="White"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                </Border>
                <TextBlock Text="{Binding CalcYieldText}"
                           FontSize="13" FontWeight="Bold" TextAlignment="Center"
                           Foreground="{DynamicResource TextPrimaryBrush}" />
              </StackPanel>
            </Button>

            <!-- Inflation -->
            <Button Grid.Row="2" Grid.Column="1"
                    CornerRadius="12" Height="120" Padding="8"
                    HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                    Command="{Binding OpenInflationCommand}">
              <Button.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                  <GradientStop Color="{DynamicResource CardColor}" Offset="0" />
                  <GradientStop Color="{DynamicResource CardHoverColor}" Offset="1" />
                </LinearGradientBrush>
              </Button.Background>
              <StackPanel VerticalAlignment="Center" Spacing="8">
                <Border CornerRadius="12" Width="48" Height="48" HorizontalAlignment="Center">
                  <Border.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                      <GradientStop Color="#F97316" Offset="0" />
                      <GradientStop Color="#EA580C" Offset="1" />
                    </LinearGradientBrush>
                  </Border.Background>
                  <mi:MaterialIcon Kind="CurrencyUsd" Width="24" Height="24"
                                   Foreground="White"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                </Border>
                <TextBlock Text="{Binding CalcInflationText}"
                           FontSize="13" FontWeight="Bold" TextAlignment="Center"
                           Foreground="{DynamicResource TextPrimaryBrush}" />
              </StackPanel>
            </Button>

          </Grid>
        </StackPanel>

        <!-- ========== F) Premium-Card ========== -->
        <Button Background="Transparent" Padding="0"
                HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                IsVisible="{Binding !IsPremium}"
                Command="{Binding NavigateToSettingsCommand}">
          <Border Classes="PremiumShimmer" CornerRadius="16" Padding="16" ClipToBounds="True">
            <Border.Background>
              <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                <GradientStop Color="{DynamicResource AccentColor}" Offset="0" />
                <GradientStop Color="{DynamicResource SecondaryColor}" Offset="1" />
              </LinearGradientBrush>
            </Border.Background>

            <Panel>
              <Ellipse Width="100" Height="100"
                       Opacity="0.1" Fill="White"
                       HorizontalAlignment="Right" VerticalAlignment="Center"
                       Margin="0,0,-20,0" />

              <Grid ColumnDefinitions="Auto,*,Auto">
                <Border Grid.Column="0" Width="44" Height="44"
                        CornerRadius="22" Background="#33FFFFFF"
                        Margin="0,0,14,0">
                  <mi:MaterialIcon Kind="Star" Width="24" Height="24"
                                   Foreground="White"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                </Border>
                <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                  <TextBlock Text="{Binding RemoveAdsText}"
                             FontSize="15" FontWeight="Bold" Foreground="White" />
                  <TextBlock Text="{Binding PremiumPriceText}"
                             FontSize="12" Foreground="#CCFFFFFF" />
                </StackPanel>
                <mi:MaterialIcon Grid.Column="2"
                                 Kind="ChevronRight" Width="20" Height="20"
                                 Foreground="#AAFFFFFF" VerticalAlignment="Center" />
              </Grid>
            </Panel>
          </Border>
        </Button>

      </StackPanel>
    </StackPanel>
  </ScrollViewer>

  <!-- ========== Budget Ad Overlay (innerhalb Panel) ========== -->
  <Border IsVisible="{Binding ShowBudgetAdOverlay}"
          Background="#CC000000"
          ZIndex="200">
    <Border Background="{DynamicResource CardBrush}"
            CornerRadius="16"
            Padding="24"
            MaxWidth="340"
            HorizontalAlignment="Center"
            VerticalAlignment="Center">
      <StackPanel Spacing="16" HorizontalAlignment="Center">
        <TextBlock Text="{Binding BudgetAnalysisTitleText}"
                   FontSize="22" FontWeight="Bold"
                   Foreground="{DynamicResource TextPrimaryBrush}"
                   HorizontalAlignment="Center" />

        <Border Background="{DynamicResource SurfaceBrush}"
                CornerRadius="30"
                Width="60" Height="60"
                HorizontalAlignment="Center">
          <mi:MaterialIcon Kind="ChartBox" Width="32" Height="32"
                           Foreground="{DynamicResource AccentBrush}" />
        </Border>

        <TextBlock Text="{Binding BudgetAnalysisDescText}"
                   FontSize="14"
                   Foreground="{DynamicResource TextSecondaryBrush}"
                   HorizontalAlignment="Center"
                   TextWrapping="Wrap"
                   TextAlignment="Center" />

        <StackPanel Spacing="8">
          <Button Classes="Filled"
                  Command="{Binding ConfirmBudgetAdCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  Padding="16,12">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="Video" Width="20" Height="20" />
              <TextBlock Text="{Binding WatchVideoReportText}"
                         FontSize="15" FontWeight="SemiBold" />
            </StackPanel>
          </Button>

          <Button Classes="Text"
                  Command="{Binding CancelBudgetAdCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  Padding="12,10">
            <TextBlock Text="{Binding CloseText}"
                       FontSize="14"
                       Foreground="{DynamicResource TextSecondaryBrush}" />
          </Button>
        </StackPanel>
      </StackPanel>
    </Border>
  </Border>

  <!-- ========== Budget Analysis Report Overlay ========== -->
  <Border IsVisible="{Binding ShowBudgetAnalysisOverlay}"
          Background="#CC000000"
          ZIndex="210">
    <Border Background="{DynamicResource CardBrush}"
            CornerRadius="16"
            Padding="20"
            MaxWidth="400" MaxHeight="600"
            HorizontalAlignment="Center"
            VerticalAlignment="Center">
      <ScrollViewer>
        <StackPanel Spacing="14"
                    DataContext="{Binding BudgetAnalysisReport}"
                    x:DataType="models:BudgetAnalysisReport">

          <!-- Header -->
          <StackPanel HorizontalAlignment="Center" Spacing="4">
            <TextBlock Text="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).BudgetAnalysisTitleText}"
                       FontSize="20" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       HorizontalAlignment="Center" />
            <TextBlock Text="{Binding PeriodDisplay}"
                       FontSize="14"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center" />
          </StackPanel>

          <!-- Bilanz-Box -->
          <Border CornerRadius="12" Padding="16">
            <Border.Background>
              <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                <GradientStop Color="{DynamicResource PrimaryColor}" Offset="0" />
                <GradientStop Color="{DynamicResource SecondaryColor}" Offset="1" />
              </LinearGradientBrush>
            </Border.Background>
            <StackPanel Spacing="8" HorizontalAlignment="Center">
              <TextBlock Text="{Binding BalanceDisplay}"
                         FontSize="26" FontWeight="Bold" Foreground="White"
                         HorizontalAlignment="Center" />
              <StackPanel Orientation="Horizontal" Spacing="16" HorizontalAlignment="Center">
                <StackPanel Spacing="2" HorizontalAlignment="Center">
                  <TextBlock Text="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).ExpensesLabelText}"
                             FontSize="11" Foreground="#AAFFFFFF" HorizontalAlignment="Center" />
                  <TextBlock Text="{Binding TotalExpensesDisplay}"
                             FontSize="14" FontWeight="SemiBold" Foreground="#FFCCCC"
                             HorizontalAlignment="Center" />
                </StackPanel>
                <StackPanel Spacing="2" HorizontalAlignment="Center">
                  <TextBlock Text="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).IncomeLabelText}"
                             FontSize="11" Foreground="#AAFFFFFF" HorizontalAlignment="Center" />
                  <TextBlock Text="{Binding TotalIncomeDisplay}"
                             FontSize="14" FontWeight="SemiBold" Foreground="#CCFFCC"
                             HorizontalAlignment="Center" />
                </StackPanel>
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- Vormonatsvergleich -->
          <Border Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="10" Padding="12">
            <StackPanel Spacing="4">
              <TextBlock Text="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).ComparedToLastMonthText}"
                         FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" />
              <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="{Binding PreviousMonthDisplay}"
                           FontSize="14" FontWeight="SemiBold"
                           Foreground="{DynamicResource TextPrimaryBrush}" />
                <TextBlock Text="{Binding MonthChangeDisplay}"
                           FontSize="13" FontWeight="SemiBold"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- Kategorie-Aufschluesselung -->
          <ItemsControl ItemsSource="{Binding CategoryBreakdown}">
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="models:CategoryBreakdownItem">
                <Grid ColumnDefinitions="*,Auto,Auto" Margin="0,3">
                  <TextBlock Grid.Column="0" Text="{Binding CategoryName}"
                             FontSize="13" Foreground="{DynamicResource TextPrimaryBrush}"
                             VerticalAlignment="Center" />
                  <TextBlock Grid.Column="1" Text="{Binding AmountDisplay}"
                             FontSize="13" FontWeight="SemiBold"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             VerticalAlignment="Center" Margin="0,0,8,0" />
                  <TextBlock Grid.Column="2" Text="{Binding PercentageDisplay}"
                             FontSize="12"
                             Foreground="{DynamicResource TextSecondaryBrush}"
                             VerticalAlignment="Center" />
                </Grid>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>

          <!-- Spartipps -->
          <StackPanel Spacing="6"
                      IsVisible="{Binding SavingTips.Count}">
            <TextBlock Text="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).SavingTipText}"
                       FontSize="14" FontWeight="Bold"
                       Foreground="{DynamicResource AccentBrush}" />
            <ItemsControl ItemsSource="{Binding SavingTips}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:SavingTipItem">
                  <Border Background="{DynamicResource SurfaceBrush}"
                          CornerRadius="8" Padding="10,8" Margin="0,2">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                      <mi:MaterialIcon Grid.Column="0" Kind="Lightbulb" Width="16" Height="16"
                                       Foreground="{DynamicResource AccentBrush}"
                                       Margin="0,0,8,0" VerticalAlignment="Center" />
                      <TextBlock Grid.Column="1" Text="{Binding Tip}"
                                 FontSize="12" Foreground="{DynamicResource TextPrimaryBrush}"
                                 VerticalAlignment="Center" TextWrapping="Wrap" />
                      <TextBlock Grid.Column="2" Text="{Binding AmountDisplay}"
                                 FontSize="12" FontWeight="SemiBold"
                                 Foreground="{DynamicResource TextSecondaryBrush}"
                                 VerticalAlignment="Center" Margin="8,0,0,0" />
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>

          <!-- Schliessen-Button -->
          <Button Classes="Filled"
                  Command="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).CloseBudgetAnalysisCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  Padding="14,10" Margin="0,4,0,0">
            <TextBlock Text="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).CloseText}"
                       FontSize="15" FontWeight="SemiBold" />
          </Button>
        </StackPanel>
      </ScrollViewer>
    </Border>
  </Border>

  </Panel>
</UserControl>
