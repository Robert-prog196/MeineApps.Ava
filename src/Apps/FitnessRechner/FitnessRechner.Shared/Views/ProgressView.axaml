<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FitnessRechner.ViewModels"
             xmlns:models="using:FitnessRechner.Models"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             xmlns:conv="using:FitnessRechner.Converters"
             x:Class="FitnessRechner.Views.ProgressView"
             x:DataType="vm:ProgressViewModel">

  <UserControl.Resources>
    <conv:IsNotNullConverter x:Key="IsNotNullConverter" />
    <conv:BoolToStringConverter x:Key="BmiBodyFatConverter" TrueValue="BMI" FalseValue="{loc:Translate BodyFat}" />

    <!-- Wiederverwendbares Mahlzeit-Item Template -->
    <DataTemplate x:Key="MealItemTemplate" x:DataType="models:FoodLogEntry">
      <Border Classes="Card Compact" Margin="0,3" Padding="10">
        <Grid ColumnDefinitions="*,Auto,Auto">
          <StackPanel>
            <TextBlock Text="{Binding FoodName}" FontSize="13" FontWeight="SemiBold"
                       Foreground="{DynamicResource TextPrimaryBrush}" />
            <TextBlock Text="{Binding Grams, StringFormat='{}{0:F0}g'}"
                       FontSize="11" Foreground="{DynamicResource TextMutedBrush}" />
          </StackPanel>
          <TextBlock Grid.Column="1"
                     Text="{Binding Calories, StringFormat='{}{0:F0} kcal'}"
                     FontSize="14" FontWeight="Bold"
                     Foreground="{DynamicResource ErrorBrush}"
                     VerticalAlignment="Center" />
          <Button Grid.Column="2" Classes="Icon"
                  Command="{Binding $parent[ItemsControl].((vm:ProgressViewModel)DataContext).DeleteMealCommand}"
                  CommandParameter="{Binding .}"
                  Margin="4,0,0,0">
            <mi:MaterialIcon Kind="Delete" Width="16" Height="16"
                             Foreground="{DynamicResource ErrorBrush}" />
          </Button>
        </Grid>
      </Border>
    </DataTemplate>
  </UserControl.Resources>

  <Grid RowDefinitions="Auto,Auto,*,Auto">

    <!-- ============================================ -->
    <!-- Row 0: Header with Title + Action Buttons    -->
    <!-- ============================================ -->
    <Border Grid.Row="0"
            Background="{DynamicResource SurfaceBrush}"
            BorderThickness="0,0,0,1"
            BorderBrush="{DynamicResource BorderSubtleBrush}"
            Padding="16,12">
      <Grid ColumnDefinitions="*,Auto,Auto,Auto">
        <TextBlock Text="{loc:Translate Progress}"
                   FontSize="20" FontWeight="Bold"
                   Foreground="{DynamicResource TextPrimaryBrush}"
                   VerticalAlignment="Center" />

        <!-- Analyse Button -->
        <Button Grid.Column="1"
                Classes="Text Small"
                Command="{Binding RequestAnalysisCommand}"
                ToolTip.Tip="{loc:Translate WeeklyAnalysis}"
                Margin="0,0,4,0">
          <mi:MaterialIcon Kind="ChartBox" Width="20" Height="20"
                           Foreground="{DynamicResource InfoBrush}" />
        </Button>

        <!-- Export Button -->
        <Button Grid.Column="2"
                Classes="Text Small"
                Command="{Binding ExportTrackingCommand}"
                ToolTip.Tip="{loc:Translate ExportTracking}"
                Margin="0,0,4,0">
          <mi:MaterialIcon Kind="FileExport" Width="20" Height="20"
                           Foreground="{DynamicResource SuccessBrush}" />
        </Button>

        <!-- Add Button -->
        <Button Grid.Column="3"
                Classes="Primary Small"
                Command="{Binding ToggleAddFormCommand}"
                IsVisible="{Binding !ShowAddForm}">
          <mi:MaterialIcon Kind="Plus" Width="20" Height="20" />
        </Button>
      </Grid>
    </Border>

    <!-- ============================================ -->
    <!-- Row 1: Tab Bar (4 Tabs)                      -->
    <!-- ============================================ -->
    <Border Grid.Row="1"
            Background="{DynamicResource SurfaceBrush}"
            Padding="8,4">
      <ScrollViewer HorizontalScrollBarVisibility="Auto"
                    VerticalScrollBarVisibility="Disabled">
        <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">

          <!-- Weight Tab -->
          <Button Classes="Text" Padding="0" Height="NaN"
                  Command="{Binding SelectWeightTabCommand}">
            <Border CornerRadius="12" Padding="16,10" Cursor="Hand"
                    Background="{Binding IsWeightTab, Converter={x:Static conv:TabColorConverters.WeightTab}}">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="ScaleBathroom" Width="16" Height="16"
                                 Foreground="{Binding IsWeightTab, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
                <TextBlock Text="{loc:Translate TabWeight}" FontSize="13" VerticalAlignment="Center"
                           Foreground="{Binding IsWeightTab, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
              </StackPanel>
            </Border>
          </Button>

          <!-- Body Tab -->
          <Button Classes="Text" Padding="0" Height="NaN"
                  Command="{Binding SelectBodyTabCommand}">
            <Border CornerRadius="12" Padding="16,10" Cursor="Hand"
                    Background="{Binding IsBodyTab, Converter={x:Static conv:TabColorConverters.BodyTab}}">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="HumanMaleBoard" Width="16" Height="16"
                                 Foreground="{Binding IsBodyTab, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
                <TextBlock Text="{loc:Translate TabBody}" FontSize="13" VerticalAlignment="Center"
                           Foreground="{Binding IsBodyTab, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
              </StackPanel>
            </Border>
          </Button>

          <!-- Water Tab -->
          <Button Classes="Text" Padding="0" Height="NaN"
                  Command="{Binding SelectWaterTabCommand}">
            <Border CornerRadius="12" Padding="16,10" Cursor="Hand"
                    Background="{Binding IsWaterTab, Converter={x:Static conv:TabColorConverters.WaterTab}}">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="Water" Width="16" Height="16"
                                 Foreground="{Binding IsWaterTab, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
                <TextBlock Text="{loc:Translate TabWater}" FontSize="13" VerticalAlignment="Center"
                           Foreground="{Binding IsWaterTab, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
              </StackPanel>
            </Border>
          </Button>

          <!-- Calories Tab -->
          <Button Classes="Text" Padding="0" Height="NaN"
                  Command="{Binding SelectCaloriesTabCommand}">
            <Border CornerRadius="12" Padding="16,10" Cursor="Hand"
                    Background="{Binding IsCaloriesTab, Converter={x:Static conv:TabColorConverters.CaloriesTab}}">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="Fire" Width="16" Height="16"
                                 Foreground="{Binding IsCaloriesTab, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
                <TextBlock Text="{loc:Translate TabCalories}" FontSize="13" VerticalAlignment="Center"
                           Foreground="{Binding IsCaloriesTab, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
              </StackPanel>
            </Border>
          </Button>

        </StackPanel>
      </ScrollViewer>
    </Border>

    <!-- ============================================ -->
    <!-- Row 2: Tab Content (Scrollable)              -->
    <!-- ============================================ -->
    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
      <Panel Margin="12,12,12,80">

        <!-- ==================== WEIGHT TAB ==================== -->
        <StackPanel Spacing="16" IsVisible="{Binding IsWeightTab}">

          <!-- Stats Card -->
          <Border Classes="Card" Padding="0" ClipToBounds="True">
            <StackPanel>
              <!-- Gradient Header -->
              <Border Padding="12,10" CornerRadius="12,12,0,0">
                <Border.Background>
                  <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                    <GradientStop Color="#8B5CF6" Offset="0" />
                    <GradientStop Color="#7C3AED" Offset="1" />
                  </LinearGradientBrush>
                </Border.Background>
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <mi:MaterialIcon Kind="ScaleBathroom" Width="18" Height="18" Foreground="White" />
                  <TextBlock Text="{loc:Translate TrackingWeight}" FontSize="14" FontWeight="Bold" Foreground="White" />
                </StackPanel>
              </Border>
              <Grid ColumnDefinitions="*,*,*" Margin="16,14,16,16">
                <StackPanel HorizontalAlignment="Center">
                  <TextBlock Text="{Binding WeightCurrentDisplay}"
                             FontSize="26" FontWeight="Bold"
                             Foreground="#8B5CF6"
                             HorizontalAlignment="Center" />
                  <TextBlock Text="kg" FontSize="11" Foreground="{DynamicResource TextMutedBrush}" HorizontalAlignment="Center" />
                  <TextBlock Text="{loc:Translate Current}" FontSize="11" Foreground="{DynamicResource TextMutedBrush}" HorizontalAlignment="Center" />
                </StackPanel>
                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                  <TextBlock Text="{Binding WeightAverageDisplay}"
                             FontSize="18" FontWeight="Bold"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             HorizontalAlignment="Center" />
                  <TextBlock Text="kg" FontSize="11" Foreground="{DynamicResource TextMutedBrush}" HorizontalAlignment="Center" />
                  <TextBlock Text="{loc:Translate Average}" FontSize="11" Foreground="{DynamicResource TextMutedBrush}" HorizontalAlignment="Center" />
                </StackPanel>
                <!-- Trend mit Richtungspfeil -->
                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                  <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center">
                    <mi:MaterialIcon Kind="{Binding WeightTrendIcon}" Width="18" Height="18"
                                     VerticalAlignment="Center">
                      <mi:MaterialIcon.Foreground>
                        <SolidColorBrush Color="{Binding WeightTrendColor}" />
                      </mi:MaterialIcon.Foreground>
                    </mi:MaterialIcon>
                    <TextBlock Text="{Binding WeightTrendDisplay}"
                               FontSize="18" FontWeight="Bold"
                               HorizontalAlignment="Center">
                      <TextBlock.Foreground>
                        <SolidColorBrush Color="{Binding WeightTrendColor}" />
                      </TextBlock.Foreground>
                    </TextBlock>
                  </StackPanel>
                  <TextBlock Text="{Binding WeightTrendLabel}" FontSize="11"
                             HorizontalAlignment="Center">
                    <TextBlock.Foreground>
                      <SolidColorBrush Color="{Binding WeightTrendColor}" />
                    </TextBlock.Foreground>
                  </TextBlock>
                </StackPanel>
              </Grid>
            </StackPanel>
          </Border>

          <!-- Gewichtsziel-Karte (wenn Ziel gesetzt) -->
          <Border Classes="Card" Padding="14" IsVisible="{Binding HasWeightGoal}">
            <StackPanel Spacing="8">
              <Grid ColumnDefinitions="*,Auto">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <mi:MaterialIcon Kind="Target" Width="16" Height="16"
                                   Foreground="#8B5CF6" VerticalAlignment="Center" />
                  <TextBlock Text="{loc:Translate WeightGoalLabel}"
                             FontSize="14" FontWeight="SemiBold"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             VerticalAlignment="Center" />
                </StackPanel>
                <TextBlock Grid.Column="1"
                           Text="{Binding WeightGoalStatusText}"
                           FontSize="12"
                           Foreground="{DynamicResource TextMutedBrush}"
                           VerticalAlignment="Center" />
              </Grid>
              <ProgressBar Value="{Binding WeightGoalProgress}" Maximum="1"
                           Foreground="#8B5CF6" Height="10">
                <ProgressBar.Transitions>
                  <Transitions>
                    <DoubleTransition Property="Value" Duration="0:0:0.5" Easing="CubicEaseOut" />
                  </Transitions>
                </ProgressBar.Transitions>
              </ProgressBar>
            </StackPanel>
          </Border>

          <!-- Gewichtsziel setzen (wenn noch kein Ziel) -->
          <Border Classes="Card" Padding="14" IsVisible="{Binding !HasWeightGoal}">
            <StackPanel Spacing="6">
              <TextBlock Text="{loc:Translate SetWeightGoal}"
                         FontSize="13" Foreground="{DynamicResource TextMutedBrush}" />
              <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">
                <TextBox Text="{Binding WeightGoal}"
                         Watermark="{loc:Translate WeightGoalKg}" />
                <TextBlock Grid.Column="1" Text="kg" FontSize="14"
                           Foreground="{DynamicResource TextMutedBrush}"
                           VerticalAlignment="Center" />
                <Button Grid.Column="2" Classes="Primary Small"
                        Command="{Binding SetWeightGoalValueCommand}">
                  <mi:MaterialIcon Kind="Check" Width="18" Height="18" />
                </Button>
              </Grid>
            </StackPanel>
          </Border>

          <!-- Chart-Zeitraum Auswahl (Pill-Chips) -->
          <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="16" Padding="3" Margin="0,4,0,0">
            <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center">
              <Button Classes="Text" Padding="0" Height="NaN"
                      Command="{Binding SetChartRangeCommand}" CommandParameter="7">
                <Border CornerRadius="12" Padding="14,6" Cursor="Hand"
                        Background="{Binding IsChart7Days, Converter={x:Static conv:TabColorConverters.WeightTab}}">
                  <TextBlock Text="{loc:Translate Days7}" FontSize="12"
                             Foreground="{Binding IsChart7Days, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
                </Border>
              </Button>
              <Button Classes="Text" Padding="0" Height="NaN"
                      Command="{Binding SetChartRangeCommand}" CommandParameter="30">
                <Border CornerRadius="12" Padding="14,6" Cursor="Hand"
                        Background="{Binding IsChart30Days, Converter={x:Static conv:TabColorConverters.WeightTab}}">
                  <TextBlock Text="{loc:Translate Days30}" FontSize="12"
                             Foreground="{Binding IsChart30Days, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
                </Border>
              </Button>
              <Button Classes="Text" Padding="0" Height="NaN"
                      Command="{Binding SetChartRangeCommand}" CommandParameter="90">
                <Border CornerRadius="12" Padding="14,6" Cursor="Hand"
                        Background="{Binding IsChart90Days, Converter={x:Static conv:TabColorConverters.WeightTab}}">
                  <TextBlock Text="{loc:Translate Days90}" FontSize="12"
                             Foreground="{Binding IsChart90Days, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
                </Border>
              </Button>
            </StackPanel>
          </Border>

          <!-- Chart Card -->
          <Border Classes="StatsCard">
            <StackPanel Spacing="8">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <Border Background="#208B5CF6" Width="28" Height="28" CornerRadius="8">
                  <mi:MaterialIcon Kind="ChartLine" Width="16" Height="16"
                                   Foreground="#8B5CF6" />
                </Border>
                <TextBlock Text="{loc:Translate Trend}"
                           Classes="SectionTitle"
                           VerticalAlignment="Center" />
              </StackPanel>
              <lvc:CartesianChart Height="220"
                                  Series="{Binding WeightChartSeries}"
                                  XAxes="{Binding XAxes}"
                                  YAxes="{Binding YAxesWeight}"
                                  Sections="{Binding WeightMilestoneSections}"
                                  DrawMarginFrame="{Binding ChartFrame}"
                                  Background="Transparent"
                                  ZoomMode="None"
                                  AnimationsSpeed="0:0:0.3" />
            </StackPanel>
          </Border>

          <!-- Add Weight Form -->
          <Border Classes="Card" Padding="16"
                  Background="{DynamicResource PrimaryBrush}"
                  IsVisible="{Binding ShowAddForm}">
            <StackPanel Spacing="12">
              <TextBlock Text="{loc:Translate AddWeight}"
                         FontSize="18" FontWeight="Bold" Foreground="White" />
              <TextBox Text="{Binding NewValue}"
                       Watermark="{loc:Translate WeightValue}" />
              <CalendarDatePicker SelectedDate="{Binding NewDate}"
                                  HorizontalAlignment="Stretch" />
              <TextBox Text="{Binding NewNote}"
                       Watermark="{loc:Translate NotePlaceholder}" />
              <Grid ColumnDefinitions="*,8,*">
                <Button Grid.Column="0"
                        Command="{Binding ToggleAddFormCommand}"
                        Background="Transparent"
                        Foreground="White"
                        BorderBrush="White"
                        BorderThickness="1"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center">
                  <TextBlock Text="{loc:Translate Cancel}" />
                </Button>
                <Button Grid.Column="2" Classes="Success"
                        Command="{Binding AddEntryCommand}"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center">
                  <TextBlock Text="{loc:Translate Save}" />
                </Button>
              </Grid>
            </StackPanel>
          </Border>

          <!-- Weight Entries List -->
          <StackPanel Spacing="8" IsVisible="{Binding !ShowAddForm}">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Border Background="#208B5CF6" Width="28" Height="28" CornerRadius="8">
                <mi:MaterialIcon Kind="FormatListBulleted" Width="16" Height="16"
                                 Foreground="#8B5CF6" />
              </Border>
              <TextBlock Text="{loc:Translate WeightEntries}"
                         Classes="SectionTitle"
                         VerticalAlignment="Center" />
            </StackPanel>

            <!-- Empty State -->
            <StackPanel IsVisible="{Binding !WeightEntries.Count}"
                        HorizontalAlignment="Center" Spacing="8" Margin="0,24">
              <Border Classes="EmptyPulse" Width="64" Height="64" CornerRadius="32"
                      Background="{DynamicResource SurfaceBrush}"
                      HorizontalAlignment="Center">
                <mi:MaterialIcon Kind="ScaleBathroom" Width="32" Height="32"
                                 Foreground="{DynamicResource TextMutedBrush}" />
              </Border>
              <TextBlock Text="{loc:Translate NoEntriesYet}" FontSize="14" FontWeight="SemiBold"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         HorizontalAlignment="Center" />
              <TextBlock Text="{loc:Translate EmptyWeightHint}" Classes="Caption"
                         HorizontalAlignment="Center" TextAlignment="Center"
                         MaxWidth="250" TextWrapping="Wrap" />
            </StackPanel>

            <ItemsControl ItemsSource="{Binding WeightEntries}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:TrackingEntry">
                  <Border Classes="Card Compact" Margin="0,4" Padding="12">
                    <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                      <StackPanel VerticalAlignment="Center" Margin="0,0,12,0">
                        <TextBlock Text="{Binding Date, StringFormat='{}{0:dd}'}"
                                   FontSize="20" FontWeight="Bold"
                                   Foreground="{DynamicResource SuccessBrush}"
                                   HorizontalAlignment="Center" />
                        <TextBlock Text="{Binding Date, StringFormat='{}{0:MMM}'}"
                                   FontSize="10"
                                   Foreground="{DynamicResource TextMutedBrush}"
                                   HorizontalAlignment="Center" />
                      </StackPanel>
                      <TextBlock Grid.Column="1" Text="{Binding Note}" Classes="Caption"
                                 VerticalAlignment="Center"
                                 IsVisible="{Binding Note, Converter={StaticResource IsNotNullConverter}}" />
                      <TextBlock Grid.Column="2"
                                 Text="{Binding Value, StringFormat='{}{0:F1} kg'}"
                                 FontSize="18" FontWeight="Bold"
                                 Foreground="{DynamicResource SuccessBrush}"
                                 VerticalAlignment="Center" />
                      <Button Grid.Column="3" Classes="Icon"
                              Command="{Binding $parent[ItemsControl].((vm:ProgressViewModel)DataContext).DeleteEntryCommand}"
                              CommandParameter="{Binding .}"
                              Margin="8,0,0,0">
                        <mi:MaterialIcon Kind="Delete" Width="18" Height="18"
                                         Foreground="{DynamicResource ErrorBrush}" />
                      </Button>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </StackPanel>

        <!-- ==================== BODY TAB ==================== -->
        <StackPanel Spacing="16" IsVisible="{Binding IsBodyTab}">

          <!-- Sub-Tabs (BMI / Body Fat) -->
          <Grid ColumnDefinitions="*,8,*">
            <Button Grid.Column="0" Classes="Text" Padding="0" Height="NaN"
                    Command="{Binding SelectBmiCommand}"
                    HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
              <Border CornerRadius="12" Padding="12" Cursor="Hand"
                      Background="{Binding IsBmiSelected, Converter={x:Static conv:TabColorConverters.BodyTab}}">
                <TextBlock Text="BMI" FontSize="16" FontWeight="Bold"
                           Foreground="{Binding IsBmiSelected, Converter={x:Static conv:TabColorConverters.ActiveText}}"
                           HorizontalAlignment="Center" />
              </Border>
            </Button>
            <Button Grid.Column="2" Classes="Text" Padding="0" Height="NaN"
                    Command="{Binding SelectBodyFatCommand}"
                    HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
              <Border CornerRadius="12" Padding="12" Cursor="Hand"
                      Background="{Binding IsBodyFatSelected, Converter={x:Static conv:TabColorConverters.BodyFatTab}}">
                <TextBlock Text="{loc:Translate BodyFat}" FontSize="16" FontWeight="Bold"
                           Foreground="{Binding IsBodyFatSelected, Converter={x:Static conv:TabColorConverters.ActiveText}}"
                           HorizontalAlignment="Center" />
              </Border>
            </Button>
          </Grid>

          <!-- Chart-Zeitraum Auswahl (Pill-Chips) -->
          <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="16" Padding="3">
            <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center">
              <Button Classes="Text" Padding="0" Height="NaN"
                      Command="{Binding SetChartRangeCommand}" CommandParameter="7">
                <Border CornerRadius="12" Padding="14,6" Cursor="Hand"
                        Background="{Binding IsChart7Days, Converter={x:Static conv:TabColorConverters.BodyTab}}">
                  <TextBlock Text="{loc:Translate Days7}" FontSize="12"
                             Foreground="{Binding IsChart7Days, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
                </Border>
              </Button>
              <Button Classes="Text" Padding="0" Height="NaN"
                      Command="{Binding SetChartRangeCommand}" CommandParameter="30">
                <Border CornerRadius="12" Padding="14,6" Cursor="Hand"
                        Background="{Binding IsChart30Days, Converter={x:Static conv:TabColorConverters.BodyTab}}">
                  <TextBlock Text="{loc:Translate Days30}" FontSize="12"
                             Foreground="{Binding IsChart30Days, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
                </Border>
              </Button>
              <Button Classes="Text" Padding="0" Height="NaN"
                      Command="{Binding SetChartRangeCommand}" CommandParameter="90">
                <Border CornerRadius="12" Padding="14,6" Cursor="Hand"
                        Background="{Binding IsChart90Days, Converter={x:Static conv:TabColorConverters.BodyTab}}">
                  <TextBlock Text="{loc:Translate Days90}" FontSize="12"
                             Foreground="{Binding IsChart90Days, Converter={x:Static conv:TabColorConverters.ActiveText}}" />
                </Border>
              </Button>
            </StackPanel>
          </Border>

          <!-- BMI Content -->
          <StackPanel Spacing="16" IsVisible="{Binding IsBmiSelected}">

            <!-- BMI Stats -->
            <Border Classes="Card" Padding="0" ClipToBounds="True">
              <StackPanel>
                <Border Padding="12,10" CornerRadius="12,12,0,0">
                  <Border.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                      <GradientStop Color="#3B82F6" Offset="0" />
                      <GradientStop Color="#2563EB" Offset="1" />
                    </LinearGradientBrush>
                  </Border.Background>
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <mi:MaterialIcon Kind="ScaleBalance" Width="18" Height="18" Foreground="White" />
                    <TextBlock Text="{loc:Translate BmiStats30Days}" FontSize="14" FontWeight="Bold" Foreground="White" />
                  </StackPanel>
                </Border>
              <StackPanel Spacing="12" Margin="16,14,16,16">
                <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                  <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="{Binding BmiCurrentDisplay}"
                               FontSize="20" FontWeight="Bold"
                               Foreground="{DynamicResource InfoBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Current}" Classes="Caption" HorizontalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding BmiAverageDisplay}"
                               FontSize="16" Foreground="{DynamicResource TextPrimaryBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Average}" Classes="Caption" HorizontalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding BmiTrendDisplay}"
                               FontSize="16" Foreground="{DynamicResource TextPrimaryBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Trend}" Classes="Caption" HorizontalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Row="1" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding BmiMinDisplay}"
                               FontSize="14" Foreground="{DynamicResource TextPrimaryBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Min}" FontSize="10"
                               Foreground="{DynamicResource TextMutedBrush}"
                               HorizontalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Row="1" Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding BmiMaxDisplay}"
                               FontSize="14" Foreground="{DynamicResource TextPrimaryBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Max}" FontSize="10"
                               Foreground="{DynamicResource TextMutedBrush}"
                               HorizontalAlignment="Center" />
                  </StackPanel>
                </Grid>
              </StackPanel>
              </StackPanel>
            </Border>

            <!-- BMI Chart -->
            <Border Classes="StatsCard">
              <StackPanel Spacing="8">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Border Background="#203B82F6" Width="28" Height="28" CornerRadius="8">
                    <mi:MaterialIcon Kind="ChartLine" Width="16" Height="16"
                                     Foreground="#3B82F6" />
                  </Border>
                  <TextBlock Text="BMI Trend"
                             Classes="SectionTitle"
                             VerticalAlignment="Center" />
                </StackPanel>
                <lvc:CartesianChart Height="220"
                                    Series="{Binding BmiChartSeries}"
                                    XAxes="{Binding XAxes}"
                                    YAxes="{Binding YAxesBmi}"
                                    Sections="{Binding BmiSections}"
                                    DrawMarginFrame="{Binding ChartFrame}"
                                    Background="Transparent"
                                    ZoomMode="None"
                                  AnimationsSpeed="0:0:0.3" />
                <TextBlock Text="{loc:Translate HealthyBmiRange}" Classes="Caption"
                           HorizontalAlignment="Center" />
              </StackPanel>
            </Border>

            <!-- BMI Entries -->
            <StackPanel Spacing="8">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <Border Background="#203B82F6" Width="28" Height="28" CornerRadius="8">
                  <mi:MaterialIcon Kind="FormatListBulleted" Width="16" Height="16"
                                   Foreground="#3B82F6" />
                </Border>
                <TextBlock Text="{loc:Translate BmiEntries}"
                           Classes="SectionTitle"
                           VerticalAlignment="Center" />
              </StackPanel>
              <StackPanel IsVisible="{Binding !HasBmiEntries}"
                          HorizontalAlignment="Center" Spacing="6" Margin="0,20">
                <Border Classes="EmptyPulse" Width="56" Height="56" CornerRadius="28"
                        Background="{DynamicResource SurfaceBrush}"
                        HorizontalAlignment="Center">
                  <mi:MaterialIcon Kind="ScaleBalance" Width="28" Height="28"
                                   Foreground="{DynamicResource TextMutedBrush}" />
                </Border>
                <TextBlock Text="{loc:Translate EmptyBmiHint}" Classes="Caption"
                           HorizontalAlignment="Center" TextAlignment="Center"
                           MaxWidth="250" TextWrapping="Wrap" />
              </StackPanel>
              <ItemsControl ItemsSource="{Binding BmiEntries}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate x:DataType="models:TrackingEntry">
                    <Border Classes="Card Compact" Margin="0,4" Padding="12">
                      <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                        <StackPanel VerticalAlignment="Center" Margin="0,0,12,0">
                          <TextBlock Text="{Binding Date, StringFormat='{}{0:dd}'}"
                                     FontSize="20" FontWeight="Bold"
                                     Foreground="{DynamicResource InfoBrush}"
                                     HorizontalAlignment="Center" />
                          <TextBlock Text="{Binding Date, StringFormat='{}{0:MMM}'}"
                                     FontSize="10" Foreground="{DynamicResource TextMutedBrush}"
                                     HorizontalAlignment="Center" />
                        </StackPanel>
                        <TextBlock Grid.Column="1" Text="{Binding Note}" Classes="Caption"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding Note, Converter={StaticResource IsNotNullConverter}}" />
                        <TextBlock Grid.Column="2"
                                   Text="{Binding Value, StringFormat='{}{0:F1}'}"
                                   FontSize="18" FontWeight="Bold"
                                   Foreground="{DynamicResource InfoBrush}"
                                   VerticalAlignment="Center" />
                        <Button Grid.Column="3" Classes="Icon"
                                Command="{Binding $parent[ItemsControl].((vm:ProgressViewModel)DataContext).DeleteEntryCommand}"
                                CommandParameter="{Binding .}"
                                Margin="8,0,0,0">
                          <mi:MaterialIcon Kind="Delete" Width="18" Height="18"
                                           Foreground="{DynamicResource ErrorBrush}" />
                        </Button>
                      </Grid>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </StackPanel>

          <!-- Body Fat Content -->
          <StackPanel Spacing="16" IsVisible="{Binding IsBodyFatSelected}">

            <!-- Body Fat Stats -->
            <Border Classes="Card" Padding="0" ClipToBounds="True">
              <StackPanel>
                <Border Padding="12,10" CornerRadius="12,12,0,0">
                  <Border.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                      <GradientStop Color="#F59E0B" Offset="0" />
                      <GradientStop Color="#D97706" Offset="1" />
                    </LinearGradientBrush>
                  </Border.Background>
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <mi:MaterialIcon Kind="PercentCircle" Width="18" Height="18" Foreground="White" />
                    <TextBlock Text="{loc:Translate BodyFatStats30Days}" FontSize="14" FontWeight="Bold" Foreground="White" />
                  </StackPanel>
                </Border>
              <StackPanel Spacing="12" Margin="16,14,16,16">
                <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                  <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="{Binding BodyFatCurrentDisplay}"
                               FontSize="20" FontWeight="Bold"
                               Foreground="{DynamicResource WarningBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Current}" Classes="Caption" HorizontalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding BodyFatAverageDisplay}"
                               FontSize="16" Foreground="{DynamicResource TextPrimaryBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Average}" Classes="Caption" HorizontalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding BodyFatTrendDisplay}"
                               FontSize="16" Foreground="{DynamicResource TextPrimaryBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Trend}" Classes="Caption" HorizontalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Row="1" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding BodyFatMinDisplay}"
                               FontSize="14" Foreground="{DynamicResource TextPrimaryBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Min}" FontSize="10"
                               Foreground="{DynamicResource TextMutedBrush}"
                               HorizontalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Row="1" Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding BodyFatMaxDisplay}"
                               FontSize="14" Foreground="{DynamicResource TextPrimaryBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Max}" FontSize="10"
                               Foreground="{DynamicResource TextMutedBrush}"
                               HorizontalAlignment="Center" />
                  </StackPanel>
                </Grid>
              </StackPanel>
              </StackPanel>
            </Border>

            <!-- Body Fat Chart -->
            <Border Classes="StatsCard">
              <StackPanel Spacing="8">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Border Background="#20F59E0B" Width="28" Height="28" CornerRadius="8">
                    <mi:MaterialIcon Kind="ChartLine" Width="16" Height="16"
                                     Foreground="#F59E0B" />
                  </Border>
                  <TextBlock Text="{loc:Translate BodyFat}"
                             Classes="SectionTitle"
                             VerticalAlignment="Center" />
                </StackPanel>
                <lvc:CartesianChart Height="220"
                                    Series="{Binding BodyFatChartSeries}"
                                    XAxes="{Binding XAxes}"
                                    YAxes="{Binding YAxesBodyFat}"
                                    DrawMarginFrame="{Binding ChartFrame}"
                                    Background="Transparent"
                                    ZoomMode="None"
                                    AnimationsSpeed="0:0:0.3" />
              </StackPanel>
            </Border>

            <!-- Body Fat Entries -->
            <StackPanel Spacing="8">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <Border Background="#20F59E0B" Width="28" Height="28" CornerRadius="8">
                  <mi:MaterialIcon Kind="FormatListBulleted" Width="16" Height="16"
                                   Foreground="#F59E0B" />
                </Border>
                <TextBlock Text="{loc:Translate BodyFatEntries}"
                           Classes="SectionTitle"
                           VerticalAlignment="Center" />
              </StackPanel>
              <StackPanel IsVisible="{Binding !HasBodyFatEntries}"
                          HorizontalAlignment="Center" Spacing="6" Margin="0,20">
                <Border Classes="EmptyPulse" Width="56" Height="56" CornerRadius="28"
                        Background="{DynamicResource SurfaceBrush}"
                        HorizontalAlignment="Center">
                  <mi:MaterialIcon Kind="PercentCircle" Width="28" Height="28"
                                   Foreground="{DynamicResource TextMutedBrush}" />
                </Border>
                <TextBlock Text="{loc:Translate EmptyBodyFatHint}" Classes="Caption"
                           HorizontalAlignment="Center" TextAlignment="Center"
                           MaxWidth="250" TextWrapping="Wrap" />
              </StackPanel>
              <ItemsControl ItemsSource="{Binding BodyFatEntries}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate x:DataType="models:TrackingEntry">
                    <Border Classes="Card Compact" Margin="0,4" Padding="12">
                      <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                        <StackPanel VerticalAlignment="Center" Margin="0,0,12,0">
                          <TextBlock Text="{Binding Date, StringFormat='{}{0:dd}'}"
                                     FontSize="20" FontWeight="Bold"
                                     Foreground="{DynamicResource WarningBrush}"
                                     HorizontalAlignment="Center" />
                          <TextBlock Text="{Binding Date, StringFormat='{}{0:MMM}'}"
                                     FontSize="10" Foreground="{DynamicResource TextMutedBrush}"
                                     HorizontalAlignment="Center" />
                        </StackPanel>
                        <TextBlock Grid.Column="1" Text="{Binding Note}" Classes="Caption"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding Note, Converter={StaticResource IsNotNullConverter}}" />
                        <TextBlock Grid.Column="2"
                                   Text="{Binding Value, StringFormat='{}{0:F1}%'}"
                                   FontSize="18" FontWeight="Bold"
                                   Foreground="{DynamicResource WarningBrush}"
                                   VerticalAlignment="Center" />
                        <Button Grid.Column="3" Classes="Icon"
                                Command="{Binding $parent[ItemsControl].((vm:ProgressViewModel)DataContext).DeleteEntryCommand}"
                                CommandParameter="{Binding .}"
                                Margin="8,0,0,0">
                          <mi:MaterialIcon Kind="Delete" Width="18" Height="18"
                                           Foreground="{DynamicResource ErrorBrush}" />
                        </Button>
                      </Grid>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </StackPanel>

          <!-- Add Form for Body Tab -->
          <Border Classes="Card" Padding="16"
                  Background="{DynamicResource PrimaryBrush}"
                  IsVisible="{Binding ShowAddForm}">
            <StackPanel Spacing="12">
              <TextBlock Text="{Binding IsBmiSelected, Converter={StaticResource BmiBodyFatConverter}}"
                         FontSize="18" FontWeight="Bold" Foreground="White" />
              <TextBox Text="{Binding NewValue}" Watermark="{loc:Translate Input}" />
              <CalendarDatePicker SelectedDate="{Binding NewDate}"
                                  HorizontalAlignment="Stretch" />
              <TextBox Text="{Binding NewNote}"
                       Watermark="{loc:Translate NotePlaceholder}" />
              <Grid ColumnDefinitions="*,8,*">
                <Button Grid.Column="0"
                        Command="{Binding ToggleAddFormCommand}"
                        Background="Transparent"
                        Foreground="White"
                        BorderBrush="White"
                        BorderThickness="1"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center">
                  <TextBlock Text="{loc:Translate Cancel}" />
                </Button>
                <Button Grid.Column="2" Classes="Success"
                        Command="{Binding AddEntryCommand}"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center">
                  <TextBlock Text="{loc:Translate Save}" />
                </Button>
              </Grid>
            </StackPanel>
          </Border>
        </StackPanel>

        <!-- ==================== WATER TAB ==================== -->
        <StackPanel Spacing="16" IsVisible="{Binding IsWaterTab}">

          <!-- Water Progress Card -->
          <Border Classes="Card" Padding="0" ClipToBounds="True">
            <StackPanel>
              <!-- Gradient Header -->
              <Border Padding="12,10" CornerRadius="12,12,0,0">
                <Border.Background>
                  <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                    <GradientStop Color="#06B6D4" Offset="0" />
                    <GradientStop Color="#3B82F6" Offset="1" />
                  </LinearGradientBrush>
                </Border.Background>
                <Grid ColumnDefinitions="Auto,*,Auto">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <mi:MaterialIcon Kind="Water" Width="18" Height="18" Foreground="White" />
                    <TextBlock Text="{loc:Translate WaterToday}" FontSize="14" FontWeight="Bold" Foreground="White" />
                  </StackPanel>
                  <TextBlock Grid.Column="2" Text="{Binding WaterStatusText}"
                             FontSize="12" Foreground="#EEFFFFFF" VerticalAlignment="Center" />
                </Grid>
              </Border>
              <StackPanel Spacing="10" Margin="16,14,16,16">
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                  <ProgressBar Value="{Binding WaterProgress}"
                               Maximum="1"
                               Foreground="#06B6D4"
                               Height="14">
                    <ProgressBar.Transitions>
                      <Transitions>
                        <DoubleTransition Property="Value" Duration="0:0:0.5" Easing="CubicEaseOut" />
                      </Transitions>
                    </ProgressBar.Transitions>
                  </ProgressBar>
                  <TextBlock Grid.Column="1"
                             Text="{Binding TodayWater, StringFormat='{}{0:F0} ml'}"
                             FontSize="18" FontWeight="Bold"
                             Foreground="#06B6D4"
                             VerticalAlignment="Center" />
                </Grid>
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- Quick-Add Buttons -->
          <StackPanel Orientation="Horizontal" Spacing="8">
            <Border Background="#2006B6D4" Width="28" Height="28" CornerRadius="8">
              <mi:MaterialIcon Kind="Plus" Width="16" Height="16"
                               Foreground="#06B6D4" />
            </Border>
            <TextBlock Text="{loc:Translate QuickAdd}"
                       Classes="SectionTitle"
                       VerticalAlignment="Center" />
          </StackPanel>
          <Grid ColumnDefinitions="*,8,*,8,*">
            <Button Grid.Column="0" Classes="Secondary"
                    Command="{Binding QuickAddWaterCommand}"
                    CommandParameter="250"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center">
              <TextBlock Text="+250ml" FontSize="14" />
            </Button>
            <Button Grid.Column="2" Classes="Secondary"
                    Command="{Binding QuickAddWaterCommand}"
                    CommandParameter="500"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center">
              <TextBlock Text="+500ml" FontSize="14" />
            </Button>
            <Button Grid.Column="4" Classes="Primary"
                    Command="{Binding QuickAddWaterCommand}"
                    CommandParameter="1000"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center">
              <TextBlock Text="+1L" FontSize="14" />
            </Button>
          </Grid>

          <!-- Water Goal Input -->
          <Border Classes="Card" Padding="16">
            <StackPanel Spacing="8">
              <TextBlock Text="{loc:Translate WaterGoal}"
                         FontSize="14" FontWeight="SemiBold"
                         Foreground="{DynamicResource TextPrimaryBrush}" />
              <Grid ColumnDefinitions="*,8,Auto">
                <TextBox Grid.Column="0"
                         Text="{Binding DailyWaterGoal}"
                         Watermark="ml" />
                <Button Grid.Column="2" Classes="Primary"
                        Command="{Binding SetWaterGoalCommand}"
                        HorizontalContentAlignment="Center">
                  <StackPanel Orientation="Horizontal" Spacing="6">
                    <mi:MaterialIcon Kind="ContentSave" Width="18" Height="18" />
                    <TextBlock Text="{loc:Translate Save}" VerticalAlignment="Center" />
                  </StackPanel>
                </Button>
              </Grid>
            </StackPanel>
          </Border>
        </StackPanel>

        <!-- ==================== CALORIES TAB ==================== -->
        <StackPanel Spacing="16" IsVisible="{Binding IsCaloriesTab}">

          <!-- Calorie Overview Card -->
          <Border Classes="Card" Padding="0" ClipToBounds="True">
            <StackPanel>
              <!-- Gradient Header -->
              <Border Padding="12,10" CornerRadius="12,12,0,0">
                <Border.Background>
                  <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                    <GradientStop Color="#F59E0B" Offset="0" />
                    <GradientStop Color="#EF4444" Offset="1" />
                  </LinearGradientBrush>
                </Border.Background>
                <Grid ColumnDefinitions="Auto,*,Auto">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <mi:MaterialIcon Kind="Fire" Width="18" Height="18" Foreground="White" />
                    <TextBlock Text="{loc:Translate TabCalories}" FontSize="14" FontWeight="Bold" Foreground="White" />
                  </StackPanel>
                  <TextBlock Grid.Column="2" Text="{Binding CalorieStatusText}"
                             FontSize="12" Foreground="#EEFFFFFF" VerticalAlignment="Center" />
                </Grid>
              </Border>
              <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12" Margin="16,14,16,16">
                <StackPanel HorizontalAlignment="Center">
                  <TextBlock Text="{Binding DailyCalorieGoal, StringFormat='{}{0:F0}'}"
                             FontSize="22" FontWeight="Bold"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             HorizontalAlignment="Center" />
                  <TextBlock Text="kcal" FontSize="10" Foreground="{DynamicResource TextMutedBrush}" HorizontalAlignment="Center" />
                  <TextBlock Text="{loc:Translate GoalLabel}" FontSize="11"
                             Foreground="{DynamicResource TextMutedBrush}"
                             HorizontalAlignment="Center" />
                </StackPanel>
                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                  <TextBlock Text="{Binding ConsumedCalories, StringFormat='{}{0:F0}'}"
                             FontSize="22" FontWeight="Bold"
                             Foreground="#F59E0B"
                             HorizontalAlignment="Center" />
                  <TextBlock Text="kcal" FontSize="10" Foreground="{DynamicResource TextMutedBrush}" HorizontalAlignment="Center" />
                  <TextBlock Text="{loc:Translate Consumed}" FontSize="11"
                             Foreground="{DynamicResource TextMutedBrush}"
                             HorizontalAlignment="Center" />
                </StackPanel>
                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                  <TextBlock Text="{Binding RemainingCalories, StringFormat='{}{0:F0}'}"
                             FontSize="22" FontWeight="Bold"
                             Foreground="{DynamicResource AccentBrush}"
                             HorizontalAlignment="Center" />
                  <TextBlock Text="kcal" FontSize="10" Foreground="{DynamicResource TextMutedBrush}" HorizontalAlignment="Center" />
                  <TextBlock Text="{loc:Translate Remaining}" FontSize="11"
                             Foreground="{DynamicResource TextMutedBrush}"
                             HorizontalAlignment="Center" />
                </StackPanel>
              </Grid>
            </StackPanel>
          </Border>

          <!-- Macro Progress Card -->
          <Border Classes="StatsCard"
                  IsVisible="{Binding HasMacroGoals}">
            <StackPanel Spacing="8">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <Border Background="#2022C55E" Width="28" Height="28" CornerRadius="8">
                  <mi:MaterialIcon Kind="FoodApple" Width="16" Height="16"
                                   Foreground="#22C55E" />
                </Border>
                <TextBlock Text="{loc:Translate Macros}"
                           Classes="SectionTitle"
                           VerticalAlignment="Center" />
              </StackPanel>

              <!-- Protein -->
              <Grid ColumnDefinitions="60,*,40" ColumnSpacing="8">
                <TextBlock Text="{loc:Translate Protein}" FontSize="12"
                           Foreground="{DynamicResource SuccessBrush}" VerticalAlignment="Center" />
                <ProgressBar Grid.Column="1"
                             Value="{Binding ProteinProgress}"
                             Maximum="1"
                             Foreground="{DynamicResource SuccessBrush}"
                             Height="8" />
                <TextBlock Grid.Column="2"
                           Text="{Binding ProteinConsumed, StringFormat='{}{0:F0}g'}"
                           FontSize="12" Foreground="{DynamicResource SuccessBrush}"
                           HorizontalAlignment="Right" VerticalAlignment="Center" />
              </Grid>

              <!-- Carbs -->
              <Grid ColumnDefinitions="60,*,40" ColumnSpacing="8">
                <TextBlock Text="{loc:Translate Carbs}" FontSize="12"
                           Foreground="{DynamicResource WarningBrush}" VerticalAlignment="Center" />
                <ProgressBar Grid.Column="1"
                             Value="{Binding CarbsProgress}"
                             Maximum="1"
                             Foreground="{DynamicResource WarningBrush}"
                             Height="8" />
                <TextBlock Grid.Column="2"
                           Text="{Binding CarbsConsumed, StringFormat='{}{0:F0}g'}"
                           FontSize="12" Foreground="{DynamicResource WarningBrush}"
                           HorizontalAlignment="Right" VerticalAlignment="Center" />
              </Grid>

              <!-- Fat -->
              <Grid ColumnDefinitions="60,*,40" ColumnSpacing="8">
                <TextBlock Text="{loc:Translate Fat}" FontSize="12"
                           Foreground="{DynamicResource ErrorBrush}" VerticalAlignment="Center" />
                <ProgressBar Grid.Column="1"
                             Value="{Binding FatProgress}"
                             Maximum="1"
                             Foreground="{DynamicResource ErrorBrush}"
                             Height="8" />
                <TextBlock Grid.Column="2"
                           Text="{Binding FatConsumed, StringFormat='{}{0:F0}g'}"
                           FontSize="12" Foreground="{DynamicResource ErrorBrush}"
                           HorizontalAlignment="Right" VerticalAlignment="Center" />
              </Grid>
            </StackPanel>
          </Border>

          <!-- Kopier-Button + berschrift -->
          <Grid ColumnDefinitions="*,Auto">
            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
              <Border Background="#20EF4444" Width="28" Height="28" CornerRadius="8">
                <mi:MaterialIcon Kind="Silverware" Width="16" Height="16"
                                 Foreground="#EF4444" />
              </Border>
              <TextBlock Text="{loc:Translate TodayMeals}"
                         Classes="SectionTitle"
                         VerticalAlignment="Center" />
            </StackPanel>
            <Button Grid.Column="1" Classes="Text Small"
                    Command="{Binding CopyYesterdayMealsCommand}"
                    ToolTip.Tip="{loc:Translate CopyYesterday}">
              <StackPanel Orientation="Horizontal" Spacing="4">
                <mi:MaterialIcon Kind="ContentCopy" Width="16" Height="16"
                                 Foreground="{DynamicResource TextMutedBrush}" />
                <TextBlock Text="{loc:Translate CopyYesterday}" FontSize="11"
                           Foreground="{DynamicResource TextMutedBrush}"
                           VerticalAlignment="Center" />
              </StackPanel>
            </Button>
          </Grid>

          <!-- Motivierender Empty State -->
          <StackPanel IsVisible="{Binding !HasMeals}"
                      HorizontalAlignment="Center" Spacing="8" Margin="0,24">
            <Border Classes="EmptyPulse" Width="64" Height="64" CornerRadius="32"
                    Background="{DynamicResource SurfaceBrush}"
                    HorizontalAlignment="Center">
              <mi:MaterialIcon Kind="FoodApple" Width="32" Height="32"
                               Foreground="{DynamicResource TextMutedBrush}" />
            </Border>
            <TextBlock Text="{loc:Translate NoMealsYet}" FontSize="14" FontWeight="SemiBold"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate EmptyCaloriesHint}" Classes="Caption"
                       HorizontalAlignment="Center" TextAlignment="Center"
                       MaxWidth="250" TextWrapping="Wrap" />
          </StackPanel>

          <!-- Gruppierte Mahlzeiten -->
          <StackPanel Spacing="10" IsVisible="{Binding HasMeals}">

            <!-- Frhstck -->
            <StackPanel Spacing="2" IsVisible="{Binding HasBreakfast}">
              <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,2">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <mi:MaterialIcon Kind="Coffee" Width="16" Height="16" Foreground="#F59E0B" />
                  <TextBlock Text="{loc:Translate Breakfast}" FontSize="13" FontWeight="Bold"
                             Foreground="{DynamicResource TextPrimaryBrush}" />
                </StackPanel>
                <TextBlock Grid.Column="1"
                           Text="{Binding BreakfastCalories, StringFormat='{}{0:F0} kcal'}"
                           FontSize="12" Foreground="{DynamicResource TextMutedBrush}" />
              </Grid>
              <ItemsControl ItemsSource="{Binding BreakfastMeals}"
                            ItemTemplate="{StaticResource MealItemTemplate}" />
            </StackPanel>

            <!-- Mittagessen -->
            <StackPanel Spacing="2" IsVisible="{Binding HasLunch}">
              <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,2">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <mi:MaterialIcon Kind="FoodDrumstick" Width="16" Height="16" Foreground="#22C55E" />
                  <TextBlock Text="{loc:Translate Lunch}" FontSize="13" FontWeight="Bold"
                             Foreground="{DynamicResource TextPrimaryBrush}" />
                </StackPanel>
                <TextBlock Grid.Column="1"
                           Text="{Binding LunchCalories, StringFormat='{}{0:F0} kcal'}"
                           FontSize="12" Foreground="{DynamicResource TextMutedBrush}" />
              </Grid>
              <ItemsControl ItemsSource="{Binding LunchMeals}"
                            ItemTemplate="{StaticResource MealItemTemplate}" />
            </StackPanel>

            <!-- Abendessen -->
            <StackPanel Spacing="2" IsVisible="{Binding HasDinner}">
              <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,2">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <mi:MaterialIcon Kind="Silverware" Width="16" Height="16" Foreground="#8B5CF6" />
                  <TextBlock Text="{loc:Translate Dinner}" FontSize="13" FontWeight="Bold"
                             Foreground="{DynamicResource TextPrimaryBrush}" />
                </StackPanel>
                <TextBlock Grid.Column="1"
                           Text="{Binding DinnerCalories, StringFormat='{}{0:F0} kcal'}"
                           FontSize="12" Foreground="{DynamicResource TextMutedBrush}" />
              </Grid>
              <ItemsControl ItemsSource="{Binding DinnerMeals}"
                            ItemTemplate="{StaticResource MealItemTemplate}" />
            </StackPanel>

            <!-- Snacks -->
            <StackPanel Spacing="2" IsVisible="{Binding HasSnack}">
              <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,2">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <mi:MaterialIcon Kind="Cookie" Width="16" Height="16" Foreground="#EF4444" />
                  <TextBlock Text="{loc:Translate Snack}" FontSize="13" FontWeight="Bold"
                             Foreground="{DynamicResource TextPrimaryBrush}" />
                </StackPanel>
                <TextBlock Grid.Column="1"
                           Text="{Binding SnackCalories, StringFormat='{}{0:F0} kcal'}"
                           FontSize="12" Foreground="{DynamicResource TextMutedBrush}" />
              </Grid>
              <ItemsControl ItemsSource="{Binding SnackMeals}"
                            ItemTemplate="{StaticResource MealItemTemplate}" />
            </StackPanel>
          </StackPanel>

          <!-- Wochen-Kalorien Chart -->
          <Border Classes="StatsCard" IsVisible="{Binding HasWeeklyData}">
            <StackPanel Spacing="8">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <Border Background="#20F59E0B" Width="28" Height="28" CornerRadius="8">
                  <mi:MaterialIcon Kind="ChartBar" Width="16" Height="16"
                                   Foreground="#F59E0B" />
                </Border>
                <TextBlock Text="{loc:Translate WeeklyCalories}"
                           Classes="SectionTitle"
                           VerticalAlignment="Center" />
              </StackPanel>
              <lvc:CartesianChart Height="160"
                                  Series="{Binding WeeklyCaloriesSeries}"
                                  XAxes="{Binding WeeklyXAxes}"
                                  YAxes="{Binding WeeklyYAxes}"
                                  DrawMarginFrame="{Binding ChartFrame}"
                                  Background="Transparent"
                                  ZoomMode="None"
                                  AnimationsSpeed="0:0:0.3" />
            </StackPanel>
          </Border>

          <!-- Add Food Button -->
          <Button Classes="Primary"
                  Command="{Binding ToggleFoodSearchCommand}"
                  IsVisible="{Binding !ShowFoodSearch}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <mi:MaterialIcon Kind="Plus" Width="18" Height="18" />
              <TextBlock Text="{loc:Translate AddFood}" VerticalAlignment="Center" />
            </StackPanel>
          </Button>

          <!-- ==================== INLINE FOOD SEARCH ==================== -->
          <StackPanel Spacing="12" IsVisible="{Binding ShowFoodSearch}">

            <!-- Suchleiste -->
            <Border Classes="Card" Padding="12">
              <Grid ColumnDefinitions="Auto,*,Auto">
                <mi:MaterialIcon Kind="Magnify" Width="20" Height="20"
                                 Foreground="{DynamicResource TextMutedBrush}"
                                 VerticalAlignment="Center"
                                 Margin="0,0,10,0" />
                <TextBox Grid.Column="1"
                         Text="{Binding SearchQuery}"
                         Watermark="{loc:Translate SearchFoodPlaceholder}"
                         Background="Transparent"
                         BorderThickness="0"
                         Height="NaN" />
                <Button Grid.Column="2" Classes="Text Small"
                        Command="{Binding ToggleFoodSearchCommand}">
                  <mi:MaterialIcon Kind="Close" Width="18" Height="18"
                                   Foreground="{DynamicResource TextMutedBrush}" />
                </Button>
              </Grid>
            </Border>

            <!-- Ausgewhltes Lebensmittel - Portion & Hinzufgen -->
            <Border Classes="Card" Padding="16"
                    IsVisible="{Binding ShowAddFoodPanel}">
              <StackPanel Spacing="12">
                <TextBlock Text="{Binding SelectedFood.Name}"
                           FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           TextWrapping="Wrap" />

                <!-- Portion -->
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                  <TextBox Text="{Binding PortionGrams}"
                           Watermark="{loc:Translate AmountGrams}" />
                  <TextBlock Grid.Column="1" Text="g"
                             Foreground="{DynamicResource TextMutedBrush}"
                             VerticalAlignment="Center" FontSize="14" />
                </Grid>

                <!-- Nhrwert-Vorschau -->
                <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="4">
                  <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="{Binding CalculatedCalories, StringFormat='{}{0:F0}'}"
                               FontSize="16" FontWeight="Bold"
                               Foreground="{DynamicResource AccentBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="kcal" FontSize="10"
                               Foreground="{DynamicResource TextMutedBrush}"
                               HorizontalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding CalculatedProtein, StringFormat='{}{0:F1}g'}"
                               FontSize="13" Foreground="{DynamicResource SuccessBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Protein}" FontSize="10"
                               Foreground="{DynamicResource TextMutedBrush}"
                               HorizontalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding CalculatedCarbs, StringFormat='{}{0:F1}g'}"
                               FontSize="13" Foreground="{DynamicResource WarningBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Carbs}" FontSize="10"
                               Foreground="{DynamicResource TextMutedBrush}"
                               HorizontalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding CalculatedFat, StringFormat='{}{0:F1}g'}"
                               FontSize="13" Foreground="{DynamicResource ErrorBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{loc:Translate Fat}" FontSize="10"
                               Foreground="{DynamicResource TextMutedBrush}"
                               HorizontalAlignment="Center" />
                  </StackPanel>
                </Grid>

                <!-- Mahlzeit-Auswahl -->
                <ComboBox ItemsSource="{Binding Meals}"
                          SelectedIndex="{Binding SelectedMeal}"
                          HorizontalAlignment="Stretch" />

                <!-- Buttons -->
                <Grid ColumnDefinitions="*,8,*">
                  <Button Grid.Column="0" Classes="Outlined"
                          Command="{Binding CancelAddFoodCommand}"
                          HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Center">
                    <TextBlock Text="{loc:Translate Cancel}" />
                  </Button>
                  <Button Grid.Column="2" Classes="Success"
                          Command="{Binding AddFoodToLogCommand}"
                          HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Center">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                      <mi:MaterialIcon Kind="Plus" Width="18" Height="18" />
                      <TextBlock Text="{loc:Translate Add}" VerticalAlignment="Center" />
                    </StackPanel>
                  </Button>
                </Grid>
              </StackPanel>
            </Border>

            <!-- Suchergebnisse -->
            <ItemsControl ItemsSource="{Binding SearchResults}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:FoodSearchResult">
                  <Button Classes="Text" Padding="0" Height="NaN" Margin="0,2"
                          Command="{Binding $parent[ItemsControl].((vm:ProgressViewModel)DataContext).SelectFoodItemCommand}"
                          CommandParameter="{Binding .}"
                          HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch">
                    <Border Classes="Card Compact" Padding="12" Cursor="Hand">
                      <Grid ColumnDefinitions="*,Auto">
                        <StackPanel Spacing="2">
                          <TextBlock Text="{Binding Food.Name}"
                                     FontSize="14" FontWeight="SemiBold"
                                     Foreground="{DynamicResource TextPrimaryBrush}" />
                          <TextBlock Text="{Binding Food.CaloriesPer100g, StringFormat='{}{0:F0} kcal / 100g'}"
                                     FontSize="11" Foreground="{DynamicResource TextMutedBrush}" />
                        </StackPanel>
                        <mi:MaterialIcon Grid.Column="1" Kind="Plus" Width="20" Height="20"
                                         Foreground="{DynamicResource PrimaryBrush}"
                                         VerticalAlignment="Center" />
                      </Grid>
                    </Border>
                  </Button>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Hinweis wenn keine Suche -->
            <TextBlock Text="{loc:Translate SearchFoodPlaceholder}"
                       Classes="Caption"
                       HorizontalAlignment="Center"
                       Margin="0,8"
                       IsVisible="{Binding !SearchResults.Count}" />
          </StackPanel>

          <!-- Calorie Goal Input -->
          <Border Classes="Card" Padding="16">
            <StackPanel Spacing="8">
              <TextBlock Text="{loc:Translate SetCalorieGoal}"
                         FontSize="14" FontWeight="SemiBold"
                         Foreground="{DynamicResource TextPrimaryBrush}" />
              <Grid ColumnDefinitions="*,8,Auto">
                <TextBox Grid.Column="0"
                         Text="{Binding DailyCalorieGoal}"
                         Watermark="kcal" />
                <Button Grid.Column="2" Classes="Primary"
                        Command="{Binding SetCalorieGoalCommand}"
                        HorizontalContentAlignment="Center">
                  <StackPanel Orientation="Horizontal" Spacing="6">
                    <mi:MaterialIcon Kind="ContentSave" Width="18" Height="18" />
                    <TextBlock Text="{loc:Translate Save}" VerticalAlignment="Center" />
                  </StackPanel>
                </Button>
              </Grid>
            </StackPanel>
          </Border>
        </StackPanel>

        <!-- Loading Indicator -->
        <Border HorizontalAlignment="Center" VerticalAlignment="Center"
                IsVisible="{Binding IsLoading}" IsHitTestVisible="False">
          <ProgressBar IsIndeterminate="True" Width="120" />
        </Border>

      </Panel>
    </ScrollViewer>

    <!-- ============================================ -->
    <!-- Row 3: Undo Banner                           -->
    <!-- ============================================ -->
    <Border Grid.Row="3"
            Background="{DynamicResource SurfaceBrush}"
            CornerRadius="8"
            Padding="16,12"
            Margin="16,8"
            IsVisible="{Binding ShowUndoBanner}">
      <Grid ColumnDefinitions="*,Auto">
        <TextBlock Text="{Binding UndoMessage}"
                   Foreground="{DynamicResource TextPrimaryBrush}"
                   FontSize="14" VerticalAlignment="Center" />
        <Button Grid.Column="1" Classes="Warning Small"
                Command="{Binding UndoDeleteCommand}">
          <TextBlock Text="{loc:Translate Undo}" FontWeight="Bold" />
        </Button>
      </Grid>
    </Border>

    <!-- ============================================ -->
    <!-- Analysis Ad Overlay (Gate)                    -->
    <!-- ============================================ -->
    <Border Grid.RowSpan="4"
            Background="#CC000000"
            IsVisible="{Binding ShowAnalysisAdOverlay}"
            ZIndex="80">
      <Border Background="{DynamicResource SurfaceBrush}"
              CornerRadius="16"
              Padding="24"
              MaxWidth="350"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
        <StackPanel Spacing="16">
          <mi:MaterialIcon Kind="ChartBox" Width="48" Height="48"
                           Foreground="{DynamicResource InfoBrush}"
                           HorizontalAlignment="Center" />
          <TextBlock Text="{loc:Translate WeeklyAnalysis}"
                     FontSize="20" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center" />
          <TextBlock Text="{loc:Translate WeeklyAnalysisDesc}"
                     FontSize="14"
                     Foreground="{DynamicResource TextMutedBrush}"
                     TextWrapping="Wrap" TextAlignment="Center" />
          <Button Classes="Primary"
                  Command="{Binding ConfirmAnalysisAdCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="Play" Width="20" Height="20" />
              <TextBlock Text="{loc:Translate WeeklyAnalysis}" VerticalAlignment="Center" />
            </StackPanel>
          </Button>
          <Button Classes="Text"
                  Command="{Binding CloseAnalysisCommand}"
                  HorizontalAlignment="Center">
            <TextBlock Text="{loc:Translate Cancel}"
                       Foreground="{DynamicResource TextMutedBrush}" />
          </Button>
        </StackPanel>
      </Border>
    </Border>

    <!-- ============================================ -->
    <!-- Analysis Report Overlay                       -->
    <!-- ============================================ -->
    <Border Grid.RowSpan="4"
            Background="#CC000000"
            IsVisible="{Binding ShowAnalysisOverlay}"
            ZIndex="80">
      <Border Background="{DynamicResource SurfaceBrush}"
              CornerRadius="16"
              Padding="24"
              MaxWidth="400"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
        <StackPanel Spacing="16">
          <TextBlock Text="{loc:Translate WeeklyAnalysis}"
                     FontSize="20" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center" />

          <!-- Report-Daten -->
          <Border Classes="Card" Padding="16">
            <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="16" RowSpacing="12">
              <!-- Durchschn. Gewicht -->
              <StackPanel>
                <TextBlock Text="{loc:Translate AvgWeight}" FontSize="11"
                           Foreground="{DynamicResource TextMutedBrush}" />
                <TextBlock Text="{Binding AvgWeightDisplay}" FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource SuccessBrush}" />
              </StackPanel>

              <!-- Gewichtstrend -->
              <StackPanel Grid.Column="1">
                <TextBlock Text="{loc:Translate WeightTrend}" FontSize="11"
                           Foreground="{DynamicResource TextMutedBrush}" />
                <TextBlock Text="{Binding TrendDisplay}" FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource InfoBrush}" />
              </StackPanel>

              <!-- Durchschn. Kalorien -->
              <StackPanel Grid.Row="1">
                <TextBlock Text="{loc:Translate AvgCalories}" FontSize="11"
                           Foreground="{DynamicResource TextMutedBrush}" />
                <TextBlock Text="{Binding AvgCaloriesDisplay}" FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource ErrorBrush}" />
              </StackPanel>

              <!-- Kalorienziel-Erreichung -->
              <StackPanel Grid.Row="1" Grid.Column="1">
                <TextBlock Text="{loc:Translate CalorieTarget}" FontSize="11"
                           Foreground="{DynamicResource TextMutedBrush}" />
                <TextBlock Text="{Binding CalorieTargetDisplay}" FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource WarningBrush}" />
              </StackPanel>

              <!-- Durchschn. Wasser -->
              <StackPanel Grid.Row="2">
                <TextBlock Text="{loc:Translate AvgWater}" FontSize="11"
                           Foreground="{DynamicResource TextMutedBrush}" />
                <TextBlock Text="{Binding AvgWaterDisplay}" FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource InfoBrush}" />
              </StackPanel>
            </Grid>
          </Border>

          <Button Classes="Primary"
                  Command="{Binding CloseAnalysisCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center">
            <TextBlock Text="{loc:Translate OK}" />
          </Button>
        </StackPanel>
      </Border>
    </Border>

    <!-- ============================================ -->
    <!-- Export Ad Overlay                             -->
    <!-- ============================================ -->
    <Border Grid.RowSpan="4"
            Background="#CC000000"
            IsVisible="{Binding ShowExportAdOverlay}"
            ZIndex="80">
      <Border Background="{DynamicResource SurfaceBrush}"
              CornerRadius="16"
              Padding="24"
              MaxWidth="350"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
        <StackPanel Spacing="16">
          <mi:MaterialIcon Kind="FileExport" Width="48" Height="48"
                           Foreground="{DynamicResource SuccessBrush}"
                           HorizontalAlignment="Center" />
          <TextBlock Text="{loc:Translate ExportTracking}"
                     FontSize="20" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center" />
          <TextBlock Text="{loc:Translate ExportTrackingDesc}"
                     FontSize="14"
                     Foreground="{DynamicResource TextMutedBrush}"
                     TextWrapping="Wrap" TextAlignment="Center" />
          <Button Classes="Primary"
                  Command="{Binding ConfirmExportAdCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="Play" Width="20" Height="20" />
              <TextBlock Text="{loc:Translate ExportTracking}" VerticalAlignment="Center" />
            </StackPanel>
          </Button>
          <Button Classes="Text"
                  Command="{Binding CancelExportCommand}"
                  HorizontalAlignment="Center">
            <TextBlock Text="{loc:Translate Cancel}"
                       Foreground="{DynamicResource TextMutedBrush}" />
          </Button>
        </StackPanel>
      </Border>
    </Border>

  </Grid>

</UserControl>
