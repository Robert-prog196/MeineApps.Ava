<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FitnessRechner.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             x:Class="FitnessRechner.Views.BarcodeScannerView"
             x:DataType="vm:BarcodeScannerViewModel">

  <Grid RowDefinitions="Auto,*">

    <!-- ============================================ -->
    <!-- Row 0: Header mit Zurück-Button + Titel      -->
    <!-- ============================================ -->
    <Border Grid.Row="0"
            Background="{DynamicResource SurfaceBrush}"
            BorderThickness="0,0,0,1"
            BorderBrush="{DynamicResource CardBorderBrush}"
            Padding="16,12">
      <Grid ColumnDefinitions="Auto,*">
        <Button Grid.Column="0"
                Classes="Text"
                Command="{Binding GoBackCommand}"
                Padding="4"
                VerticalAlignment="Center">
          <mi:MaterialIcon Kind="ArrowLeft" Width="24" Height="24"
                           Foreground="{DynamicResource TextPrimaryBrush}" />
        </Button>
        <TextBlock Grid.Column="1"
                   Text="{loc:Translate ScanBarcode}"
                   FontSize="20" FontWeight="Bold"
                   Foreground="{DynamicResource TextPrimaryBrush}"
                   VerticalAlignment="Center"
                   Margin="12,0,0,0" />
      </Grid>
    </Border>

    <!-- ============================================ -->
    <!-- Row 1: Content                               -->
    <!-- ============================================ -->
    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
      <StackPanel Spacing="16" Margin="16,12,16,80">

        <!-- Manuelle Barcode-Eingabe (IsScanning = true) -->
        <Border Classes="Card StatsCard" Padding="16"
                IsVisible="{Binding IsScanning}">
          <StackPanel Spacing="12">
            <!-- Hinweis: Kein Kamera-Zugang auf Desktop -->
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="BarcodeScanner" Width="24" Height="24"
                               Foreground="{DynamicResource PrimaryBrush}" />
              <TextBlock Text="{loc:Translate CameraNotAvailable}"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         FontSize="14"
                         TextWrapping="Wrap"
                         VerticalAlignment="Center" />
            </StackPanel>

            <!-- Eingabefeld + Suchen-Button -->
            <Grid ColumnDefinitions="*,Auto" Margin="0,4,0,0">
              <TextBox Grid.Column="0"
                       Text="{Binding ManualBarcodeInput, Mode=TwoWay}"
                       Watermark="{loc:Translate EnterBarcodeManually}"
                       FontSize="16"
                       Margin="0,0,8,0" />
              <Button Grid.Column="1"
                      Classes="Primary"
                      Command="{Binding ScanManuallyCommand}"
                      VerticalAlignment="Stretch">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <mi:MaterialIcon Kind="Magnify" Width="20" Height="20" />
                  <TextBlock Text="{loc:Translate SearchBarcodeButton}"
                             VerticalAlignment="Center" />
                </StackPanel>
              </Button>
            </Grid>
          </StackPanel>
        </Border>

        <!-- Lade-Indikator (IsBusy = true) -->
        <Border Classes="Card StatsCard" Padding="24"
                IsVisible="{Binding IsBusy}">
          <StackPanel Spacing="12" HorizontalAlignment="Center">
            <ProgressBar IsIndeterminate="True"
                         Width="200" />
            <TextBlock Text="{Binding StatusMessage}"
                       HorizontalAlignment="Center"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       FontSize="14" />
          </StackPanel>
        </Border>

        <!-- Status-Nachricht (wenn nicht busy und nicht scanning) -->
        <TextBlock Text="{Binding StatusMessage}"
                   HorizontalAlignment="Center"
                   Foreground="{DynamicResource TextSecondaryBrush}"
                   FontSize="14"
                   Margin="0,8"
                   IsVisible="{Binding !IsBusy}" />

        <!-- Ergebnis-Anzeige (ShowResult = true) -->
        <Border Classes="Card StatsCard" Padding="16"
                IsVisible="{Binding ShowResult}">
          <StackPanel Spacing="12">

            <!-- Produktname -->
            <TextBlock Text="{Binding FoundFood.Name}"
                       FontSize="20" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       TextWrapping="Wrap" />

            <!-- Warnung bei fehlenden Daten -->
            <Border Background="{DynamicResource WarningBackgroundBrush}"
                    CornerRadius="8" Padding="12"
                    IsVisible="{Binding HasIncompleteData}">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="AlertOutline" Width="20" Height="20"
                                 Foreground="{DynamicResource WarningBrush}" />
                <TextBlock Text="{Binding DataWarningMessage}"
                           Foreground="{DynamicResource WarningBrush}"
                           TextWrapping="Wrap"
                           VerticalAlignment="Center" />
              </StackPanel>
            </Border>

            <!-- Nährwert-Grid -->
            <Border Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="8" Padding="12">
              <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto"
                    Margin="0">

                <!-- Kalorien -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,4">
                  <TextBlock Text="{loc:Translate Calories}"
                             FontSize="12"
                             Foreground="{DynamicResource TextMutedBrush}" />
                  <StackPanel Orientation="Horizontal" Spacing="4">
                    <TextBlock Text="{Binding FoundFood.CaloriesPer100g, StringFormat='{}{0:F1}'}"
                               FontSize="18" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimaryBrush}" />
                    <TextBlock Text="kcal" FontSize="12"
                               Foreground="{DynamicResource TextMutedBrush}"
                               VerticalAlignment="Bottom" Margin="0,0,0,2" />
                  </StackPanel>
                </StackPanel>

                <!-- Protein -->
                <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,4">
                  <TextBlock Text="{loc:Translate Protein}"
                             FontSize="12"
                             Foreground="{DynamicResource TextMutedBrush}" />
                  <StackPanel Orientation="Horizontal" Spacing="4">
                    <TextBlock Text="{Binding FoundFood.ProteinPer100g, StringFormat='{}{0:F1}'}"
                               FontSize="18" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimaryBrush}" />
                    <TextBlock Text="g" FontSize="12"
                               Foreground="{DynamicResource TextMutedBrush}"
                               VerticalAlignment="Bottom" Margin="0,0,0,2" />
                  </StackPanel>
                </StackPanel>

                <!-- Kohlenhydrate -->
                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,8,0,4">
                  <TextBlock Text="{loc:Translate Carbs}"
                             FontSize="12"
                             Foreground="{DynamicResource TextMutedBrush}" />
                  <StackPanel Orientation="Horizontal" Spacing="4">
                    <TextBlock Text="{Binding FoundFood.CarbsPer100g, StringFormat='{}{0:F1}'}"
                               FontSize="18" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimaryBrush}" />
                    <TextBlock Text="g" FontSize="12"
                               Foreground="{DynamicResource TextMutedBrush}"
                               VerticalAlignment="Bottom" Margin="0,0,0,2" />
                  </StackPanel>
                </StackPanel>

                <!-- Fett -->
                <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,8,0,4">
                  <TextBlock Text="{loc:Translate Fat}"
                             FontSize="12"
                             Foreground="{DynamicResource TextMutedBrush}" />
                  <StackPanel Orientation="Horizontal" Spacing="4">
                    <TextBlock Text="{Binding FoundFood.FatPer100g, StringFormat='{}{0:F1}'}"
                               FontSize="18" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimaryBrush}" />
                    <TextBlock Text="g" FontSize="12"
                               Foreground="{DynamicResource TextMutedBrush}"
                               VerticalAlignment="Bottom" Margin="0,0,0,2" />
                  </StackPanel>
                </StackPanel>

              </Grid>
            </Border>

            <TextBlock Text="pro 100g" FontSize="11"
                       Foreground="{DynamicResource TextMutedBrush}"
                       HorizontalAlignment="Right"
                       Margin="0,-4,4,0" />

            <!-- Aktions-Buttons -->
            <Grid ColumnDefinitions="*,*" Margin="0,4,0,0">
              <Button Grid.Column="0"
                      Classes="Primary"
                      Command="{Binding UseFoodCommand}"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"
                      Margin="0,0,4,0">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <mi:MaterialIcon Kind="Check" Width="20" Height="20" />
                  <TextBlock Text="{loc:Translate UseProduct}"
                             VerticalAlignment="Center" />
                </StackPanel>
              </Button>
              <Button Grid.Column="1"
                      Classes="Secondary"
                      Command="{Binding ScanAgainCommand}"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"
                      Margin="4,0,0,0">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <mi:MaterialIcon Kind="Refresh" Width="20" Height="20" />
                  <TextBlock Text="{loc:Translate ScanAgain}"
                             VerticalAlignment="Center" />
                </StackPanel>
              </Button>
            </Grid>

          </StackPanel>
        </Border>

      </StackPanel>
    </ScrollViewer>

  </Grid>

</UserControl>
