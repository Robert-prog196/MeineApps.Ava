<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FitnessRechner.ViewModels.Calculators"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             xmlns:skia="using:Avalonia.Labs.Controls"
             x:Class="FitnessRechner.Views.Calculators.CaloriesView"
             x:DataType="vm:CaloriesViewModel">

  <Grid RowDefinitions="Auto,*,Auto"
        AutomationProperties.AutomationId="Calories_RootPanel">

    <!-- ═══════ Header Banner ═══════ -->
    <Border Grid.Row="0"
            AutomationProperties.AutomationId="Calories_HeaderBanner"
            Background="{DynamicResource WarningBrush}"
            Padding="16,12,16,20"
            CornerRadius="0,0,24,24">
      <Grid ColumnDefinitions="Auto,*">
        <Button AutomationProperties.AutomationId="Calories_BtnBack"
                Command="{Binding GoBackCommand}"
                Background="#33FFFFFF"
                CornerRadius="20"
                Width="40" Height="40"
                Padding="0">
          <mi:MaterialIcon Kind="ArrowLeft" Width="22" Height="22" Foreground="White" />
        </Button>
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12"
                    Margin="12,0,0,0" VerticalAlignment="Center">
          <Border Background="#33FFFFFF" CornerRadius="12" Width="40" Height="40">
            <mi:MaterialIcon Kind="Fire" Width="22" Height="22"
                             Foreground="White"
                             HorizontalAlignment="Center" VerticalAlignment="Center" />
          </Border>
          <TextBlock AutomationProperties.AutomationId="Calories_TxtTitle"
                     Text="{loc:Translate CalcCalories}"
                     FontSize="20" FontWeight="Bold" Foreground="White"
                     VerticalAlignment="Center" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- ═══════ Content ═══════ -->
    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto"
                  AutomationProperties.AutomationId="Calories_ScrollViewer">
      <StackPanel Spacing="16" Margin="16,16,16,0">

        <!-- Input Card -->
        <Border Classes="Card"
                AutomationProperties.AutomationId="Calories_CardInput">
          <StackPanel Spacing="14">

            <!-- Weight -->
            <StackPanel Spacing="4">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="ScaleBalance" Width="16" Height="16"
                                 Foreground="{DynamicResource WarningBrush}" />
                <TextBlock Text="{loc:Translate Weight}"
                           FontSize="12" FontWeight="Medium"
                           Foreground="{DynamicResource TextSecondaryBrush}"/>
              </StackPanel>
              <TextBox AutomationProperties.AutomationId="Calories_TxtBoxWeight"
                       Text="{Binding Weight}"
                       Watermark="kg"
                       TextInputOptions.ContentType="Number"
                       Background="{DynamicResource ButtonFunctionBgBrush}"
                       Foreground="{DynamicResource TextPrimaryBrush}" />
            </StackPanel>

            <!-- Height -->
            <StackPanel Spacing="4">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="HumanMaleHeight" Width="16" Height="16"
                                 Foreground="{DynamicResource WarningBrush}" />
                <TextBlock Text="{loc:Translate Height}"
                           FontSize="12" FontWeight="Medium"
                           Foreground="{DynamicResource TextSecondaryBrush}"/>
              </StackPanel>
              <TextBox AutomationProperties.AutomationId="Calories_TxtBoxHeight"
                       Text="{Binding Height}"
                       Watermark="cm"
                       TextInputOptions.ContentType="Number"
                       Background="{DynamicResource ButtonFunctionBgBrush}"
                       Foreground="{DynamicResource TextPrimaryBrush}" />
            </StackPanel>

            <!-- Age -->
            <StackPanel Spacing="4">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="CalendarRange" Width="16" Height="16"
                                 Foreground="{DynamicResource WarningBrush}" />
                <TextBlock Text="{loc:Translate Age}"
                           FontSize="12" FontWeight="Medium"
                           Foreground="{DynamicResource TextSecondaryBrush}"/>
              </StackPanel>
              <TextBox AutomationProperties.AutomationId="Calories_TxtBoxAge"
                       Text="{Binding Age}"
                       Watermark="{loc:Translate Years}"
                       TextInputOptions.ContentType="Digits"
                       Background="{DynamicResource ButtonFunctionBgBrush}"
                       Foreground="{DynamicResource TextPrimaryBrush}" />
            </StackPanel>

            <!-- Gender -->
            <StackPanel Spacing="4">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="GenderMaleFemale" Width="16" Height="16"
                                 Foreground="{DynamicResource WarningBrush}" />
                <TextBlock Text="{loc:Translate Gender}"
                           FontSize="12" FontWeight="Medium"
                           Foreground="{DynamicResource TextSecondaryBrush}"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Spacing="16">
                <RadioButton AutomationProperties.AutomationId="Calories_RadioMale"
                             Content="{loc:Translate Male}"
                             IsChecked="{Binding IsMale}"
                             GroupName="Gender" />
                <RadioButton AutomationProperties.AutomationId="Calories_RadioFemale"
                             Content="{loc:Translate Female}"
                             IsChecked="{Binding IsMale, Converter={x:Static BoolConverters.Not}}"
                             GroupName="Gender" />
              </StackPanel>
            </StackPanel>

            <!-- Activity Level -->
            <StackPanel Spacing="4">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="Run" Width="16" Height="16"
                                 Foreground="{DynamicResource WarningBrush}" />
                <TextBlock Text="{loc:Translate ActivityLevel}"
                           FontSize="12" FontWeight="Medium"
                           Foreground="{DynamicResource TextSecondaryBrush}"/>
              </StackPanel>
              <ComboBox AutomationProperties.AutomationId="Calories_CmbActivityLevel"
                        ItemsSource="{Binding ActivityLevels}"
                        SelectedIndex="{Binding ActivityLevelIndex}"
                        HorizontalAlignment="Stretch" />
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- Result Card -->
        <Border Classes="Card Elevated"
                AutomationProperties.AutomationId="Calories_CardResult"
                IsVisible="{Binding HasResult}">
          <StackPanel Spacing="12">

            <!-- Result Header -->
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="CheckCircle" Width="20" Height="20"
                               Foreground="{DynamicResource WarningBrush}" />
              <TextBlock AutomationProperties.AutomationId="Calories_TxtResultHeader"
                         Text="{loc:Translate Result}"
                         FontSize="16" FontWeight="Bold"
                         Foreground="{DynamicResource TextPrimaryBrush}"/>
            </StackPanel>

            <!-- Primary Result Highlight (TDEE) -->
            <Border AutomationProperties.AutomationId="Calories_CardTdeeValue"
                    Background="{DynamicResource WarningBrush}"
                    CornerRadius="12"
                    Padding="16,12">
              <StackPanel HorizontalAlignment="Center">
                <TextBlock Text="{loc:Translate Tdee}"
                           FontSize="12" Foreground="#CCFFFFFF" HorizontalAlignment="Center" />
                <TextBlock AutomationProperties.AutomationId="Calories_TxtResult"
                           Text="{Binding TdeeDisplay}"
                           FontSize="28" FontWeight="Bold" Foreground="White"
                           HorizontalAlignment="Center" />
              </StackPanel>
            </Border>

            <!-- Kalorien-Ring Visualisierung -->
            <Border Height="180" Margin="0,4,0,0" ClipToBounds="True" CornerRadius="8"
                    Background="{DynamicResource SurfaceBrush}">
              <skia:SKCanvasView AutomationProperties.AutomationId="Calories_CanvasRings"
                                   PaintSurface="OnPaintCalorieRings" />
            </Border>

            <!-- Secondary Results -->
            <StackPanel Spacing="8" Margin="4,0">
              <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{loc:Translate Bmr}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center" />
                <TextBlock Grid.Column="1" AutomationProperties.AutomationId="Calories_TxtBmr"
                           Text="{Binding BmrDisplay}"
                           FontSize="16" FontWeight="SemiBold"
                           Foreground="{DynamicResource TextPrimaryBrush}"/>
              </Grid>
              <Border Height="1" Background="{DynamicResource BorderSubtleBrush}" />
              <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{loc:Translate WeightLoss}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center" />
                <TextBlock Grid.Column="1" AutomationProperties.AutomationId="Calories_TxtWeightLoss"
                           Text="{Binding WeightLossDisplay}"
                           FontSize="16" FontWeight="SemiBold"
                           Foreground="{DynamicResource TextPrimaryBrush}"/>
              </Grid>
              <Border Height="1" Background="{DynamicResource BorderSubtleBrush}" />
              <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{loc:Translate WeightGain}"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center" />
                <TextBlock Grid.Column="1" AutomationProperties.AutomationId="Calories_TxtWeightGain"
                           Text="{Binding WeightGainDisplay}"
                           FontSize="16" FontWeight="SemiBold"
                           Foreground="{DynamicResource TextPrimaryBrush}"/>
              </Grid>
            </StackPanel>

            <!-- Set as Calorie Goal -->
            <Button AutomationProperties.AutomationId="Calories_BtnSetGoal"
                    Classes="Secondary"
                    Command="{Binding SetAsCalorieGoalCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Margin="0,4,0,0">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="Target" Width="18" Height="18" />
                <TextBlock Text="{loc:Translate SetCalorieGoal}"
                           VerticalAlignment="Center" />
              </StackPanel>
            </Button>
          </StackPanel>
        </Border>

        <Border Height="16" />

      </StackPanel>
    </ScrollViewer>

    <!-- ═══════ Action Buttons ═══════ -->
    <Border Grid.Row="2" Padding="16,12" Background="{DynamicResource BackgroundBrush}"
            AutomationProperties.AutomationId="Calories_ActionBar">
      <Grid ColumnDefinitions="*,12,*">
        <Button AutomationProperties.AutomationId="Calories_BtnReset"
                Command="{Binding ResetCommand}" Classes="Outlined"
                HorizontalAlignment="Stretch" Height="48" CornerRadius="12">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <mi:MaterialIcon Kind="Refresh" Width="20" Height="20" />
            <TextBlock Text="{loc:Translate Reset}" VerticalAlignment="Center" />
          </StackPanel>
        </Button>
        <Button Grid.Column="2" AutomationProperties.AutomationId="Calories_BtnCalculate"
                Command="{Binding CalculateCommand}" Classes="Primary"
                HorizontalAlignment="Stretch" Height="48" CornerRadius="12">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <mi:MaterialIcon Kind="Calculator" Width="20" Height="20" />
            <TextBlock Text="{loc:Translate Calculate}" VerticalAlignment="Center" />
          </StackPanel>
        </Button>
      </Grid>
    </Border>

  </Grid>

</UserControl>
