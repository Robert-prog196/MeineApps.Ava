<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BomberBlast.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             x:Class="BomberBlast.Views.LevelSelectView"
             x:DataType="vm:LevelSelectViewModel">

  <!-- Gradient Background -->
  <Panel>
    <Border>
      <Border.Background>
        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
          <GradientStop Color="{DynamicResource GradientStartColor}" Offset="0" />
          <GradientStop Color="{DynamicResource GradientMidColor}" Offset="0.5" />
          <GradientStop Color="{DynamicResource GradientEndColor}" Offset="1" />
        </LinearGradientBrush>
      </Border.Background>
    </Border>

    <Grid RowDefinitions="Auto,*,Auto">

      <!-- Header -->
      <Border Grid.Row="0"
              Classes="CardElevated"
              Padding="16,12"
              CornerRadius="0,0,12,12">
        <Grid ColumnDefinitions="Auto,*,Auto">
          <!-- Zurueck-Button -->
          <Button Classes="Text"
                  Command="{Binding GoBackCommand}">
            <mi:MaterialIcon Kind="ArrowLeft" Width="24" Height="24" />
          </Button>

          <!-- Titel -->
          <StackPanel Grid.Column="1"
                      Orientation="Horizontal"
                      HorizontalAlignment="Center"
                      Spacing="8">
            <mi:MaterialIcon Kind="ViewGrid" Width="24" Height="24"
                             Foreground="{DynamicResource TextPrimaryBrush}" />
            <TextBlock Text="{loc:Translate SelectLevel}"
                       FontSize="20" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}" />
          </StackPanel>

          <!-- Coin-Badge -->
          <Border Grid.Column="2"
                  Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="16"
                  Padding="12,6">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <mi:MaterialIcon Kind="CircleMultiple" Width="18" Height="18"
                               Foreground="#FFD700" />
              <TextBlock Text="{Binding CoinsText}"
                         FontSize="15" FontWeight="SemiBold"
                         Foreground="#FFD700"
                         VerticalAlignment="Center" />
            </StackPanel>
          </Border>
        </Grid>
      </Border>

      <!-- Welt-Sektionen -->
      <ScrollViewer Grid.Row="1"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto">
        <ItemsControl ItemsSource="{Binding WorldGroups}" Margin="4,4,4,80">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Spacing="6" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="vm:WorldGroup">
              <!-- Welt-Sektion -->
              <Panel>
                <!-- Content-Bereich -->
                <Border CornerRadius="10"
                        Padding="6,4,6,6"
                        Opacity="{Binding SectionOpacity}"
                        Background="{Binding HeaderBackgroundBrush}">
                  <StackPanel Spacing="4">

                    <!-- Welt-Header -->
                    <Grid ColumnDefinitions="Auto,*,Auto">
                      <!-- Icon + Name -->
                      <StackPanel Grid.Column="0"
                                  Orientation="Horizontal" Spacing="8"
                                  VerticalAlignment="Center">
                        <mi:MaterialIcon Kind="{Binding LockIcon}"
                                         Width="20" Height="20"
                                         Foreground="{Binding HeaderTextBrush}" />
                        <TextBlock Text="{Binding WorldLockText}"
                                   FontSize="15" FontWeight="SemiBold"
                                   Foreground="{Binding HeaderTextBrush}" />
                      </StackPanel>

                      <!-- Sterne-Fortschritt (rechts) -->
                      <TextBlock Grid.Column="2"
                                 Text="{Binding ProgressText}"
                                 FontSize="13"
                                 Foreground="{DynamicResource TextSecondaryBrush}"
                                 VerticalAlignment="Center" />
                    </Grid>

                    <!-- Level-Buttons: 10 Spalten x 1 Reihe (Landscape-optimiert) -->
                    <ItemsControl ItemsSource="{Binding Levels}">
                      <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                          <UniformGrid Columns="10" />
                        </ItemsPanelTemplate>
                      </ItemsControl.ItemsPanel>
                      <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="vm:LevelDisplayItem">
                          <!-- Border stretcht automatisch auf volle UniformGrid-Zelle -->
                          <Border Margin="1" CornerRadius="8"
                                  Background="{Binding BackgroundColor}"
                                  BorderBrush="#40FFFFFF"
                                  BorderThickness="1"
                                  MinHeight="52">
                            <Button Command="{Binding SelectCommand}"
                                    Classes="GameButton"
                                    Padding="0"
                                    Background="Transparent"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch"
                                    HorizontalContentAlignment="Stretch"
                                    VerticalContentAlignment="Stretch">
                              <Grid RowDefinitions="*,Auto,Auto">
                                <!-- Level-Nummer -->
                                <TextBlock Grid.Row="0"
                                           Text="{Binding LevelNumber}"
                                           FontSize="18"
                                           FontWeight="Bold"
                                           Foreground="{Binding TextBrush}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />

                                <!-- Sterne oder Schloss -->
                                <TextBlock Grid.Row="1"
                                           Text="{Binding StarsDisplay}"
                                           FontSize="10"
                                           Foreground="Gold"
                                           HorizontalAlignment="Center"
                                           IsVisible="{Binding IsCompleted}" />

                                <mi:MaterialIcon Grid.Row="1"
                                                 Kind="Lock"
                                                 Width="12" Height="12"
                                                 Foreground="{DynamicResource TextMutedBrush}"
                                                 HorizontalAlignment="Center"
                                                 IsVisible="{Binding IsLocked}" />

                                <!-- Best Score (klein, unter den Sternen) -->
                                <TextBlock Grid.Row="2"
                                           Text="{Binding BestScoreText}"
                                           FontSize="8"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,1"
                                           IsVisible="{Binding IsCompleted}" />
                              </Grid>
                            </Button>
                          </Border>
                        </DataTemplate>
                      </ItemsControl.ItemTemplate>
                    </ItemsControl>

                  </StackPanel>
                </Border>

                <!-- Lock-Overlay (nur fuer gesperrte Welten) -->
                <Border IsVisible="{Binding IsLocked}"
                        Background="#80000000"
                        CornerRadius="12"
                        IsHitTestVisible="False">
                  <StackPanel HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              Spacing="4">
                    <mi:MaterialIcon Kind="Lock" Width="28" Height="28"
                                     Foreground="#888888" />
                    <TextBlock Text="{Binding WorldLockText}"
                               FontSize="13"
                               Foreground="#AAAAAA"
                               HorizontalAlignment="Center" />
                  </StackPanel>
                </Border>
              </Panel>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>

      <!-- Footer: Fortschritt -->
      <Border Grid.Row="2"
              Background="{DynamicResource SurfaceBrush}"
              Padding="12,8">
        <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
          <TextBlock Text="{Binding ProgressText}"
                     FontSize="13"
                     Foreground="{DynamicResource TextSecondaryBrush}" />
          <TextBlock Text="{Binding StarsText}"
                     FontSize="13"
                     Foreground="{DynamicResource AccentBrush}" />
        </StackPanel>
      </Border>

    </Grid>

    <!-- Power-Up Boost Overlay -->
    <Border IsVisible="{Binding ShowBoostOverlay}"
            Background="#CC000000"
            ZIndex="50">
      <Border Background="{DynamicResource CardBrush}"
              CornerRadius="16"
              Padding="24"
              MaxWidth="340"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
        <StackPanel Spacing="16" HorizontalAlignment="Center">
          <TextBlock Text="{Binding BoostTitleText}"
                     FontSize="22" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center" />

          <Border Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="30"
                  Width="60" Height="60"
                  HorizontalAlignment="Center">
            <mi:MaterialIcon Kind="{Binding BoostPowerUpIcon}"
                             Width="32" Height="32"
                             Foreground="{DynamicResource AccentBrush}" />
          </Border>

          <TextBlock Text="{Binding BoostPowerUpName}"
                     FontSize="18" FontWeight="SemiBold"
                     Foreground="{DynamicResource AccentBrush}"
                     HorizontalAlignment="Center" />

          <TextBlock Text="{Binding BoostDescText}"
                     FontSize="14"
                     Foreground="{DynamicResource TextSecondaryBrush}"
                     HorizontalAlignment="Center"
                     TextWrapping="Wrap"
                     TextAlignment="Center" />

          <StackPanel Spacing="8">
            <Button Classes="Filled GameButton"
                    Command="{Binding AcceptBoostCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Padding="16,12">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="Flash" Width="20" Height="20" />
                <TextBlock Text="{Binding BoostAcceptText}"
                           FontSize="15" FontWeight="SemiBold" />
              </StackPanel>
            </Button>

            <Button Classes="Text"
                    Command="{Binding DeclineBoostCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Padding="12,10">
              <TextBlock Text="{Binding BoostDeclineText}"
                         FontSize="14"
                         Foreground="{DynamicResource TextSecondaryBrush}" />
            </Button>
          </StackPanel>
        </StackPanel>
      </Border>
    </Border>

  </Panel>

</UserControl>
