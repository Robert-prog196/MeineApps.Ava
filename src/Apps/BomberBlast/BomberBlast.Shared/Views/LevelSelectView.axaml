<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BomberBlast.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             x:Class="BomberBlast.Views.LevelSelectView"
             x:DataType="vm:LevelSelectViewModel">

  <!-- Gradient Background -->
  <Panel>
    <Border>
      <Border.Background>
        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
          <GradientStop Color="{DynamicResource GradientStartColor}" Offset="0" />
          <GradientStop Color="{DynamicResource GradientMidColor}" Offset="0.5" />
          <GradientStop Color="{DynamicResource GradientEndColor}" Offset="1" />
        </LinearGradientBrush>
      </Border.Background>
    </Border>

    <Grid RowDefinitions="Auto,*,Auto">

      <!-- Header -->
      <Border Grid.Row="0"
              Classes="CardElevated"
              Padding="16,12"
              CornerRadius="0,0,12,12">
        <Grid ColumnDefinitions="Auto,*,Auto">
          <!-- Zurueck-Button -->
          <Button Classes="Text"
                  Command="{Binding GoBackCommand}">
            <mi:MaterialIcon Kind="ArrowLeft" Width="24" Height="24" />
          </Button>

          <!-- Titel -->
          <StackPanel Grid.Column="1"
                      Orientation="Horizontal"
                      HorizontalAlignment="Center"
                      Spacing="8">
            <mi:MaterialIcon Kind="ViewGrid" Width="24" Height="24"
                             Foreground="{DynamicResource TextPrimaryBrush}" />
            <TextBlock Text="{loc:Translate SelectLevel}"
                       FontSize="20" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}" />
          </StackPanel>

          <!-- Coin-Badge -->
          <Border Grid.Column="2"
                  Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="16"
                  Padding="12,6">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <mi:MaterialIcon Kind="CircleMultiple" Width="18" Height="18"
                               Foreground="#FFD700" />
              <TextBlock Text="{Binding CoinsText}"
                         FontSize="15" FontWeight="SemiBold"
                         Foreground="#FFD700"
                         VerticalAlignment="Center" />
            </StackPanel>
          </Border>
        </Grid>
      </Border>

      <!-- Level Grid -->
      <ScrollViewer Grid.Row="1" Padding="12,12,12,60">
        <ItemsControl ItemsSource="{Binding Levels}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <WrapPanel Orientation="Horizontal"
                         HorizontalAlignment="Center" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="vm:LevelDisplayItem">
              <Panel>
                <!-- Welt-Header -->
                <Border IsVisible="{Binding IsWorldHeader}"
                        Background="{DynamicResource SurfaceBrush}"
                        CornerRadius="8"
                        Padding="16,8"
                        Margin="5,12,5,4"
                        Width="660"
                        HorizontalAlignment="Center"
                        Opacity="{Binding WorldHeaderOpacity}">
                  <StackPanel Orientation="Horizontal" Spacing="8"
                              HorizontalAlignment="Center">
                    <mi:MaterialIcon Kind="{Binding WorldIconKind}"
                                     Width="20" Height="20"
                                     Foreground="{Binding WorldHeaderBrush}" />
                    <TextBlock Text="{Binding WorldLockText}"
                               FontSize="15" FontWeight="SemiBold"
                               Foreground="{Binding WorldHeaderBrush}" />
                  </StackPanel>
                </Border>

                <!-- Level-Button -->
                <Button IsVisible="{Binding !IsWorldHeader}"
                        Command="{Binding SelectCommand}"
                        IsEnabled="{Binding IsUnlocked}"
                        Width="70" Height="85"
                        Margin="5"
                        Padding="0"
                        CornerRadius="10"
                        HorizontalContentAlignment="Stretch"
                        VerticalContentAlignment="Stretch">
                  <Button.Background>
                    <SolidColorBrush Color="{Binding BackgroundColor}" />
                  </Button.Background>
                  <Grid RowDefinitions="*,Auto">
                    <!-- Level-Nummer -->
                    <TextBlock Grid.Row="0"
                               Text="{Binding LevelNumber}"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="{Binding TextBrush}"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center" />

                    <!-- Sterne oder Schloss -->
                    <TextBlock Grid.Row="1"
                               Text="{Binding StarsDisplay}"
                               FontSize="12"
                               Foreground="Gold"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,5"
                               IsVisible="{Binding IsCompleted}" />

                    <mi:MaterialIcon Grid.Row="1"
                                     Kind="Lock"
                                     Width="14" Height="14"
                                     Foreground="{DynamicResource TextMutedBrush}"
                                     HorizontalAlignment="Center"
                                     Margin="0,0,0,5"
                                     IsVisible="{Binding IsLocked}" />
                  </Grid>
                </Button>
              </Panel>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>

      <!-- Footer: Fortschritt + Ad Banner -->
      <Border Grid.Row="2"
              Background="{DynamicResource SurfaceBrush}"
              Padding="12,8">
        <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
          <TextBlock Text="{Binding ProgressText}"
                     FontSize="13"
                     Foreground="{DynamicResource TextSecondaryBrush}" />
          <TextBlock Text="{Binding StarsText}"
                     FontSize="13"
                     Foreground="{DynamicResource AccentBrush}" />
        </StackPanel>
      </Border>

    </Grid>

    <!-- Power-Up Boost Overlay -->
    <Border IsVisible="{Binding ShowBoostOverlay}"
            Background="#CC000000"
            ZIndex="50">
      <Border Background="{DynamicResource CardBrush}"
              CornerRadius="16"
              Padding="24"
              MaxWidth="340"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
        <StackPanel Spacing="16" HorizontalAlignment="Center">
          <TextBlock Text="{Binding BoostTitleText}"
                     FontSize="22" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center" />

          <Border Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="30"
                  Width="60" Height="60"
                  HorizontalAlignment="Center">
            <mi:MaterialIcon Kind="{Binding BoostPowerUpIcon}"
                             Width="32" Height="32"
                             Foreground="{DynamicResource AccentBrush}" />
          </Border>

          <TextBlock Text="{Binding BoostPowerUpName}"
                     FontSize="18" FontWeight="SemiBold"
                     Foreground="{DynamicResource AccentBrush}"
                     HorizontalAlignment="Center" />

          <TextBlock Text="{Binding BoostDescText}"
                     FontSize="14"
                     Foreground="{DynamicResource TextSecondaryBrush}"
                     HorizontalAlignment="Center"
                     TextWrapping="Wrap"
                     TextAlignment="Center" />

          <StackPanel Spacing="8">
            <Button Classes="Filled"
                    Command="{Binding AcceptBoostCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Padding="16,12">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="Video" Width="20" Height="20" />
                <TextBlock Text="{loc:Translate WatchVideo}"
                           FontSize="15" FontWeight="SemiBold" />
              </StackPanel>
            </Button>

            <Button Classes="Text"
                    Command="{Binding DeclineBoostCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Padding="12,10">
              <TextBlock Text="{Binding BoostDeclineText}"
                         FontSize="14"
                         Foreground="{DynamicResource TextSecondaryBrush}" />
            </Button>
          </StackPanel>
        </StackPanel>
      </Border>
    </Border>

  </Panel>

</UserControl>
