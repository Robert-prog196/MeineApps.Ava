<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BomberBlast.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             xmlns:skia="using:Avalonia.Labs.Controls"
             xmlns:models="using:BomberBlast.Models"
             x:Class="BomberBlast.Views.MainMenuView"
             x:DataType="vm:MainMenuViewModel">

  <!-- Background -->
  <Panel Background="{DynamicResource BackgroundBrush}">
    <Border Background="{DynamicResource SurfaceBrush}" Opacity="0.3" />

    <!-- Hintergrund-Partikel (SkiaSharp Canvas) -->
    <skia:SKCanvasView x:Name="BgCanvas" />

    <Grid RowDefinitions="*" Margin="24,16,24,80">

      <!-- Main Content: 2-Column Layout -->
      <Grid Grid.Row="0"
            ColumnDefinitions="*,2*"
            VerticalAlignment="Center">

        <!-- Links: Titel + Version + Coins -->
        <StackPanel Grid.Column="0"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Spacing="0">
          <TextBlock Text="BOMBER"
                     FontSize="40"
                     FontWeight="Bold"
                     Foreground="{DynamicResource SecondaryBrush}"
                     HorizontalAlignment="Center" />
          <TextBlock Text="BLAST"
                     FontSize="40"
                     FontWeight="Bold"
                     Foreground="{DynamicResource AccentBrush}"
                     HorizontalAlignment="Center"
                     Margin="0,-12,0,0" />

          <!-- Coin-Badge -->
          <Border Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="16"
                  Padding="14,8"
                  Margin="0,20,0,0"
                  HorizontalAlignment="Center">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="CircleMultiple" Width="20" Height="20"
                               Foreground="#FFD700" />
              <TextBlock Text="{Binding CoinsText}"
                         FontSize="17" FontWeight="SemiBold"
                         Foreground="#FFD700"
                         VerticalAlignment="Center" />
            </StackPanel>
          </Border>

          <TextBlock Text="{Binding TotalEarnedText}"
                     FontSize="11"
                     Foreground="{DynamicResource TextMutedBrush}"
                     HorizontalAlignment="Center"
                     Margin="0,6,0,0" />

          <TextBlock Text="{Binding VersionText}"
                     FontSize="12"
                     Foreground="{DynamicResource TextMutedBrush}"
                     HorizontalAlignment="Center"
                     Margin="0,8,0,0" />
        </StackPanel>

        <!-- Rechts: Button Grid (2 Spalten - Spielmodi links, Menü rechts) -->
        <Grid Grid.Column="1"
              ColumnDefinitions="3*,2*"
              RowDefinitions="Auto,Auto,Auto,Auto"
              Margin="24,0,0,0"
              VerticalAlignment="Center">

          <!-- ═══ Spielmodi (Linke Spalte, groesser) ═══ -->

          <!-- Story Mode = Primary CTA -->
          <Button Grid.Row="0" Grid.Column="0"
                  Content="{loc:Translate StoryMode}"
                  Classes="Primary GameButton"
                  Command="{Binding StoryModeCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  FontSize="18"
                  Margin="0,0,6,6"
                  Height="56" />

          <!-- Continue (nur wenn Fortschritt) -->
          <Button Grid.Row="1" Grid.Column="0"
                  Content="{loc:Translate Continue}"
                  Classes="Primary GameButton"
                  Background="{DynamicResource SuccessBrush}"
                  Command="{Binding ContinueCommand}"
                  IsVisible="{Binding HasProgress}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  Margin="0,0,6,6"
                  Height="44" />

          <!-- Arcade + QuickPlay nebeneinander -->
          <Grid Grid.Row="2" Grid.Column="0"
                ColumnDefinitions="*,*"
                Margin="0,0,6,6">
            <Button Grid.Column="0"
                    Content="{loc:Translate ArcadeMode}"
                    Classes="Primary GameButton"
                    Background="{DynamicResource ErrorBrush}"
                    Command="{Binding ArcadeModeCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    FontSize="13"
                    Margin="0,0,3,0"
                    Height="44" />
            <Button Grid.Column="1"
                    Content="{loc:Translate QuickPlay}"
                    Classes="Primary GameButton"
                    Background="{DynamicResource WarningBrush}"
                    Command="{Binding QuickPlayCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    FontSize="13"
                    Margin="3,0,0,0"
                    Height="44" />
          </Grid>

          <!-- Daily Challenge -->
          <Panel Grid.Row="3" Grid.Column="0" Margin="0,0,6,0">
            <Button Classes="Primary GameButton"
                    Background="#FF6B00"
                    Command="{Binding DailyChallengeCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Height="44">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="Sword" Width="18" Height="18"
                                 Foreground="White" />
                <TextBlock Text="{loc:Translate DailyChallengeTitle}"
                           Foreground="White"
                           FontSize="14" />
              </StackPanel>
            </Button>
            <!-- "Neu!" Badge -->
            <Border IsVisible="{Binding IsDailyChallengeNew}"
                    Background="#FF2020"
                    CornerRadius="8"
                    Padding="5,2"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,-4,-2,0">
              <TextBlock Text="{loc:Translate DailyChallengeNew}"
                         FontSize="10" FontWeight="Bold"
                         Foreground="White" />
            </Border>
          </Panel>

          <!-- ═══ Menü (Rechte Spalte, kompakter) ═══ -->

          <!-- Shop -->
          <Button Grid.Row="0" Grid.Column="1"
                  Classes="Secondary GameButton"
                  Command="{Binding ShopCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  Margin="6,0,0,6"
                  Height="44">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="Store" Width="18" Height="18"
                               Foreground="{DynamicResource TextPrimaryBrush}" />
              <TextBlock Text="{loc:Translate ShopTitle}"
                         Foreground="{DynamicResource TextPrimaryBrush}" />
            </StackPanel>
          </Button>

          <!-- Achievements -->
          <Button Grid.Row="1" Grid.Column="1"
                  Classes="Secondary GameButton"
                  Command="{Binding AchievementsCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  Margin="6,0,0,6"
                  Height="44">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="Trophy" Width="16" Height="16"
                               Foreground="#FFD700" />
              <TextBlock Text="{loc:Translate AchievementsTitle}"
                         Foreground="{DynamicResource TextPrimaryBrush}"
                         FontSize="13" />
            </StackPanel>
          </Button>

          <!-- High Scores -->
          <Button Grid.Row="2" Grid.Column="1"
                  Content="{loc:Translate HighScores}"
                  Classes="Secondary GameButton"
                  Command="{Binding HighScoresCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  FontSize="13"
                  Margin="6,0,0,6"
                  Height="40" />

          <!-- Help + Settings nebeneinander (kompakt) -->
          <Grid Grid.Row="3" Grid.Column="1"
                ColumnDefinitions="*,*"
                Margin="6,0,0,0">
            <Button Grid.Column="0"
                    Classes="Secondary GameButton"
                    Command="{Binding HelpCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Margin="0,0,3,0"
                    Height="40">
              <StackPanel Orientation="Horizontal" Spacing="4">
                <mi:MaterialIcon Kind="HelpCircleOutline" Width="16" Height="16"
                                 Foreground="{DynamicResource TextSecondaryBrush}" />
                <TextBlock Text="{loc:Translate Help}"
                           FontSize="12"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
              </StackPanel>
            </Button>
            <Button Grid.Column="1"
                    Classes="Secondary GameButton"
                    Command="{Binding SettingsCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Margin="3,0,0,0"
                    Height="40">
              <StackPanel Orientation="Horizontal" Spacing="4">
                <mi:MaterialIcon Kind="Cog" Width="16" Height="16"
                                 Foreground="{DynamicResource TextSecondaryBrush}" />
                <TextBlock Text="{loc:Translate Settings}"
                           FontSize="12"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
              </StackPanel>
            </Button>
          </Grid>

        </Grid>
      </Grid>

    </Grid>

    <!-- Daily Reward Popup Overlay -->
    <Border IsVisible="{Binding IsRewardPopupVisible}"
            Background="#CC000000"
            HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
      <Border Background="{DynamicResource SurfaceBrush}"
              CornerRadius="16" Padding="20"
              MaxWidth="520" MaxHeight="300"
              HorizontalAlignment="Center" VerticalAlignment="Center"
              BoxShadow="0 8 24 0 #60000000">
        <Grid RowDefinitions="Auto,*,Auto">
          <!-- Titel -->
          <StackPanel Orientation="Horizontal" Spacing="8"
                      HorizontalAlignment="Center" Margin="0,0,0,12">
            <mi:MaterialIcon Kind="Gift" Width="24" Height="24" Foreground="#FFD700" />
            <TextBlock Text="{Binding RewardPopupTitle}"
                       FontSize="20" FontWeight="Bold"
                       Foreground="#FFD700" />
          </StackPanel>

          <!-- 7-Tage-Kalender -->
          <ItemsControl Grid.Row="1" ItemsSource="{Binding RewardDays}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal" Spacing="6"
                            HorizontalAlignment="Center" />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="models:DailyRewardDisplayItem">
                <Border Width="58" CornerRadius="8"
                        Padding="4,6"
                        Opacity="{Binding CardOpacity}"
                        BorderThickness="2"
                        BorderBrush="{Binding BorderColor}">
                  <Border.Background>
                    <SolidColorBrush Color="{Binding BackgroundColor}" />
                  </Border.Background>
                  <StackPanel Spacing="4" HorizontalAlignment="Center">
                    <!-- Tag -->
                    <TextBlock Text="{Binding DayText}"
                               FontSize="10" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               HorizontalAlignment="Center" />
                    <!-- Status-Icon -->
                    <Panel Height="20" HorizontalAlignment="Center">
                      <!-- Claimed: Haken -->
                      <mi:MaterialIcon Kind="CheckCircle" Width="20" Height="20"
                                       Foreground="#22C55E"
                                       IsVisible="{Binding IsClaimed}" />
                      <!-- Aktuell: Geschenk -->
                      <mi:MaterialIcon Kind="Gift" Width="20" Height="20"
                                       Foreground="#FFD700"
                                       IsVisible="{Binding IsCurrentDay}" />
                      <!-- Zukunft: Schloss -->
                      <mi:MaterialIcon Kind="Lock" Width="20" Height="20"
                                       Foreground="#666666"
                                       IsVisible="{Binding IsFuture}" />
                    </Panel>
                    <!-- Coins -->
                    <TextBlock Text="{Binding CoinsText}"
                               FontSize="11" FontWeight="Bold"
                               Foreground="#FFD700"
                               HorizontalAlignment="Center" />
                    <!-- Extra-Leben Bonus -->
                    <mi:MaterialIcon Kind="HeartPlus" Width="14" Height="14"
                                     Foreground="#FF4444"
                                     IsVisible="{Binding HasExtraLife}"
                                     HorizontalAlignment="Center" />
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>

          <!-- Buttons -->
          <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12"
                      HorizontalAlignment="Center" Margin="0,12,0,0">
            <Button Command="{Binding ClaimDailyRewardCommand}"
                    Classes="Primary GameButton"
                    Background="#FFD700"
                    Height="44" MinWidth="140"
                    HorizontalContentAlignment="Center">
              <TextBlock Text="{Binding RewardClaimText}"
                         FontSize="16" FontWeight="Bold"
                         Foreground="#1A1A2A" />
            </Button>
            <Button Command="{Binding DismissRewardPopupCommand}"
                    Classes="Secondary GameButton"
                    Height="44" MinWidth="100"
                    HorizontalContentAlignment="Center">
              <mi:MaterialIcon Kind="Close" Width="20" Height="20"
                               Foreground="{DynamicResource TextSecondaryBrush}" />
            </Button>
          </StackPanel>
        </Grid>
      </Border>
    </Border>

  </Panel>

</UserControl>
