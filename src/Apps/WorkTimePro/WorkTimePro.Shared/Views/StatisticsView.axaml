<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:WorkTimePro.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             x:Class="WorkTimePro.Views.StatisticsView"
             x:DataType="vm:StatisticsViewModel">

  <Grid RowDefinitions="Auto,Auto,Auto,*">

    <!-- ═══ Row 0: Kompakter Header (Titel + View-Toggle + Export) ═══ -->
    <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto,Auto" Margin="16,8,16,10">
      <!-- Titel -->
      <TextBlock Grid.Column="0"
                 Text="{loc:Translate Statistics}"
                 FontSize="22" FontWeight="Bold"
                 Foreground="{DynamicResource TextPrimaryBrush}"
                 VerticalAlignment="Center" />

      <!-- Period Display (zentriert) -->
      <TextBlock Grid.Column="1"
                 Text="{Binding PeriodDisplay}"
                 FontSize="15" FontWeight="SemiBold"
                 Foreground="{DynamicResource AccentBrush}"
                 HorizontalAlignment="Center" VerticalAlignment="Center" />

      <!-- View Toggle -->
      <Border Grid.Column="2" Background="{DynamicResource SurfaceBrush}"
              CornerRadius="12" Padding="2" Margin="0,0,8,0" VerticalAlignment="Center">
        <StackPanel Orientation="Horizontal" Spacing="2">
          <Panel>
            <Button Background="{DynamicResource PrimaryBrush}" CornerRadius="10" Padding="8,4"
                    IsVisible="{Binding !ShowTable}"
                    Command="{Binding ToggleViewCommand}">
              <mi:MaterialIcon Kind="ChartBar" Width="16" Height="16" Foreground="White" />
            </Button>
            <Button Background="Transparent" CornerRadius="10" Padding="8,4"
                    IsVisible="{Binding ShowTable}"
                    Command="{Binding ToggleViewCommand}">
              <mi:MaterialIcon Kind="ChartBar" Width="16" Height="16"
                               Foreground="{DynamicResource TextSecondaryBrush}" />
            </Button>
          </Panel>
          <Panel>
            <Button Background="{DynamicResource PrimaryBrush}" CornerRadius="10" Padding="8,4"
                    IsVisible="{Binding ShowTable}"
                    Command="{Binding ToggleViewCommand}">
              <mi:MaterialIcon Kind="Table" Width="16" Height="16" Foreground="White" />
            </Button>
            <Button Background="Transparent" CornerRadius="10" Padding="8,4"
                    IsVisible="{Binding !ShowTable}"
                    Command="{Binding ToggleViewCommand}">
              <mi:MaterialIcon Kind="Table" Width="16" Height="16"
                               Foreground="{DynamicResource TextSecondaryBrush}" />
            </Button>
          </Panel>
        </StackPanel>
      </Border>

      <!-- Export Button -->
      <Button Grid.Column="3" Classes="Text"
              Command="{Binding ExportCommand}"
              Width="36" Height="36" Padding="0"
              VerticalAlignment="Center">
        <mi:MaterialIcon Kind="Export" Width="20" Height="20"
                         Foreground="{DynamicResource TextSecondaryBrush}" />
      </Button>
    </Grid>

    <!-- ═══ Row 1: Period-Chips (Pill-Leiste) ═══ -->
    <Border Grid.Row="1"
            Background="{DynamicResource SurfaceBrush}"
            CornerRadius="20"
            Padding="4"
            Margin="16,0,16,10">
      <Grid ColumnDefinitions="*,*,*,*">
        <!-- Woche -->
        <Panel Grid.Column="0" Margin="2">
          <Button Background="{DynamicResource PrimaryBrush}" CornerRadius="16" Padding="10,6"
                  IsVisible="{Binding IsWeekSelected}"
                  RenderTransformOrigin="50%,50%" RenderTransform="scale(1.05,1.05)"
                  Command="{Binding ChangePeriodCommand}" CommandParameter="Week"
                  HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
            <TextBlock Text="{loc:Translate Week}" Foreground="White" FontSize="12" FontWeight="SemiBold" />
          </Button>
          <Button Background="Transparent" CornerRadius="16" Padding="10,6"
                  IsVisible="{Binding !IsWeekSelected}"
                  Command="{Binding ChangePeriodCommand}" CommandParameter="Week"
                  HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
            <TextBlock Text="{loc:Translate Week}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" />
          </Button>
        </Panel>

        <!-- Monat -->
        <Panel Grid.Column="1" Margin="2">
          <Button Background="{DynamicResource PrimaryBrush}" CornerRadius="16" Padding="10,6"
                  IsVisible="{Binding IsMonthSelected}"
                  RenderTransformOrigin="50%,50%" RenderTransform="scale(1.05,1.05)"
                  Command="{Binding ChangePeriodCommand}" CommandParameter="Month"
                  HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
            <TextBlock Text="{loc:Translate Month}" Foreground="White" FontSize="12" FontWeight="SemiBold" />
          </Button>
          <Button Background="Transparent" CornerRadius="16" Padding="10,6"
                  IsVisible="{Binding !IsMonthSelected}"
                  Command="{Binding ChangePeriodCommand}" CommandParameter="Month"
                  HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
            <TextBlock Text="{loc:Translate Month}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" />
          </Button>
        </Panel>

        <!-- Quartal -->
        <Panel Grid.Column="2" Margin="2">
          <Button Background="{DynamicResource PrimaryBrush}" CornerRadius="16" Padding="10,6"
                  IsVisible="{Binding IsQuarterSelected}"
                  RenderTransformOrigin="50%,50%" RenderTransform="scale(1.05,1.05)"
                  Command="{Binding ChangePeriodCommand}" CommandParameter="Quarter"
                  HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
            <TextBlock Text="{loc:Translate Quarter}" Foreground="White" FontSize="12" FontWeight="SemiBold" />
          </Button>
          <Button Background="Transparent" CornerRadius="16" Padding="10,6"
                  IsVisible="{Binding !IsQuarterSelected}"
                  Command="{Binding ChangePeriodCommand}" CommandParameter="Quarter"
                  HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
            <TextBlock Text="{loc:Translate Quarter}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" />
          </Button>
        </Panel>

        <!-- Jahr -->
        <Panel Grid.Column="3" Margin="2">
          <Button Background="{DynamicResource PrimaryBrush}" CornerRadius="16" Padding="10,6"
                  IsVisible="{Binding IsYearSelected}"
                  RenderTransformOrigin="50%,50%" RenderTransform="scale(1.05,1.05)"
                  Command="{Binding ChangePeriodCommand}" CommandParameter="Year"
                  HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
            <TextBlock Text="{loc:Translate Year}" Foreground="White" FontSize="12" FontWeight="SemiBold" />
          </Button>
          <Button Background="Transparent" CornerRadius="16" Padding="10,6"
                  IsVisible="{Binding !IsYearSelected}"
                  Command="{Binding ChangePeriodCommand}" CommandParameter="Year"
                  HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
            <TextBlock Text="{loc:Translate Year}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" />
          </Button>
        </Panel>
      </Grid>
    </Border>

    <!-- ═══ Row 2: Summary-Band (Arbeitszeit | Überstunden | Schnitt | Arbeitstage) ═══ -->
    <Border Grid.Row="2"
            Background="{DynamicResource CardBrush}"
            CornerRadius="16"
            Padding="12,10"
            Margin="16,0,16,10"
            IsVisible="{Binding !ShowTable}">
      <Grid ColumnDefinitions="*,Auto,*,Auto,*,Auto,*">

        <!-- Arbeitszeit -->
        <StackPanel Grid.Column="0" Spacing="2" HorizontalAlignment="Center">
          <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center">
            <Border Background="#201565C0" Width="18" Height="18" CornerRadius="9">
              <mi:MaterialIcon Kind="ClockOutline" Width="11" Height="11"
                               Foreground="{DynamicResource PrimaryBrush}" />
            </Border>
            <TextBlock Text="{loc:Translate WorkTime}" FontSize="10"
                       Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" />
          </StackPanel>
          <TextBlock Text="{Binding TotalWorkDisplay}"
                     FontSize="15" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center" />
        </StackPanel>

        <!-- Trennlinie -->
        <Border Grid.Column="1" Width="1" Height="32"
                Background="{DynamicResource BorderSubtleBrush}" Margin="4,0" />

        <!-- Überstunden -->
        <StackPanel Grid.Column="2" Spacing="2" HorizontalAlignment="Center">
          <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center">
            <Border Background="#20FF9800" Width="18" Height="18" CornerRadius="9">
              <mi:MaterialIcon Kind="TrendingUp" Width="11" Height="11"
                               Foreground="#FF9800" />
            </Border>
            <TextBlock Text="{loc:Translate Overtime}" FontSize="10"
                       Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" />
          </StackPanel>
          <TextBlock Text="{Binding TotalOvertimeDisplay}"
                     FontSize="15" FontWeight="Bold"
                     Foreground="{Binding OvertimeColor}"
                     HorizontalAlignment="Center" />
        </StackPanel>

        <!-- Trennlinie -->
        <Border Grid.Column="3" Width="1" Height="32"
                Background="{DynamicResource BorderSubtleBrush}" Margin="4,0" />

        <!-- Schnitt/Tag -->
        <StackPanel Grid.Column="4" Spacing="2" HorizontalAlignment="Center">
          <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center">
            <Border Background="#204CAF50" Width="18" Height="18" CornerRadius="9">
              <mi:MaterialIcon Kind="ChartTimelineVariant" Width="11" Height="11"
                               Foreground="#4CAF50" />
            </Border>
            <TextBlock Text="{loc:Translate AvgPerDay}" FontSize="10"
                       Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" />
          </StackPanel>
          <TextBlock Text="{Binding AverageDailyDisplay}"
                     FontSize="15" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center" />
        </StackPanel>

        <!-- Trennlinie -->
        <Border Grid.Column="5" Width="1" Height="32"
                Background="{DynamicResource BorderSubtleBrush}" Margin="4,0" />

        <!-- Arbeitstage -->
        <StackPanel Grid.Column="6" Spacing="2" HorizontalAlignment="Center">
          <StackPanel Orientation="Horizontal" Spacing="4" HorizontalAlignment="Center">
            <Border Background="#206A1B9A" Width="18" Height="18" CornerRadius="9">
              <mi:MaterialIcon Kind="CalendarCheck" Width="11" Height="11"
                               Foreground="#6A1B9A" />
            </Border>
            <TextBlock Text="{loc:Translate WorkedDaysCount}" FontSize="10"
                       Foreground="{DynamicResource TextMutedBrush}" VerticalAlignment="Center" />
          </StackPanel>
          <TextBlock Text="{Binding WorkedDays}"
                     FontSize="15" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center" />
        </StackPanel>

      </Grid>
    </Border>

    <!-- ═══ Row 3: ScrollViewer mit Content ═══ -->
    <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto">
      <StackPanel Spacing="12" Margin="16,0,16,0">

        <!-- ══════ CHARTS MODE ══════ -->

        <!-- ── Abwesenheits-Übersicht ── -->
        <Border Classes="StatsCard" IsVisible="{Binding !ShowTable}">
          <StackPanel Spacing="10">
            <!-- Section-Header mit Akzent-Icon -->
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Border Background="#2000838F" Width="28" Height="28" CornerRadius="8">
                <mi:MaterialIcon Kind="CalendarRemove" Width="16" Height="16"
                                 Foreground="#00838F" />
              </Border>
              <TextBlock Text="{loc:Translate AbsenceOverview}"
                         Classes="SectionTitle"
                         VerticalAlignment="Center" />
            </StackPanel>

            <Grid ColumnDefinitions="*,*,*,*">
              <!-- Urlaub -->
              <StackPanel Grid.Column="0" HorizontalAlignment="Center" Spacing="2">
                <Border Background="#201565C0" Width="32" Height="32" CornerRadius="16"
                        HorizontalAlignment="Center">
                  <mi:MaterialIcon Kind="Beach" Width="18" Height="18"
                                   Foreground="{DynamicResource InfoBrush}" />
                </Border>
                <TextBlock Text="{Binding VacationDays}"
                           FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource InfoBrush}"
                           HorizontalAlignment="Center" />
                <TextBlock Text="{loc:Translate Vacation}"
                           FontSize="10"
                           Foreground="{DynamicResource TextMutedBrush}"
                           HorizontalAlignment="Center" />
              </StackPanel>

              <!-- Krank -->
              <StackPanel Grid.Column="1" HorizontalAlignment="Center" Spacing="2">
                <Border Background="#20F44336" Width="32" Height="32" CornerRadius="16"
                        HorizontalAlignment="Center">
                  <mi:MaterialIcon Kind="Thermometer" Width="18" Height="18"
                                   Foreground="{DynamicResource ErrorBrush}" />
                </Border>
                <TextBlock Text="{Binding SickDays}"
                           FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource ErrorBrush}"
                           HorizontalAlignment="Center" />
                <TextBlock Text="{loc:Translate Sick}"
                           FontSize="10"
                           Foreground="{DynamicResource TextMutedBrush}"
                           HorizontalAlignment="Center" />
              </StackPanel>

              <!-- Home Office -->
              <StackPanel Grid.Column="2" HorizontalAlignment="Center" Spacing="2">
                <Border Background="#201565C0" Width="32" Height="32" CornerRadius="16"
                        HorizontalAlignment="Center">
                  <mi:MaterialIcon Kind="HomeAccount" Width="18" Height="18"
                                   Foreground="{DynamicResource PrimaryBrush}" />
                </Border>
                <TextBlock Text="{Binding HomeOfficeDays}"
                           FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource PrimaryBrush}"
                           HorizontalAlignment="Center" />
                <TextBlock Text="{loc:Translate Home}"
                           FontSize="10"
                           Foreground="{DynamicResource TextMutedBrush}"
                           HorizontalAlignment="Center" />
              </StackPanel>

              <!-- Feiertag -->
              <StackPanel Grid.Column="3" HorizontalAlignment="Center" Spacing="2">
                <Border Background="#20FF9800" Width="32" Height="32" CornerRadius="16"
                        HorizontalAlignment="Center">
                  <mi:MaterialIcon Kind="PartyPopper" Width="18" Height="18"
                                   Foreground="{DynamicResource WarningBrush}" />
                </Border>
                <TextBlock Text="{Binding HolidayDays}"
                           FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource WarningBrush}"
                           HorizontalAlignment="Center" />
                <TextBlock Text="{loc:Translate Holiday}"
                           FontSize="10"
                           Foreground="{DynamicResource TextMutedBrush}"
                           HorizontalAlignment="Center" />
              </StackPanel>
            </Grid>
          </StackPanel>
        </Border>

        <!-- ── Pausen-Statistik ── -->
        <Border Classes="StatsCard" IsVisible="{Binding !ShowTable}">
          <StackPanel Spacing="10">
            <!-- Section-Header -->
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Border Background="#20FF9800" Width="28" Height="28" CornerRadius="8">
                <mi:MaterialIcon Kind="Coffee" Width="16" Height="16"
                                 Foreground="{DynamicResource WarningBrush}" />
              </Border>
              <TextBlock Text="{loc:Translate PauseStats}"
                         Classes="SectionTitle"
                         VerticalAlignment="Center" />
            </StackPanel>

            <Grid ColumnDefinitions="*,*,*">
              <!-- Manuell -->
              <StackPanel Grid.Column="0" HorizontalAlignment="Center" Spacing="2">
                <TextBlock Text="{loc:Translate Manual}"
                           FontSize="10"
                           Foreground="{DynamicResource TextMutedBrush}"
                           HorizontalAlignment="Center" />
                <TextBlock Text="{Binding TotalManualPauseDisplay}"
                           FontSize="17" FontWeight="Bold"
                           Foreground="{DynamicResource SuccessBrush}"
                           HorizontalAlignment="Center" />
              </StackPanel>

              <!-- Auto -->
              <StackPanel Grid.Column="1" HorizontalAlignment="Center" Spacing="2">
                <StackPanel Orientation="Horizontal" Spacing="2" HorizontalAlignment="Center">
                  <TextBlock Text="{loc:Translate Auto}"
                             FontSize="10"
                             Foreground="{DynamicResource TextMutedBrush}" />
                  <mi:MaterialIcon Kind="FlashOutline" Width="10" Height="10"
                                   Foreground="{DynamicResource WarningBrush}" />
                </StackPanel>
                <TextBlock Text="{Binding TotalAutoPauseDisplay}"
                           FontSize="17" FontWeight="Bold"
                           Foreground="{DynamicResource WarningBrush}"
                           HorizontalAlignment="Center" />
              </StackPanel>

              <!-- Durchschnitt -->
              <StackPanel Grid.Column="2" HorizontalAlignment="Center" Spacing="2">
                <TextBlock Text="{loc:Translate AvgPerDay}"
                           FontSize="10"
                           Foreground="{DynamicResource TextMutedBrush}"
                           HorizontalAlignment="Center" />
                <TextBlock Text="{Binding AveragePauseDisplay}"
                           FontSize="17" FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           HorizontalAlignment="Center" />
              </StackPanel>
            </Grid>

            <!-- Pausen-PieChart -->
            <lvc:PieChart Series="{Binding PauseChart}"
                          Height="150"
                          Background="Transparent"
                          InitialRotation="-90"
                          IsVisible="{Binding HasPauseChartData}" />
          </StackPanel>
        </Border>

        <!-- ── Wöchentliche Arbeitszeit ── -->
        <Border Classes="StatsCard" IsVisible="{Binding !ShowTable}">
          <StackPanel Spacing="10">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Border Background="#201565C0" Width="28" Height="28" CornerRadius="8">
                <mi:MaterialIcon Kind="ChartBar" Width="16" Height="16"
                                 Foreground="{DynamicResource PrimaryBrush}" />
              </Border>
              <TextBlock Text="{loc:Translate WeeklyWorkTimeChart}"
                         Classes="SectionTitle"
                         VerticalAlignment="Center" />
            </StackPanel>

            <lvc:CartesianChart Series="{Binding WeeklyChart}"
                                XAxes="{Binding WeeklyXAxes}"
                                YAxes="{Binding WeeklyYAxes}"
                                Height="200"
                                Background="Transparent"
                                ZoomMode="None" />
          </StackPanel>
        </Border>

        <!-- ── Überstunden-Trend ── -->
        <Border Classes="StatsCard" IsVisible="{Binding !ShowTable}">
          <StackPanel Spacing="10">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Border Background="#20FF9800" Width="28" Height="28" CornerRadius="8">
                <mi:MaterialIcon Kind="TrendingUp" Width="16" Height="16"
                                 Foreground="#FF9800" />
              </Border>
              <TextBlock Text="{loc:Translate OvertimeTrendChart}"
                         Classes="SectionTitle"
                         VerticalAlignment="Center" />
            </StackPanel>

            <lvc:CartesianChart Series="{Binding OvertimeChart}"
                                XAxes="{Binding OvertimeXAxes}"
                                YAxes="{Binding OvertimeYAxes}"
                                Height="200"
                                Background="Transparent"
                                ZoomMode="None" />
          </StackPanel>
        </Border>

        <!-- ── Wochentag-Verteilung ── -->
        <Border Classes="StatsCard" IsVisible="{Binding !ShowTable}">
          <StackPanel Spacing="10">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Border Background="#204CAF50" Width="28" Height="28" CornerRadius="8">
                <mi:MaterialIcon Kind="CalendarWeek" Width="16" Height="16"
                                 Foreground="#4CAF50" />
              </Border>
              <TextBlock Text="{loc:Translate WeekdayAverage}"
                         Classes="SectionTitle"
                         VerticalAlignment="Center" />
            </StackPanel>

            <lvc:CartesianChart Series="{Binding WeekdayChart}"
                                XAxes="{Binding WeekdayXAxes}"
                                YAxes="{Binding WeekdayYAxes}"
                                Height="180"
                                Background="Transparent"
                                ZoomMode="None" />
          </StackPanel>
        </Border>

        <!-- ── Projekt-Verteilung (falls Projekte existieren) ── -->
        <Border Classes="StatsCard" IsVisible="{Binding HasProjects}">
          <StackPanel Spacing="10">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Border Background="#206A1B9A" Width="28" Height="28" CornerRadius="8">
                <mi:MaterialIcon Kind="Briefcase" Width="16" Height="16"
                                 Foreground="#6A1B9A" />
              </Border>
              <TextBlock Text="{loc:Translate ProjectDistribution}"
                         Classes="SectionTitle"
                         VerticalAlignment="Center" />
            </StackPanel>

            <lvc:PieChart Series="{Binding ProjectChart}"
                          Height="220"
                          Background="Transparent"
                          InitialRotation="-90" />
          </StackPanel>
        </Border>

        <!-- ── Arbeitgeber-Verteilung ── -->
        <Border Classes="StatsCard" IsVisible="{Binding HasEmployers}">
          <StackPanel Spacing="10">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Border Background="#20C62828" Width="28" Height="28" CornerRadius="8">
                <mi:MaterialIcon Kind="AccountGroup" Width="16" Height="16"
                                 Foreground="#C62828" />
              </Border>
              <TextBlock Text="{loc:Translate EmployerDistribution}"
                         Classes="SectionTitle"
                         VerticalAlignment="Center" />
            </StackPanel>

            <lvc:PieChart Series="{Binding EmployerChart}"
                          Height="220"
                          Background="Transparent"
                          InitialRotation="-90" />
          </StackPanel>
        </Border>

        <!-- ══════ TABLE MODE ══════ -->

        <!-- ── Tabellen-Ansicht ── -->
        <Border Classes="StatsCard" Padding="8"
                IsVisible="{Binding ShowTable}">
          <StackPanel Spacing="4">
            <!-- Section-Header -->
            <StackPanel Orientation="Horizontal" Spacing="8" Margin="8,4">
              <Border Background="#201565C0" Width="28" Height="28" CornerRadius="8">
                <mi:MaterialIcon Kind="FileDocument" Width="16" Height="16"
                                 Foreground="{DynamicResource PrimaryBrush}" />
              </Border>
              <TextBlock Text="{loc:Translate WorkTimeTable}"
                         Classes="SectionTitle"
                         VerticalAlignment="Center" />
            </StackPanel>

            <!-- Table Header -->
            <Border Background="{DynamicResource PrimaryBrush}"
                    Padding="6" CornerRadius="8" Margin="0,4,0,0">
              <Grid ColumnDefinitions="2*,1.5*,Auto,Auto,Auto,Auto,Auto">
                <TextBlock Grid.Column="0" Text="{loc:Translate TableDate}" Foreground="White" FontSize="10" FontWeight="Bold" />
                <TextBlock Grid.Column="1" Text="{loc:Translate TableStatus}" Foreground="White" FontSize="10" FontWeight="Bold" />
                <TextBlock Grid.Column="2" Text="{loc:Translate TableCheckIn}" Foreground="White" FontSize="10" FontWeight="Bold" HorizontalAlignment="Center" />
                <TextBlock Grid.Column="3" Text="{loc:Translate TableCheckOut}" Foreground="White" FontSize="10" FontWeight="Bold" HorizontalAlignment="Center" />
                <TextBlock Grid.Column="4" Text="{loc:Translate TableWork}" Foreground="White" FontSize="10" FontWeight="Bold" HorizontalAlignment="Center" />
                <TextBlock Grid.Column="5" Text="{loc:Translate TablePause}" Foreground="White" FontSize="10" FontWeight="Bold" HorizontalAlignment="Center" />
                <TextBlock Grid.Column="6" Text="{loc:Translate TableBalance}" Foreground="White" FontSize="10" FontWeight="Bold" HorizontalAlignment="Center" />
              </Grid>
            </Border>

            <!-- Table Data -->
            <ItemsControl ItemsSource="{Binding TableDays}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="vm:WorkDayTableItem">
                  <Border Padding="6,5"
                          Background="{DynamicResource CardBrush}">
                    <Grid ColumnDefinitions="2*,1.5*,Auto,Auto,Auto,Auto,Auto">
                      <TextBlock Grid.Column="0" Text="{Binding DateDisplay}"
                                 FontSize="10"
                                 Foreground="{DynamicResource TextPrimaryBrush}"
                                 VerticalAlignment="Center" />
                      <StackPanel Grid.Column="1" Orientation="Horizontal"
                                  Spacing="2" VerticalAlignment="Center">
                        <TextBlock Text="{Binding StatusIcon}" FontSize="12" />
                        <TextBlock Text="{Binding StatusName}" FontSize="9"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"
                                   TextTrimming="CharacterEllipsis" />
                      </StackPanel>
                      <TextBlock Grid.Column="2" Text="{Binding CheckInTime}"
                                 FontSize="10"
                                 Foreground="{DynamicResource TextPrimaryBrush}"
                                 HorizontalAlignment="Center" VerticalAlignment="Center" />
                      <TextBlock Grid.Column="3" Text="{Binding CheckOutTime}"
                                 FontSize="10"
                                 Foreground="{DynamicResource TextPrimaryBrush}"
                                 HorizontalAlignment="Center" VerticalAlignment="Center" />
                      <TextBlock Grid.Column="4" Text="{Binding WorkTime}"
                                 FontSize="10"
                                 Foreground="{DynamicResource TextPrimaryBrush}"
                                 HorizontalAlignment="Center" VerticalAlignment="Center" />
                      <StackPanel Grid.Column="5" Orientation="Horizontal"
                                  HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock Text="{Binding PauseTime}" FontSize="10"
                                   Foreground="{DynamicResource TextSecondaryBrush}" />
                        <mi:MaterialIcon Kind="FlashOutline" Width="7" Height="7"
                                         Foreground="{DynamicResource WarningBrush}"
                                         IsVisible="{Binding HasAutoBreak}" />
                      </StackPanel>
                      <TextBlock Grid.Column="6" Text="{Binding Balance}"
                                 FontSize="10" FontWeight="Bold"
                                 Foreground="{Binding BalanceColor}"
                                 HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Empty State -->
            <StackPanel IsVisible="{Binding HasNoTableData}"
                        HorizontalAlignment="Center"
                        Margin="0,24">
              <Border Classes="EmptyPulse" Width="64" Height="64" CornerRadius="32"
                      Background="{DynamicResource SurfaceBrush}"
                      HorizontalAlignment="Center">
                <mi:MaterialIcon Kind="FileDocument" Width="32" Height="32"
                                 Foreground="{DynamicResource TextSecondaryBrush}" />
              </Border>
              <TextBlock Text="{loc:Translate NoEntries}"
                         FontSize="14"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         HorizontalAlignment="Center"
                         Margin="0,8,0,0" />
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- Loading Indicator -->
        <ProgressBar IsIndeterminate="True"
                     IsVisible="{Binding IsLoading}"
                     HorizontalAlignment="Center" />

        <!-- Bottom Spacer (Ad-Banner) -->
        <Border Height="60" />

      </StackPanel>
    </ScrollViewer>

    <!-- ═══ Rewarded Ad Overlay ═══ -->
    <Border Grid.RowSpan="4"
            IsVisible="{Binding ShowRewardedAdOverlay}"
            Background="#CC000000"
            ZIndex="100">
      <Border Background="{DynamicResource CardBrush}"
              CornerRadius="16"
              Padding="24"
              MaxWidth="340"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
        <StackPanel Spacing="16" HorizontalAlignment="Center">
          <TextBlock Text="{loc:Translate PremiumFeatureTitle}"
                     FontSize="22" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center" />
          <Border Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="30"
                  Width="60" Height="60"
                  HorizontalAlignment="Center">
            <mi:MaterialIcon Kind="Star" Width="32" Height="32"
                             Foreground="{DynamicResource AccentBrush}" />
          </Border>
          <TextBlock Text="{loc:Translate PremiumFeatureDesc}"
                     FontSize="14"
                     Foreground="{DynamicResource TextSecondaryBrush}"
                     HorizontalAlignment="Center"
                     TextWrapping="Wrap" TextAlignment="Center" />
          <StackPanel Spacing="8">
            <Button Classes="Filled"
                    Command="{Binding WatchAdCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Padding="16,12">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="Video" Width="20" Height="20" />
                <TextBlock Text="{loc:Translate WatchVideoOnce}"
                           FontSize="15" FontWeight="SemiBold" />
              </StackPanel>
            </Button>
            <Button Classes="Text"
                    Command="{Binding CancelAdOverlayCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Padding="12,10">
              <TextBlock Text="{loc:Translate Cancel}"
                         FontSize="14"
                         Foreground="{DynamicResource TextSecondaryBrush}" />
            </Button>
          </StackPanel>
        </StackPanel>
      </Border>
    </Border>

  </Grid>

</UserControl>
