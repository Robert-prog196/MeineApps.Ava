<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:WorkTimePro.ViewModels"
             xmlns:models="using:WorkTimePro.Models"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             x:Class="WorkTimePro.Views.DayDetailView"
             x:DataType="vm:DayDetailViewModel">

  <Grid RowDefinitions="Auto,*">

    <!-- Back Button Header -->
    <Border Grid.Row="0"
            Background="{DynamicResource SurfaceBrush}"
            Padding="8,4">
      <StackPanel Orientation="Horizontal" Spacing="8">
        <Button Classes="Text"
                Command="{Binding GoBackCommand}">
          <mi:MaterialIcon Kind="ArrowLeft" Width="24" Height="24"
                           Foreground="{DynamicResource PrimaryBrush}" />
        </Button>
        <TextBlock Text="{loc:Translate DayDetails}"
                   FontSize="18" FontWeight="Bold"
                   Foreground="{DynamicResource TextPrimaryBrush}"
                   VerticalAlignment="Center" />
      </StackPanel>
    </Border>

    <!-- Content -->
    <ScrollViewer Grid.Row="1">
      <StackPanel Spacing="12" Margin="16">

        <!-- ==================== Header with Date and Status ==================== -->
        <Border Classes="CardElevated">
          <StackPanel Spacing="8">
            <TextBlock Text="{Binding DateDisplay}"
                       Classes="PageTitle"
                       HorizontalAlignment="Center" />

            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Center" Spacing="8">
              <mi:MaterialIcon Kind="{Binding StatusIconKind}"
                               Width="20" Height="20"
                               Foreground="{DynamicResource TextSecondaryBrush}" />
              <TextBlock Text="{Binding StatusDisplay}"
                         FontSize="14"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         VerticalAlignment="Center" />
              <Button Classes="Text"
                      Command="{Binding ChangeStatusCommand}"
                      IsEnabled="{Binding !IsLocked}">
                <mi:MaterialIcon Kind="Pencil" Width="16" Height="16"
                                 Foreground="{DynamicResource PrimaryBrush}" />
              </Button>
            </StackPanel>

            <!-- Locked Badge -->
            <Border Background="{DynamicResource ErrorLightBrush}"
                    CornerRadius="8"
                    Padding="8,4"
                    HorizontalAlignment="Center"
                    IsVisible="{Binding IsLocked}">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="Lock" Width="14" Height="14"
                                 Foreground="{DynamicResource ErrorBrush}" />
                <TextBlock Text="{loc:Translate LockedMonthClosure}"
                           FontSize="12"
                           Foreground="{DynamicResource ErrorBrush}" />
              </StackPanel>
            </Border>
          </StackPanel>
        </Border>

        <!-- ==================== Time Summary ==================== -->
        <Border Classes="Card">
          <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto"
                ColumnSpacing="16" RowSpacing="12">

            <!-- Work Time -->
            <StackPanel Grid.Column="0" Grid.Row="0">
              <TextBlock Text="{loc:Translate WorkTime}"
                         FontSize="12"
                         Foreground="{DynamicResource TextSecondaryBrush}" />
              <TextBlock Text="{Binding WorkTimeDisplay}"
                         FontSize="24" FontWeight="Bold"
                         Foreground="{DynamicResource TextPrimaryBrush}" />
            </StackPanel>

            <!-- Balance -->
            <StackPanel Grid.Column="1" Grid.Row="0">
              <TextBlock Text="{loc:Translate Balance}"
                         FontSize="12"
                         Foreground="{DynamicResource TextSecondaryBrush}" />
              <TextBlock Text="{Binding BalanceDisplay}"
                         FontSize="24" FontWeight="Bold"
                         Foreground="{Binding BalanceColor}" />
            </StackPanel>

            <!-- Manual Break -->
            <StackPanel Grid.Column="0" Grid.Row="1">
              <TextBlock Text="{loc:Translate ManualBreak}"
                         FontSize="12"
                         Foreground="{DynamicResource TextSecondaryBrush}" />
              <TextBlock Text="{Binding PauseTimeDisplay}"
                         FontSize="18"
                         Foreground="{DynamicResource WarningBrush}" />
            </StackPanel>

            <!-- Auto Break -->
            <StackPanel Grid.Column="1" Grid.Row="1">
              <StackPanel Orientation="Horizontal" Spacing="4">
                <TextBlock Text="{loc:Translate AutoPause}"
                           FontSize="12"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
                <mi:MaterialIcon Kind="FlashOutline" Width="12" Height="12"
                                 Foreground="{DynamicResource WarningBrush}"
                                 IsVisible="{Binding HasAutoPause}" />
              </StackPanel>
              <TextBlock Text="{Binding AutoPauseDisplay}"
                         FontSize="18"
                         Foreground="{DynamicResource WarningBrush}"
                         Opacity="0.7" />
            </StackPanel>

          </Grid>
        </Border>

        <!-- ==================== Warnings (labor law) ==================== -->
        <Border Background="{DynamicResource ErrorLightBrush}"
                BorderBrush="{DynamicResource ErrorBrush}"
                BorderThickness="1"
                CornerRadius="12"
                Padding="12"
                IsVisible="{Binding HasWarnings}">
          <StackPanel Spacing="8">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="InformationOutline" Width="18" Height="18"
                               Foreground="{DynamicResource ErrorBrush}" />
              <TextBlock Text="{loc:Translate LegalWarningsTitle}"
                         FontSize="16" FontWeight="Bold"
                         Foreground="{DynamicResource ErrorBrush}" />
            </StackPanel>
            <ItemsControl ItemsSource="{Binding Warnings}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="x:String">
                  <TextBlock Text="{Binding}"
                             FontSize="12"
                             Foreground="{DynamicResource ErrorBrush}"
                             Padding="0,2" />
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </Border>

        <!-- ==================== Time Entries ==================== -->
        <Border Classes="Card">
          <StackPanel Spacing="12">
            <Grid ColumnDefinitions="*,Auto">
              <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="ClockOutline" Width="20" Height="20"
                                 Foreground="{DynamicResource PrimaryBrush}" />
                <TextBlock Text="{loc:Translate TimeEntries}"
                           FontSize="16" FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           VerticalAlignment="Center" />
              </StackPanel>
              <Button Grid.Column="1"
                      Content="{loc:Translate AddEntry}"
                      Classes="Primary Small"
                      Command="{Binding AddEntryCommand}"
                      IsEnabled="{Binding !IsLocked}" />
            </Grid>

            <ItemsControl ItemsSource="{Binding TimeEntries}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:TimeEntry">
                  <Border Classes="Card" Padding="12" Margin="0,2">
                    <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                      <mi:MaterialIcon Grid.Column="0"
                                       Kind="{Binding TypeIconKind}"
                                       Width="20" Height="20"
                                       Foreground="{DynamicResource PrimaryBrush}"
                                       VerticalAlignment="Center"
                                       Margin="0,0,12,0" />
                      <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="{Binding FullDisplay}"
                                   FontSize="14" FontWeight="Bold"
                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                        <TextBlock Text="{Binding Note}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   IsVisible="{Binding HasNote}" />
                      </StackPanel>
                      <Button Grid.Column="2" Classes="Text"
                              Command="{Binding $parent[UserControl].((vm:DayDetailViewModel)DataContext).EditEntryCommand}"
                              CommandParameter="{Binding .}">
                        <mi:MaterialIcon Kind="Pencil" Width="16" Height="16"
                                         Foreground="{DynamicResource PrimaryBrush}" />
                      </Button>
                      <Button Grid.Column="3" Classes="Text"
                              Command="{Binding $parent[UserControl].((vm:DayDetailViewModel)DataContext).DeleteEntryCommand}"
                              CommandParameter="{Binding .}">
                        <mi:MaterialIcon Kind="Delete" Width="16" Height="16"
                                         Foreground="{DynamicResource ErrorBrush}" />
                      </Button>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Empty State -->
            <StackPanel IsVisible="{Binding HasNoTimeEntries}"
                        HorizontalAlignment="Center" Margin="0,16">
              <mi:MaterialIcon Kind="ClockOutline" Width="48" Height="48"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               HorizontalAlignment="Center" />
              <TextBlock Text="{loc:Translate NoEntries}"
                         FontSize="14"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         HorizontalAlignment="Center"
                         Margin="0,8,0,0" />
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- ==================== Breaks ==================== -->
        <Border Classes="Card">
          <StackPanel Spacing="12">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="Coffee" Width="20" Height="20"
                               Foreground="{DynamicResource WarningBrush}" />
              <TextBlock Text="{loc:Translate Pauses}"
                         FontSize="16" FontWeight="Bold"
                         Foreground="{DynamicResource TextPrimaryBrush}"
                         VerticalAlignment="Center" />
            </StackPanel>

            <ItemsControl ItemsSource="{Binding PauseEntries}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:PauseEntry">
                  <Border Classes="Card" Padding="12" Margin="0,2">
                    <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                      <mi:MaterialIcon Grid.Column="0"
                                       Kind="Coffee"
                                       Width="20" Height="20"
                                       Foreground="{DynamicResource WarningBrush}"
                                       VerticalAlignment="Center"
                                       Margin="0,0,12,0" />
                      <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                          <TextBlock Text="{Binding StartTimeDisplay}"
                                     FontSize="14" FontWeight="Bold"
                                     Foreground="{DynamicResource TextPrimaryBrush}" />
                          <TextBlock Text="&#x2013;"
                                     FontSize="14"
                                     Foreground="{DynamicResource TextSecondaryBrush}" />
                          <TextBlock Text="{Binding EndTimeDisplay}"
                                     FontSize="14" FontWeight="Bold"
                                     Foreground="{DynamicResource TextPrimaryBrush}" />
                        </StackPanel>
                        <TextBlock Text="{Binding DurationDisplay}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextSecondaryBrush}" />
                      </StackPanel>
                      <mi:MaterialIcon Grid.Column="2"
                                       Kind="FlashOutline"
                                       Width="16" Height="16"
                                       Foreground="{DynamicResource WarningBrush}"
                                       IsVisible="{Binding IsAutoPause}"
                                       VerticalAlignment="Center"
                                       Margin="4,0" />
                      <Button Grid.Column="3" Classes="Text"
                              Command="{Binding $parent[UserControl].((vm:DayDetailViewModel)DataContext).DeletePauseCommand}"
                              CommandParameter="{Binding .}"
                              IsVisible="{Binding !IsAutoPause}">
                        <mi:MaterialIcon Kind="Delete" Width="16" Height="16"
                                         Foreground="{DynamicResource ErrorBrush}" />
                      </Button>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Empty State -->
            <StackPanel IsVisible="{Binding HasNoPauseEntries}"
                        HorizontalAlignment="Center" Margin="0,16">
              <mi:MaterialIcon Kind="Coffee" Width="48" Height="48"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               HorizontalAlignment="Center" />
              <TextBlock Text="{loc:Translate NoBreaksRecorded}"
                         FontSize="14"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         HorizontalAlignment="Center"
                         Margin="0,8,0,0" />
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- Bottom Spacer -->
        <Border Height="16" />

      </StackPanel>
    </ScrollViewer>

  </Grid>

</UserControl>
