<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:WorkTimePro.ViewModels"
             xmlns:models="using:WorkTimePro.Models"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             x:Class="WorkTimePro.Views.VacationView"
             x:DataType="vm:VacationViewModel"
             Background="{DynamicResource BackgroundBrush}">

  <Grid RowDefinitions="Auto,*" AutomationProperties.AutomationId="Vacation_RootPanel">

    <!-- Year Navigation Header -->
    <Border Grid.Row="0"
            AutomationProperties.AutomationId="Vacation_Header"
            Background="{DynamicResource SurfaceBrush}"
            Padding="8,4">
      <Grid ColumnDefinitions="Auto,Auto,*,Auto">
        <Button Grid.Column="0" Classes="Text"
                AutomationProperties.AutomationId="Vacation_BtnBack"
                Command="{Binding GoBackCommand}">
          <mi:MaterialIcon Kind="ArrowLeft" Width="24" Height="24"
                           Foreground="{DynamicResource PrimaryBrush}" />
        </Button>
        <Button Grid.Column="1" Classes="Text"
                AutomationProperties.AutomationId="Vacation_BtnPrevYear"
                Command="{Binding PreviousYearCommand}">
          <mi:MaterialIcon Kind="ChevronLeft" Width="24" Height="24"
                           Foreground="{DynamicResource PrimaryBrush}" />
        </Button>
        <TextBlock Grid.Column="2"
                   AutomationProperties.AutomationId="Vacation_TxtYear"
                   Text="{Binding SelectedYear}"
                   FontSize="20" FontWeight="Bold"
                   Foreground="{DynamicResource TextPrimaryBrush}"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center" />
        <Button Grid.Column="3" Classes="Text"
                AutomationProperties.AutomationId="Vacation_BtnNextYear"
                Command="{Binding NextYearCommand}">
          <mi:MaterialIcon Kind="ChevronRight" Width="24" Height="24"
                           Foreground="{DynamicResource PrimaryBrush}" />
        </Button>
      </Grid>
    </Border>

    <ScrollViewer Grid.Row="1" AutomationProperties.AutomationId="Vacation_ScrollViewer">
      <StackPanel Spacing="16" Margin="16">

        <!-- ==================== Quota Card ==================== -->
        <Border Classes="CardElevated StatsCard" AutomationProperties.AutomationId="Vacation_QuotaCard">
          <Grid RowDefinitions="Auto,Auto,Auto"
                ColumnDefinitions="*,Auto" RowSpacing="8">
            <TextBlock Grid.Row="0" Grid.Column="0"
                       Text="{loc:Translate VacationAccount}"
                       FontSize="18" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}" />
            <TextBlock Grid.Row="0" Grid.Column="1"
                       AutomationProperties.AutomationId="Vacation_TxtQuota"
                       Text="{Binding QuotaDisplay}"
                       FontSize="18" FontWeight="Bold"
                       Foreground="{DynamicResource PrimaryBrush}" />

            <ProgressBar Grid.Row="1" Grid.ColumnSpan="2"
                         AutomationProperties.AutomationId="Vacation_QuotaProgress"
                         Value="{Binding ProgressPercent}"
                         Maximum="1"
                         Foreground="{DynamicResource PrimaryBrush}" />

            <TextBlock Grid.Row="2" Grid.Column="0"
                       AutomationProperties.AutomationId="Vacation_TxtProgressDisplay"
                       Text="{Binding ProgressDisplay}"
                       FontSize="12"
                       Foreground="{DynamicResource TextSecondaryBrush}" />
            <Button Grid.Row="2" Grid.Column="1"
                    AutomationProperties.AutomationId="Vacation_BtnEditQuota"
                    Content="{loc:Translate Edit}"
                    Classes="Outlined Small"
                    Command="{Binding EditQuotaCommand}"
                    IsVisible="{Binding IsPremium}" />
          </Grid>
        </Border>

        <!-- ==================== Add New Vacation ==================== -->
        <Border Classes="Card StatsCard"
                AutomationProperties.AutomationId="Vacation_AddCard"
                IsVisible="{Binding IsPremium}">
          <StackPanel Spacing="12">
            <TextBlock Text="{loc:Translate AddNewVacation}"
                       AutomationProperties.AutomationId="Vacation_TxtAddTitle"
                       FontSize="16" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}" />

            <Grid ColumnDefinitions="*,Auto,*" RowDefinitions="Auto,Auto">
              <!-- From -->
              <StackPanel Grid.Row="0" Grid.Column="0">
                <TextBlock Text="{loc:Translate From}"
                           FontSize="12"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
                <CalendarDatePicker SelectedDate="{Binding NewStartDate}"
                                    AutomationProperties.AutomationId="Vacation_PickerStartDate"
                                    HorizontalAlignment="Stretch" />
              </StackPanel>

              <!-- Arrow -->
              <mi:MaterialIcon Grid.Row="0" Grid.Column="1"
                               Kind="SwapHorizontal"
                               Width="20" Height="20"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               VerticalAlignment="Center"
                               Margin="8,16,8,0" />

              <!-- To -->
              <StackPanel Grid.Row="0" Grid.Column="2">
                <TextBlock Text="{loc:Translate To}"
                           FontSize="12"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
                <CalendarDatePicker SelectedDate="{Binding NewEndDate}"
                                    AutomationProperties.AutomationId="Vacation_PickerEndDate"
                                    HorizontalAlignment="Stretch" />
              </StackPanel>

              <TextBlock Grid.Row="1" Grid.ColumnSpan="3"
                         AutomationProperties.AutomationId="Vacation_TxtCalculatedDays"
                         Text="{Binding CalculatedDaysDisplay}"
                         FontSize="14" FontWeight="Bold"
                         Foreground="{DynamicResource TextPrimaryBrush}"
                         HorizontalAlignment="Center"
                         Margin="0,8,0,0" />
            </Grid>

            <!-- Type -->
            <ComboBox ItemsSource="{Binding VacationTypes}"
                      AutomationProperties.AutomationId="Vacation_CbxType"
                      SelectedItem="{Binding NewType}"
                      HorizontalAlignment="Stretch">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Name}" />
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>

            <!-- Note -->
            <TextBox Watermark="{loc:Translate NoteOptional}"
                     AutomationProperties.AutomationId="Vacation_TxtNote"
                     Text="{Binding NewNote}" />

            <!-- Add Button -->
            <Button Content="{loc:Translate AddVacation}"
                    AutomationProperties.AutomationId="Vacation_BtnAdd"
                    Classes="Primary"
                    Command="{Binding AddVacationCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center" />
          </StackPanel>
        </Border>

        <!-- ==================== Premium Notice ==================== -->
        <Border Classes="CardElevated StatsCard"
                AutomationProperties.AutomationId="Vacation_PremiumNotice"
                IsVisible="{Binding !IsPremium}">
          <StackPanel Spacing="8" HorizontalAlignment="Center">
            <mi:MaterialIcon Kind="Crown" Width="36" Height="36"
                             Foreground="{DynamicResource PrimaryBrush}"
                             HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate PremiumVacationFeature}"
                       FontSize="18" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate PremiumVacationDesc}"
                       FontSize="12"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center"
                       TextAlignment="Center" />
            <Button Content="{loc:Translate UnlockPremium}"
                    AutomationProperties.AutomationId="Vacation_BtnUnlockPremium"
                    Classes="Primary"
                    Command="{Binding GoBackCommand}"
                    Margin="0,8,0,0"
                    HorizontalAlignment="Center" />
          </StackPanel>
        </Border>

        <!-- ==================== Vacation List ==================== -->
        <TextBlock Text="{loc:Translate RegisteredVacations}"
                   AutomationProperties.AutomationId="Vacation_TxtListTitle"
                   FontSize="18" FontWeight="Bold"
                   Foreground="{DynamicResource TextPrimaryBrush}" />

        <ItemsControl ItemsSource="{Binding VacationEntries}" AutomationProperties.AutomationId="Vacation_EntryList">
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="models:VacationEntry">
              <Border Classes="Card" Padding="12" Margin="0,2">
                <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="12">
                  <mi:MaterialIcon Grid.Column="0"
                                   Kind="{Binding TypeIconKind}"
                                   Width="24" Height="24"
                                   Foreground="{DynamicResource PrimaryBrush}"
                                   VerticalAlignment="Center" />
                  <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding DateRangeDisplay}"
                               FontSize="14" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimaryBrush}" />
                    <TextBlock Text="{Binding Note}"
                               FontSize="12"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               IsVisible="{Binding HasNote}" />
                  </StackPanel>
                  <TextBlock Grid.Column="2"
                             Text="{Binding DaysDisplay}"
                             FontSize="16" FontWeight="Bold"
                             Foreground="{DynamicResource PrimaryBrush}"
                             VerticalAlignment="Center" />
                  <Button Grid.Column="3" Classes="Text"
                          Command="{Binding $parent[UserControl].((vm:VacationViewModel)DataContext).DeleteVacationCommand}"
                          CommandParameter="{Binding .}">
                    <mi:MaterialIcon Kind="Delete" Width="16" Height="16"
                                     Foreground="{DynamicResource ErrorBrush}" />
                  </Button>
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Empty State for Vacations -->
        <StackPanel IsVisible="{Binding HasNoVacations}"
                    AutomationProperties.AutomationId="Vacation_EmptyState"
                    HorizontalAlignment="Center" Margin="0,16">
          <mi:MaterialIcon Kind="Beach" Width="48" Height="48"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           HorizontalAlignment="Center" />
          <TextBlock Text="{loc:Translate NoVacationsRegistered}"
                     FontSize="14"
                     Foreground="{DynamicResource TextSecondaryBrush}"
                     HorizontalAlignment="Center"
                     Margin="0,8,0,0" />
        </StackPanel>

        <!-- ==================== Holidays ==================== -->
        <TextBlock Text="{loc:Translate Holidays}"
                   AutomationProperties.AutomationId="Vacation_TxtHolidaysTitle"
                   FontSize="18" FontWeight="Bold"
                   Foreground="{DynamicResource TextPrimaryBrush}" />

        <ItemsControl ItemsSource="{Binding Holidays}" AutomationProperties.AutomationId="Vacation_HolidayList">
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="models:HolidayEntry">
              <Border Classes="Card" Padding="12" Margin="0,2">
                <Grid ColumnDefinitions="Auto,*,Auto">
                  <mi:MaterialIcon Grid.Column="0"
                                   Kind="PartyPopper"
                                   Width="20" Height="20"
                                   Foreground="{DynamicResource WarningBrush}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0" />
                  <StackPanel Grid.Column="1">
                    <TextBlock Text="{Binding Name}"
                               FontSize="14" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimaryBrush}" />
                    <TextBlock Text="{Binding WeekdayDisplay}"
                               FontSize="12"
                               Foreground="{DynamicResource TextSecondaryBrush}" />
                  </StackPanel>
                  <TextBlock Grid.Column="2"
                             Text="{Binding DateDisplay}"
                             FontSize="12"
                             Foreground="{DynamicResource TextSecondaryBrush}"
                             VerticalAlignment="Center" />
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Bottom Spacer (Ad-Banner) -->
        <Border Height="60" />

      </StackPanel>
    </ScrollViewer>

    <!-- ==================== Quota Edit Overlay ==================== -->
    <Border IsVisible="{Binding IsEditingQuota}"
            AutomationProperties.AutomationId="Vacation_QuotaOverlay"
            Background="#CC000000"
            ZIndex="99"
            Grid.RowSpan="2">
      <Border Background="{DynamicResource CardBrush}"
              AutomationProperties.AutomationId="Vacation_QuotaOverlayCard"
              CornerRadius="16"
              Padding="24"
              MaxWidth="360"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
        <StackPanel Spacing="16">
          <TextBlock Text="{loc:Translate VacationAccount}"
                     FontSize="20" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center" />

          <!-- Urlaubstage pro Jahr -->
          <StackPanel Spacing="4">
            <TextBlock Text="{loc:Translate VacationDaysPerYear}"
                       FontSize="13"
                       Foreground="{DynamicResource TextSecondaryBrush}" />
            <NumericUpDown Value="{Binding EditTotalDays}"
                           AutomationProperties.AutomationId="Vacation_NumTotalDays"
                           Minimum="0" Maximum="365"
                           FormatString="0"
                           HorizontalAlignment="Stretch" />
          </StackPanel>

          <!-- Resturlaub -->
          <StackPanel Spacing="4">
            <TextBlock Text="{loc:Translate CarryOverDays}"
                       FontSize="13"
                       Foreground="{DynamicResource TextSecondaryBrush}" />
            <NumericUpDown Value="{Binding EditCarryOverDays}"
                           AutomationProperties.AutomationId="Vacation_NumCarryOver"
                           Minimum="0" Maximum="365"
                           FormatString="0"
                           HorizontalAlignment="Stretch" />
          </StackPanel>

          <!-- Buttons -->
          <Grid ColumnDefinitions="*,8,*">
            <Button Grid.Column="0"
                    AutomationProperties.AutomationId="Vacation_BtnCancelQuota"
                    Content="{loc:Translate Cancel}"
                    Classes="Outlined"
                    Command="{Binding CancelEditQuotaCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center" />
            <Button Grid.Column="2"
                    AutomationProperties.AutomationId="Vacation_BtnSaveQuota"
                    Content="{loc:Translate Save}"
                    Classes="Primary"
                    Command="{Binding SaveQuotaCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center" />
          </Grid>
        </StackPanel>
      </Border>
    </Border>

    <!-- ==================== Rewarded Ad Overlay ==================== -->
    <Border IsVisible="{Binding ShowRewardedAdOverlay}"
            AutomationProperties.AutomationId="Vacation_AdOverlay"
            Background="#CC000000"
            ZIndex="100"
            Grid.RowSpan="2">
      <Border Background="{DynamicResource CardBrush}"
              AutomationProperties.AutomationId="Vacation_AdOverlayCard"
              CornerRadius="16"
              Padding="24"
              MaxWidth="340"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
        <StackPanel Spacing="16" HorizontalAlignment="Center">
          <TextBlock Text="{loc:Translate PremiumFeatureTitle}"
                     AutomationProperties.AutomationId="Vacation_TxtAdTitle"
                     FontSize="22" FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center" />
          <Border Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="30"
                  Width="60" Height="60"
                  HorizontalAlignment="Center">
            <mi:MaterialIcon Kind="Star" Width="32" Height="32"
                             Foreground="{DynamicResource AccentBrush}" />
          </Border>
          <TextBlock Text="{loc:Translate PremiumFeatureDesc}"
                     AutomationProperties.AutomationId="Vacation_TxtAdDesc"
                     FontSize="14"
                     Foreground="{DynamicResource TextSecondaryBrush}"
                     HorizontalAlignment="Center"
                     TextWrapping="Wrap" TextAlignment="Center" />
          <StackPanel Spacing="8">
            <Button Classes="Filled"
                    AutomationProperties.AutomationId="Vacation_BtnWatchAd"
                    Command="{Binding WatchAdCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Padding="16,12">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="Video" Width="20" Height="20" />
                <TextBlock Text="{loc:Translate WatchVideoOnce}"
                           FontSize="15" FontWeight="SemiBold" />
              </StackPanel>
            </Button>
            <Button Classes="Text"
                    AutomationProperties.AutomationId="Vacation_BtnCancelAd"
                    Command="{Binding CancelAdOverlayCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Padding="12,10">
              <TextBlock Text="{loc:Translate Cancel}"
                         FontSize="14"
                         Foreground="{DynamicResource TextSecondaryBrush}" />
            </Button>
          </StackPanel>
        </StackPanel>
      </Border>
    </Border>

  </Grid>

</UserControl>
