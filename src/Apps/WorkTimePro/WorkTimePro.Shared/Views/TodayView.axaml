<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:WorkTimePro.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             xmlns:skia="using:Avalonia.Labs.Controls"
             xmlns:skiaControls="using:MeineApps.UI.SkiaSharp"
             x:Class="WorkTimePro.Views.TodayView"
             x:DataType="vm:MainViewModel">

  <!-- Styles fuer Animationen und Effekte -->
  <UserControl.Styles>
    <!-- Big Action Button: Basis-Transition -->
    <Style Selector="Button.BigAction">
      <Style.Setters>
        <Setter Property="Transitions">
          <Transitions>
            <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.12" />
            <DoubleTransition Property="Opacity" Duration="0:0:0.12" />
          </Transitions>
        </Setter>
      </Style.Setters>
    </Style>
    <!-- Big Action Button: Hover-Effekt -->
    <Style Selector="Button.BigAction:pointerover">
      <Setter Property="RenderTransform" Value="scale(1.04)" />
    </Style>
    <!-- Big Action Button: Press-Effekt -->
    <Style Selector="Button.BigAction:pressed">
      <Setter Property="RenderTransform" Value="scale(0.92)" />
      <Setter Property="Opacity" Value="0.85" />
    </Style>

    <!-- Quick-Nav Cards: Hover-Effekt -->
    <Style Selector="Button.QuickNav:pointerover">
      <Setter Property="RenderTransform" Value="scale(1.03)" />
    </Style>
  </UserControl.Styles>

  <ScrollViewer AutomationProperties.AutomationId="Today_ScrollViewer">
    <StackPanel Spacing="12" Margin="16" AutomationProperties.AutomationId="Today_RootPanel">

      <!-- Date Header -->
      <TextBlock Text="{Binding TodayDateDisplay}"
                 AutomationProperties.AutomationId="Today_TxtDate"
                 Classes="PageTitle"
                 HorizontalAlignment="Center" />

      <!-- ==================== Status Card ==================== -->
      <Border Classes="CardElevated StatsCard" Padding="24" AutomationProperties.AutomationId="Today_StatusCard">
        <StackPanel Spacing="20">

          <!-- Status Badge mit BrushTransition -->
          <Border AutomationProperties.AutomationId="Today_StatusBadge" Background="{Binding StatusColor}"
                  CornerRadius="16"
                  Padding="16,8"
                  HorizontalAlignment="Center">
            <Border.Transitions>
              <Transitions>
                <BrushTransition Property="Background" Duration="0:0:0.4" />
              </Transitions>
            </Border.Transitions>
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="{Binding StatusIconKind}"
                               Width="18" Height="18"
                               Foreground="White" />
              <TextBlock Text="{Binding StatusText}"
                         AutomationProperties.AutomationId="Today_TxtStatus"
                         FontSize="16" FontWeight="Bold"
                         Foreground="White"
                         VerticalAlignment="Center" />
            </StackPanel>
          </Border>

          <!-- Big Start/Stop Button mit SkiaSharp-Fortschrittsring -->
          <Panel HorizontalAlignment="Center" Width="140" Height="140">
            <!-- SkiaSharp Gradient-Ring mit Glow + Pulsation -->
            <skiaControls:SkiaGradientRing
                AutomationProperties.AutomationId="Today_ProgressRing"
                Value="{Binding DayProgressFraction}"
                IsPulsing="{Binding IsWorking}"
                GlowEnabled="{Binding IsWorking}"
                StartColor="#22C55E"
                EndColor="#4ADE80"
                StrokeWidth="6"
                ShowTickMarks="True"
                TickMarkCount="24"
                Width="140" Height="140" />
            <!-- Button zentriert im Ring -->
            <Button AutomationProperties.AutomationId="Today_BtnToggleTracking"
                    Command="{Binding ToggleTrackingCommand}"
                    Classes="BigAction"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Width="120" Height="120"
                    CornerRadius="60"
                    Background="{Binding StatusColor}"
                    Padding="0"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center">
              <mi:MaterialIcon Kind="{Binding StatusIconKind}"
                               Width="48" Height="48"
                               Foreground="White" />
            </Button>
            <!-- Fortschritts-Prozent unter dem Button -->
            <TextBlock Text="{Binding DayProgressPercent}"
                       AutomationProperties.AutomationId="Today_TxtProgressPercent"
                       FontSize="12" FontWeight="SemiBold"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Bottom"
                       Margin="0,0,0,2" />
          </Panel>

          <!-- Pause Button -->
          <Button AutomationProperties.AutomationId="Today_BtnTogglePause"
                  Content="{Binding PauseButtonText}"
                  Classes="Secondary"
                  Command="{Binding TogglePauseCommand}"
                  HorizontalAlignment="Center"
                  IsVisible="{Binding IsWorking}" />

        </StackPanel>
      </Border>

      <!-- ==================== Undo Bar ==================== -->
      <Border AutomationProperties.AutomationId="Today_UndoBar" Background="{DynamicResource WarningBrush}" CornerRadius="8" Padding="12,8"
              IsVisible="{Binding IsUndoVisible}"
              HorizontalAlignment="Stretch">
        <Grid ColumnDefinitions="*,Auto">
          <TextBlock Grid.Column="0"
                     AutomationProperties.AutomationId="Today_TxtUndoMessage"
                     Text="{Binding UndoMessage}"
                     Foreground="White" FontWeight="SemiBold"
                     VerticalAlignment="Center" />
          <Button Grid.Column="1"
                  AutomationProperties.AutomationId="Today_BtnUndo"
                  Command="{Binding UndoLastActionCommand}"
                  Background="Transparent"
                  BorderThickness="1" BorderBrush="White"
                  CornerRadius="4" Padding="12,4">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <mi:MaterialIcon Kind="Undo" Width="16" Height="16" Foreground="White" />
              <TextBlock Text="{loc:Translate Undo}"
                         Foreground="White" FontWeight="Bold" />
            </StackPanel>
          </Button>
        </Grid>
      </Border>

      <!-- ==================== Streak-Anzeige ==================== -->
      <Border AutomationProperties.AutomationId="Today_StreakBadge" Background="{DynamicResource WarningLightBrush}" CornerRadius="12" Padding="10,6"
              HorizontalAlignment="Center"
              IsVisible="{Binding HasStreak}">
        <StackPanel Orientation="Horizontal" Spacing="6">
          <mi:MaterialIcon Kind="Fire" Width="20" Height="20"
                           Foreground="{DynamicResource WarningBrush}" />
          <TextBlock FontSize="15" FontWeight="Bold"
                     Foreground="{DynamicResource WarningBrush}"
                     VerticalAlignment="Center">
            <TextBlock.Text>
              <MultiBinding StringFormat="{}{0} Tage">
                <Binding Path="StreakCount" />
              </MultiBinding>
            </TextBlock.Text>
          </TextBlock>
        </StackPanel>
      </Border>

      <!-- ==================== Time Metrics Card ==================== -->
      <Border Classes="Card StatsCard" Padding="16" AutomationProperties.AutomationId="Today_MetricsCard">
        <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto"
              RowSpacing="12">

          <!-- Work Time -->
          <StackPanel Grid.Column="0" Grid.Row="0"
                      HorizontalAlignment="Center">
            <TextBlock Text="{Binding CurrentWorkTime}"
                       AutomationProperties.AutomationId="Today_TxtWorkTime"
                       FontSize="24" FontWeight="Bold"
                       Foreground="{DynamicResource SuccessBrush}"
                       HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate WorkTime}"
                       FontSize="12"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center" />
          </StackPanel>

          <!-- Break Time -->
          <StackPanel Grid.Column="1" Grid.Row="0"
                      HorizontalAlignment="Center">
            <TextBlock Text="{Binding CurrentPauseTime}"
                       AutomationProperties.AutomationId="Today_TxtPauseTime"
                       FontSize="24" FontWeight="Bold"
                       Foreground="{DynamicResource WarningBrush}"
                       HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate Break}"
                       FontSize="12"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center" />
          </StackPanel>

          <!-- Balance -->
          <StackPanel Grid.Column="2" Grid.Row="0"
                      HorizontalAlignment="Center">
            <TextBlock Text="{Binding BalanceTime}"
                       AutomationProperties.AutomationId="Today_TxtBalance"
                       FontSize="24" FontWeight="Bold"
                       Foreground="{Binding BalanceColor}"
                       HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate Balance}"
                       FontSize="12"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center" />
          </StackPanel>

          <!-- Target -->
          <StackPanel Grid.Column="0" Grid.Row="1"
                      HorizontalAlignment="Center">
            <TextBlock Text="{Binding TargetWorkTime}"
                       AutomationProperties.AutomationId="Today_TxtTarget"
                       FontSize="16"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate Target}"
                       FontSize="12"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center" />
          </StackPanel>

          <!-- Check-In Time -->
          <StackPanel Grid.Column="1" Grid.Row="1" Grid.ColumnSpan="2"
                      HorizontalAlignment="Center"
                      IsVisible="{Binding HasCheckedIn}">
            <TextBlock Text="{Binding FirstCheckIn}"
                       AutomationProperties.AutomationId="Today_TxtFirstCheckIn"
                       FontSize="16"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate Start}"
                       FontSize="12"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center" />
          </StackPanel>

        </Grid>
      </Border>

      <!-- ==================== Earnings Card (nur wenn Stundenlohn konfiguriert) ==================== -->
      <Border AutomationProperties.AutomationId="Today_EarningsCard" Classes="Card StatsCard" Padding="12"
              BorderBrush="{DynamicResource SuccessBrush}"
              BorderThickness="1"
              CornerRadius="12"
              IsVisible="{Binding HasEarnings}">
        <StackPanel Orientation="Horizontal" Spacing="12"
                    HorizontalAlignment="Center">
          <mi:MaterialIcon Kind="CurrencyEur"
                           Width="28" Height="28"
                           Foreground="{DynamicResource SuccessBrush}" />
          <StackPanel>
            <TextBlock Text="{Binding TodayEarnings}"
                       AutomationProperties.AutomationId="Today_TxtEarnings"
                       FontSize="24" FontWeight="Bold"
                       Foreground="{DynamicResource SuccessBrush}" />
            <TextBlock Text="{loc:Translate TodayEarnings}"
                       FontSize="12"
                       Foreground="{DynamicResource TextSecondaryBrush}" />
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- ==================== Auto-Pause Warning ==================== -->
      <Border AutomationProperties.AutomationId="Today_AutoPauseWarning"
              Background="{DynamicResource WarningLightBrush}"
              BorderBrush="{DynamicResource WarningBrush}"
              BorderThickness="1"
              CornerRadius="12"
              Padding="12"
              IsVisible="{Binding HasAutoPause}">
        <StackPanel Orientation="Horizontal" Spacing="12">
          <mi:MaterialIcon Kind="FlashOutline"
                           Width="24" Height="24"
                           Foreground="{DynamicResource WarningBrush}" />
          <StackPanel>
            <TextBlock Text="{loc:Translate AutoPauseAdded}"
                       FontSize="14" FontWeight="Bold"
                       Foreground="{DynamicResource WarningBrush}" />
            <TextBlock Text="{Binding AutoPauseInfo}"
                       AutomationProperties.AutomationId="Today_TxtAutoPauseInfo"
                       FontSize="12"
                       Foreground="{DynamicResource WarningBrush}" />
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- SkiaSharp Tages-Timeline (ArbeitsblÃ¶cke + Pausen) -->
      <Border Classes="Card StatsCard" Padding="8"
              AutomationProperties.AutomationId="Today_TimelineCard"
              IsVisible="{Binding HasCheckedIn}">
        <Border Height="56" ClipToBounds="True">
          <skia:SKCanvasView x:Name="TimelineCanvas" AutomationProperties.AutomationId="Today_TimelineCanvas" PaintSurface="OnPaintTimeline" />
        </Border>
      </Border>

      <!-- Day Details Button -->
      <Button AutomationProperties.AutomationId="Today_BtnDayDetails"
              Content="{Binding ShowDayDetailsText}"
              Classes="Secondary"
              Command="{Binding NavigateToDayDetailCommand}"
              HorizontalAlignment="Stretch"
              HorizontalContentAlignment="Center" />

      <!-- ==================== Quick Navigation Section ==================== -->
      <TextBlock AutomationProperties.AutomationId="Today_TxtMoreFeatures"
                 Text="{loc:Translate MoreFeatures}"
                 FontSize="18" FontWeight="Bold"
                 Foreground="{DynamicResource TextPrimaryBrush}"
                 Margin="0,8,0,0" />

      <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto"
            ColumnSpacing="12" RowSpacing="12"
            Margin="0,0,0,16">

        <!-- Month Overview -->
        <Button Grid.Row="0" Grid.Column="0"
                AutomationProperties.AutomationId="Today_BtnMonth"
                Classes="QuickNav"
                Command="{Binding NavigateToMonthCommand}"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                VerticalContentAlignment="Center"
                Height="80"
                CornerRadius="12"
                Background="{DynamicResource SecondaryBrush}"
                RenderTransform="scale(1)">
          <Button.Transitions>
            <Transitions>
              <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" />
            </Transitions>
          </Button.Transitions>
          <StackPanel HorizontalAlignment="Center" Spacing="4">
            <mi:MaterialIcon Kind="CalendarMonth"
                             Width="24" Height="24"
                             Foreground="White"
                             HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate MonthOverview}"
                       FontSize="11" Foreground="White"
                       HorizontalAlignment="Center"
                       TextAlignment="Center" />
          </StackPanel>
        </Button>

        <!-- Year Overview -->
        <Button Grid.Row="0" Grid.Column="1"
                AutomationProperties.AutomationId="Today_BtnYear"
                Classes="QuickNav"
                Command="{Binding NavigateToYearCommand}"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                VerticalContentAlignment="Center"
                Height="80"
                CornerRadius="12"
                Background="{DynamicResource SecondaryBrush}"
                RenderTransform="scale(1)">
          <Button.Transitions>
            <Transitions>
              <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" />
            </Transitions>
          </Button.Transitions>
          <StackPanel HorizontalAlignment="Center" Spacing="4">
            <mi:MaterialIcon Kind="ChartBar"
                             Width="24" Height="24"
                             Foreground="White"
                             HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate YearOverview}"
                       FontSize="11" Foreground="White"
                       HorizontalAlignment="Center"
                       TextAlignment="Center" />
          </StackPanel>
        </Button>

        <!-- Vacation -->
        <Button Grid.Row="1" Grid.Column="0"
                AutomationProperties.AutomationId="Today_BtnVacation"
                Classes="QuickNav"
                Command="{Binding NavigateToVacationCommand}"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                VerticalContentAlignment="Center"
                Height="80"
                CornerRadius="12"
                Background="{DynamicResource InfoBrush}"
                RenderTransform="scale(1)">
          <Button.Transitions>
            <Transitions>
              <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" />
            </Transitions>
          </Button.Transitions>
          <StackPanel HorizontalAlignment="Center" Spacing="4">
            <mi:MaterialIcon Kind="Beach"
                             Width="24" Height="24"
                             Foreground="White"
                             HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate Vacation}"
                       FontSize="11" Foreground="White"
                       HorizontalAlignment="Center"
                       TextAlignment="Center" />
          </StackPanel>
        </Button>

        <!-- Shift Plan -->
        <Button Grid.Row="1" Grid.Column="1"
                AutomationProperties.AutomationId="Today_BtnShiftPlan"
                Classes="QuickNav"
                Command="{Binding NavigateToShiftPlanCommand}"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                VerticalContentAlignment="Center"
                Height="80"
                CornerRadius="12"
                Background="{DynamicResource WarningBrush}"
                RenderTransform="scale(1)">
          <Button.Transitions>
            <Transitions>
              <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" />
            </Transitions>
          </Button.Transitions>
          <StackPanel HorizontalAlignment="Center" Spacing="4">
            <mi:MaterialIcon Kind="SwapHorizontal"
                             Width="24" Height="24"
                             Foreground="White"
                             HorizontalAlignment="Center" />
            <TextBlock Text="{loc:Translate ShiftPlan}"
                       FontSize="11" Foreground="White"
                       HorizontalAlignment="Center"
                       TextAlignment="Center" />
          </StackPanel>
        </Button>

      </Grid>

      <!-- Bottom Spacer (Ad-Banner) -->
      <Border Height="60" />

    </StackPanel>
  </ScrollViewer>

</UserControl>
